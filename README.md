# KUROZUMI v1.1

> æœ¬ç¤¾ï¼ˆHQï¼‰ï¼‹å…¨å›½FCï¼ˆç›´å–¶50ï¼FC50ï¼‰ã‚’ã€Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼‹Apps Scriptï¼ˆKUROZUMIãƒ•ãƒ­ãƒ³ãƒˆï¼‰ã§çµ±åˆç®¡ç†ã™ã‚‹ãŸã‚ã®**å®Œå…¨ä»•æ§˜**ã€‚æœ¬æ›¸ã¯ã€ç®¡ç†é …ç›®ã®å…¨é‡ã€ERï¼ˆæ¦‚å¿µâ†’è«–ç†ï¼‰ã€ã‚·ãƒ¼ãƒˆæ§‹æˆï¼ˆç‰©ç†å®šç¾©ï¼‰ã€CRUD/ç›£æŸ»/ã‚½ãƒ•ãƒˆå‰Šé™¤ã€UI/UXã€é‹ç”¨ãƒ»ã‚¬ãƒãƒŠãƒ³ã‚¹ã€æ‹¡å¼µãƒ»å¯è¦³æ¸¬æ€§ã¾ã§ã‚’**å®Ÿè£…ãƒ¬ãƒ™ãƒ«**ã§æç¤ºã™ã‚‹ã€‚
## ç›®æ¬¡ï¼ˆHyperdrive Overviewï¼‰

1. [0. ã‚¹ã‚³ãƒ¼ãƒ—/åŸå‰‡](#0-ã‚¹ã‚³ãƒ¼ãƒ—åŸå‰‡)
2. [1. ç®¡ç†ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ç®¡ç†é …ç›®ï¼ˆå®Œå…¨ç¶²ç¾…ï¼‰](#1-ç®¡ç†ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ç®¡ç†é …ç›®å®Œå…¨ç¶²ç¾…)
3. [2. ERãƒ¢ãƒ‡ãƒ«ï¼ˆMermaidï¼‰](#2-erãƒ¢ãƒ‡ãƒ«mermaid)
4. [3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼šã‚·ãƒ¼ãƒˆæ§‹æˆã¨ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆå®Ÿè£…ç”¨ï¼‰](#3-ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚·ãƒ¼ãƒˆæ§‹æˆã¨ã‚«ãƒ©ãƒ å®šç¾©å®Ÿè£…ç”¨)
5. [4. ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ»æ¡ä»¶ä»˜ãæ›¸å¼ï¼ˆä»£è¡¨ä¾‹ï¼‰](#4-ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼æ¡ä»¶ä»˜ãæ›¸å¼ä»£è¡¨ä¾‹)
6. [5. RBACï¼ˆãƒ­ãƒ¼ãƒ«Ã—æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ï¼šä¾‹ï¼‰](#5-rbacãƒ­ãƒ¼ãƒ«æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ä¾‹)
7. [6. ä»£è¡¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ™‚ç³»åˆ—ï¼‰](#6-ä»£è¡¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ™‚ç³»åˆ—)
8. [7. Apps Scriptï¼ˆå®Ÿè£…éª¨å­ï¼‰](#7-apps-scriptå®Ÿè£…éª¨å­)
9. [8. UI/UXä»•æ§˜ï¼ˆIronmanÃ—AKIRAï¼‰](#8-uiuxä»•æ§˜ironmanakira)
10. [9. KPI/ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå®šç¾©ï¼‰](#9-kpiãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®šç¾©)
11. [10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£](#10-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£)
12. [11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼](#11-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼)
13. [12. ç›£æŸ»/ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/DR](#12-ç›£æŸ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—dr)
14. [13. å‘½åè¦ç´„/ã‚³ãƒ¼ãƒ‰ä½“ç³»](#13-å‘½åè¦ç´„ã‚³ãƒ¼ãƒ‰ä½“ç³»)
15. [14. å°å…¥è¨ˆç”»/ç§»è¡Œ](#14-å°å…¥è¨ˆç”»ç§»è¡Œ)
16. [15. ã‚ãªãŸã®æ—¢å­˜ãƒ–ãƒƒã‚¯ã¨ã®å·®åˆ†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#15-ã‚ãªãŸã®æ—¢å­˜ãƒ–ãƒƒã‚¯ã¨ã®å·®åˆ†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
17. [16. ä»˜éŒ²ï¼šMermaidã‚µãƒ–å›³ï¼ˆç”¨é€”åˆ¥ï¼‰](#16-ä»˜éŒ²mermaidã‚µãƒ–å›³ç”¨é€”åˆ¥)
18. [17. MPAï¼ˆMultiâ€‘Page Appï¼‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ â€” æˆ»ã‚‹ãƒœã‚¿ãƒ³å¸¸è¨­](#17-mpaãƒãƒ«ãƒãƒšãƒ¼ã‚¸-appãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶--æˆ»ã‚‹ãƒœã‚¿ãƒ³å¸¸è¨­)
19. [18. UI/ãƒŠãƒ“é–¢é€£ ERæ‹¡å¼µï¼ˆMermaidï¼‰](#18-uiãƒŠãƒ“é–¢é€£-eræ‹¡å¼µmermaid)
20. [19. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿ â€” è¿½åŠ ã‚·ãƒ¼ãƒˆã¯å¿…è¦ï¼Ÿ](#19-ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿--è¿½åŠ ã‚·ãƒ¼ãƒˆã¯å¿…è¦)
21. [20. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆBackãƒœã‚¿ãƒ³ï¼‰](#20-å®Ÿè£…ã‚¬ã‚¤ãƒ‰backãƒœã‚¿ãƒ³)
22. [21. å¤‰æ›´ã‚µãƒãƒªï¼ˆã‚ãªãŸã®ä¾é ¼ã‚’åæ˜ ï¼‰](#21-å¤‰æ›´ã‚µãƒãƒªã‚ãªãŸã®ä¾é ¼ã‚’åæ˜ )
23. [GitHubå‘ã‘ README.mdï¼ˆMPAÃ—GASÃ—Sheetsï¼ãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆï¼‰](#githubå‘ã‘-readmemdmpagasheetsãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆ)
24. [22. ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼å›³ï¼ˆMPA Ã— GAS Ã— Google Sheetsï¼Master DBï¼‰](#22-ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼å›³mpa--gas--google-sheetsmaster-db)
25. [23. æ©Ÿèƒ½é–¢é€£å›³ï¼ˆæ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ç›¸äº’ä¾å­˜ï¼‰](#23-æ©Ÿèƒ½é–¢é€£å›³æ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ç›¸äº’ä¾å­˜)
26. [24. ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆMPAÃ—GASÃ—Sheetsï¼‰](#24-ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹mpagasÃ—sheets)
27. [25. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼ˆDFD-L1ï¼‰](#25-ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³dfd-l1)
28. [26. ERå›³ï¼ˆè¦ç‚¹å†æ²ï¼šSpreadsheet=Master DB å¼·èª¿ï¼‰](#26-erå›³è¦ç‚¹å†æ²spreadsheetmaster-db-å¼·èª¿)
29. [27. READMEè¿½è£œï¼ˆGitHub åæ˜ ç”¨ï¼šDiagramsã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰](#27-readmeè¿½è£œgithub-åæ˜ ç”¨diagramsã‚»ã‚¯ã‚·ãƒ§ãƒ³)
30. [28. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿ï¼ˆæœ€çµ‚ç¢ºèªï¼‰](#28-ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿æœ€çµ‚ç¢ºèª)
31. [29. Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆçµ±åˆæ‰‹é †ï¼ˆæŒ‡å®šãƒ–ãƒƒã‚¯é€£æºï¼‰](#29-google-ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆçµ±åˆæ‰‹é †æŒ‡å®šãƒ–ãƒƒã‚¯é€£æº)
32. [30. Apps Script å®Ÿè£…è©³ç´°ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆï¼‰](#30-apps-script-å®Ÿè£…è©³ç´°ãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆ)
33. [31. UI/UX ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ€ã‚¤ãƒ–ï¼ˆIronman Ã— AKIRAï¼‰](#31-uiux-ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ€ã‚¤ãƒ–ironman--akira)
34. [32. ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ“ãƒªãƒ†ã‚£ï¼†KPI æ‹¡å¼µ](#32-ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ“ãƒªãƒ†ã‚£kpi-æ‹¡å¼µ)
35. [33. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¼·åŒ–ç­–](#33-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¼·åŒ–ç­–)
36. [34. ãƒ‡ãƒ—ãƒ­ã‚¤ & ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹](#34-ãƒ‡ãƒ—ãƒ­ã‚¤--ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹)
37. [35. å“è³ªä¿è¨¼ï¼ˆQAï¼‰æˆ¦ç•¥](#35-å“è³ªä¿è¨¼qaæˆ¦ç•¥)
38. [36. é‹ç”¨ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒã‚§ãƒ³ã‚¸ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ](#36-é‹ç”¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒã‚§ãƒ³ã‚¸ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ)
39. [37. ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆFuture Enhancementsï¼‰](#37-ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—future-enhancements)
40. [38. ä»˜éŒ²ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ & ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚µãƒ³ãƒ—ãƒ«](#38-ä»˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ--ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚µãƒ³ãƒ—ãƒ«)
---

## 0. ã‚¹ã‚³ãƒ¼ãƒ—/åŸå‰‡

* **å˜ä¸€ã®Personãƒã‚¹ã‚¿ãƒ¼**ï¼ˆç¤¾å“¡/åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•/å”æ¥­è€…ã‚’çµ±åˆã€é›‡ç”¨ãƒ»é…å±ã¯å±¥æ­´ï¼‰
* **UUIDåŸºç›¤ï¼‹äººé–“å¯èª­ã‚³ãƒ¼ãƒ‰**ï¼ˆä¾‹: `STORE: YD-TOK-001`ï¼‰
* **ã‚½ãƒ•ãƒˆå‰Šé™¤ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**ï¼ˆ`active_flag=FALSE`ï¼‹ç›£æŸ»ãƒ­ã‚°ã€UIã¯éè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼‰
* **æœŸé–“æ•´åˆæ€§**ï¼ˆä¾¡æ ¼/å¥‘ç´„/é…å±/ä½æ‰€/ãƒ—ãƒ­ãƒ¢ã¯ `start_on/end_on`ï¼‰
* **LKPå‚ç…§ã®å¾¹åº•**ï¼ˆéƒ½é“åºœçœŒ/ç¨®åˆ¥/ç¨/æ±ºæ¸ˆç­‰ã¯å‚ç…§è¡¨ã§æ­£è¦åŒ–ï¼‰
* **ç›£æŸ»ãƒ»æ¨©é™åˆ¶å¾¡**ï¼ˆå…¨æ“ä½œã‚’`TRN_AuditTrail`ã«è¨˜éŒ²ã€RBACã§é–²è¦§/ç·¨é›†/æ‰¿èªã‚’åˆ†é›¢ï¼‰
* **UI/UX**ï¼šIronmanÃ—AKIRAï¼ˆãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼‹å¾®ç™ºå…‰ã€ã‚«ãƒ¼ãƒ‰/ãƒ‰ãƒ­ãƒ¯ãƒ¼ã€å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
* **æ‹¡å¼µ**ï¼šHRæ¡ç”¨ãƒ»è©•ä¾¡ã€è²¡å‹™ä¼šè¨ˆã€æ³•å‹™/å¥‘ç´„ã€è¨­å‚™ä¿å…¨ã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã€BIé€£æº

---

## 1. ç®¡ç†ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ç®¡ç†é …ç›®ï¼ˆ**å®Œå…¨ç¶²ç¾…**ï¼‰

### A. çµ„ç¹”ãƒ»æ‹ ç‚¹

* **ä¼šç¤¾ï¼ˆCOMPANYï¼‰**ï¼šä¼šç¤¾ã‚³ãƒ¼ãƒ‰ã€æ³•äººç•ªå·ã€ä¼šè¨ˆåŒºåˆ†ã€ç¨ç‡ã‚»ãƒƒãƒˆã€ä¼šè¨ˆå¹´åº¦ã€éŠ€è¡Œå£åº§ã€è«‹æ±‚å…ˆã€ãƒ­ã‚´/ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒªã‚·ãƒ¼
* **çµ„ç¹”éšå±¤ï¼ˆDIVISIONï¼‰**ï¼šHQ/ã‚¨ãƒªã‚¢/ãƒ–ãƒ­ãƒƒã‚¯/åº—èˆ—ç¨®åˆ¥ã€ç®¡è½„è€…ã€æ‰¿èªãƒ•ãƒ­ãƒ¼ã€å¯è¦–ç¯„å›²
* **åº—èˆ—ï¼ˆSTOREï¼‰**ï¼šåº—èˆ—ã‚³ãƒ¼ãƒ‰ã€åŒºåˆ†ï¼ˆç›´å–¶/FCï¼‰ã€å¥‘ç´„IDã€ä½æ‰€ï¼ˆéƒ½é“åºœçœŒ/å¸‚åŒº/ç”º/ç•ªåœ°/éƒµä¾¿ï¼‰ã€ç·¯åº¦çµŒåº¦ã€å–¶æ¥­æ™‚é–“ã€å®šä¼‘æ—¥ã€åº§å¸­æ•°ã€è¨­å‚™ã€POSç«¯æœ«IDã€åœ¨åº«å€‰åº«IDã€æ·±å¤œå–¶æ¥­è¨±å¯/æœŸé™ã€ä¿å¥æ‰€æƒ…å ±ã€é–‹åº—/é–‰åº—ã€ç¾æ³ï¼ˆæº–å‚™/å–¶æ¥­/ä¼‘æ­¢/é–‰åº—ï¼‰
* **åº—èˆ—ã‚ªãƒš**ï¼šé–‹åº—/é–‰åº—ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€æ—¥å ±ã€è¡›ç”Ÿç‚¹æ¤œã€æ¸©åº¦/æ²¹å“è³ªãƒ­ã‚°

### B. FCå¥‘ç´„ãƒ»ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚¸ãƒ¼

* **ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚¸ãƒ¼ï¼ˆFRANCHISEEï¼‰**ï¼šFCã‚³ãƒ¼ãƒ‰ã€å•†å·/ä»£è¡¨è€…ã€ä½æ‰€ã€é€£çµ¡å…ˆã€æŒ¯è¾¼å£ã€ä¿è¨¼é‡‘ã€ä¿¡ç”¨æ ã€ä¿é™ºåŠ å…¥ã€åç¤¾ç¢ºèªã€å¥‘ç´„ä¿ç®¡ãƒªãƒ³ã‚¯
* **FCå¥‘ç´„ï¼ˆFRANCHISE_CONTRACTï¼‰**ï¼šå¥‘ç´„IDã€å¯¾è±¡åº—èˆ—ã€é–‹å§‹/çµ‚äº†ã€ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ï¼ˆç‡/å›ºå®šé¡ï¼‰ã€è²©ä¿ƒåˆ†æ‹…ã€ä»•å…¥ç¾©å‹™ã€ä¾¡æ ¼çµ±åˆ¶ã€å†…è£…/ä»€å™¨è³‡ç”£å¸°å±ã€æ›´æ–°/é•ç´„/è§£ç´„æ¡é …ã€é•åå±¥æ­´

### C. äººãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ï¼ˆ**Personçµ±åˆ**ï¼‰

* **äººï¼ˆPERSONï¼‰**ï¼šPersonIDã€æ°åï¼ˆæ¼¢å­—/ã‚«ãƒŠ/ãƒ­ãƒ¼ãƒå­—ï¼‰ã€ç”Ÿå¹´æœˆæ—¥ã€æ€§åˆ¥ã€é€£çµ¡å…ˆï¼ˆé›»è©±/ãƒ¡ãƒ¼ãƒ«ï¼‰ã€ä½æ‰€ï¼ˆå±¥æ­´ï¼‰ã€ç·Šæ€¥é€£çµ¡å…ˆã€éŠ€è¡Œå£åº§ã€é¡”å†™çœŸã€åŒæ„æ›¸ãƒªãƒ³ã‚¯ã€å±æ€§ã‚¿ã‚°ï¼ˆéƒ½é“åºœçœŒ/é…å±åº—èˆ—/è·ç¨®/ã‚¹ã‚­ãƒ«/è³‡æ ¼/è¨€èª/ã‚°ãƒ«ãƒ¼ãƒ—ï¼šå¤šå€¤ï¼‰
* **é›‡ç”¨ãƒ»é…å±ï¼ˆEMPLOYMENTï¼‰**ï¼šåŒºåˆ†ï¼ˆHQç¤¾å“¡/åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•/å§”è¨—/æ´¾é£ï¼‰ã€é›‡ç”¨å½¢æ…‹ï¼ˆæ­£/å¥‘/ãƒ‘ãƒ¼ãƒˆï¼‰ã€æ‰€å±ï¼ˆHQéƒ¨é–€/åº—èˆ—ï¼‰ã€å½¹è·ã€é…å±å±¥æ­´ï¼ˆstart_on/end_onï¼‰ã€å°±æ¥­è¦å‰‡åŒæ„
* **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ãƒ­ãƒ¼ãƒ«ï¼ˆUSER/ROLEï¼‰**ï¼šUserIDã€ãƒ­ã‚°ã‚¤ãƒ³IDã€2FAã€ãƒ­ãƒ¼ãƒ«ï¼ˆHQç®¡ç†/ã‚¨ãƒªã‚¢Mgr/åº—é•·/ã‚¹ã‚¿ãƒƒãƒ•/ç›£æŸ»/æ³•å‹™/è²¡å‹™ï¼‰ã€ç´°ç²’åº¦æ¨©é™ï¼ˆé–²è¦§/ä½œæˆ/ç·¨é›†/å‰Šé™¤/æ‰¿èªï¼‰
* **ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆGROUPï¼‰**ï¼šã‚¿ã‚¤ãƒ—ï¼ˆéƒ½é“åºœçœŒ/æ¥­å‹™/ã‚¤ãƒ™ãƒ³ãƒˆ/ã‚¹ã‚­ãƒ«ï¼‰ã€ãƒ¡ãƒ³ãƒãƒ¼å±¥æ­´ï¼ˆé–‹å§‹/çµ‚äº†ï¼‰

### D. å‹¤æ€ ãƒ»ã‚·ãƒ•ãƒˆãƒ»åŠ´å‹™

* **ã‚·ãƒ•ãƒˆ**ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ã€æ—¥åˆ¥ã‚·ãƒ•ãƒˆã€ä¼‘æ†©ã€äº¤ä»£ã€å½¹å‰²ï¼ˆãƒ¬ã‚¸/ã‚­ãƒƒãƒãƒ³/æ¸…æƒï¼‰
* **æ‰“åˆ»**ï¼šIN/OUTã€ä¿®æ­£ç†ç”±ã€æ‰¿èªè€…ã€æ·±å¤œ/æ³•å®šä¼‘æ—¥/æ®‹æ¥­ã®è‡ªå‹•è¨ˆç®—
* **ä¼‘æš‡**ï¼šç”³è«‹/æ‰¿èªã€æœ‰çµ¦/ç—…æ¬ /ç‰¹ä¼‘ã€ä»£ä¼‘ç®¡ç†
* **äººäº‹è©•ä¾¡**ï¼šKPI/OKRã€360ã€è©•ä¾¡æœŸé–“ã€è©•ä¾¡è€…/è¢«è©•ä¾¡è€…ã€çµæœã€æ˜‡æ ¼æ˜‡çµ¦å±¥æ­´
* **ç ”ä¿®/è³‡æ ¼**ï¼šè¡›ç”Ÿ/ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³/æ¥å®¢/ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã€å—è¬›å±¥æ­´ã€æœ‰åŠ¹æœŸé™

### E. å•†å“ãƒ»ãƒ¬ã‚·ãƒ”ãƒ»åœ¨åº«ï¼ˆå¤šæ®µBOMï¼‰

* **å•†å“ï¼ˆPRODUCTï¼‰**ï¼šSKUã€ã‚«ãƒ†ã‚´ãƒªã€è¦æ ¼ã€ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ã€è³å‘³/æ¶ˆè²»æœŸé™ã€ä¿ç®¡æ¡ä»¶ã€æ¨™æº–åŸä¾¡ã€åŸä¾¡æ”¹å®šå±¥æ­´ã€ãƒãƒ¼ã‚³ãƒ¼ãƒ‰
* **ãƒ¬ã‚·ãƒ”ï¼ˆBOMï¼‰**ï¼šè¦ªè£½å“ã€æ§‹æˆï¼ˆåŸææ–™/ä¸­é–“æã€ä½¿ç”¨é‡ã€æ­©ç•™ï¼‰ã€ä»•è¾¼ãƒ­ãƒƒãƒˆ
* **åœ¨åº«ãƒ­ãƒƒãƒˆï¼ˆSTOCK_LOTï¼‰**ï¼šãƒ­ãƒƒãƒˆIDã€å…¥åº«æ—¥ã€æœ‰åŠ¹æœŸé™ã€ä¿ç®¡å ´æ‰€ï¼ˆåº—èˆ—/å€‰åº«ï¼‰ã€æ•°é‡ã€å˜ä¾¡ã€è©•ä¾¡æ³•ï¼ˆå…ˆå…¥å…ˆå‡ºç­‰ï¼‰
* **ç™ºæ³¨/ä»•å…¥/æ¤œå**ï¼šç™ºæ³¨æ›¸ã€ä»•å…¥å…ˆã€ç´æœŸã€å…¥è·æ¤œåã€ä»•å…¥è«‹æ±‚/æ”¯æ‰•æœŸæ—¥
* **å»ƒæ£„/æ£šå¸**ï¼šå»ƒæ£„ç†ç”±ï¼ˆæœŸé™/ç ´æ/ä»•è¾¼å¤±æ•—ï¼‰ã€æ£šå¸å·®ç•°ã€åœ¨åº«è©•ä¾¡

### F. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ä¾¡æ ¼ãƒ»è²©ä¿ƒ

* **ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆMENU_ITEMï¼‰**ï¼šè¡¨ç¤ºåã€å•†å“ç´ã¥ã‘ã€ã‚µã‚¤ã‚º/ã‚ªãƒ—ã‚·ãƒ§ãƒ³
* **ä¾¡æ ¼ï¼ˆPRICEï¼‰**ï¼šæ¨™æº–/åº—èˆ—åˆ¥/æœŸé–“/æ™‚é–“å¸¯ã€ç¨åŒºåˆ†
* **ãƒ—ãƒ­ãƒ¢ï¼ˆPROMOTIONï¼‰**ï¼šã‚¯ãƒ¼ãƒãƒ³/ã‚»ãƒƒãƒˆ/æ™‚é–“å¸¯å‰²å¼•ã€é©ç”¨æ¡ä»¶ï¼ˆåº—èˆ—/æœŸé–“/å•†å“ç¾¤/ä¼šå“¡å±æ€§ï¼‰ã€é©ç”¨é™¤å¤–

### G. å£²ä¸Šï¼ˆPOSï¼‰ãƒ»æ±ºæ¸ˆ

* **å–å¼•ï¼ˆSALES_RECEIPTï¼‰**ï¼šå–å¼•IDã€æ—¥æ™‚ã€åº—èˆ—ã€æ‹…å½“ã€æ˜ç´°ï¼ˆå•†å“ã€æ•°é‡ã€å˜ä¾¡ã€å‰²å¼•ï¼‰ã€ç¨è¾¼/ç¨æŠœ/ç¨é¡ã€åœ¨åº«å¼•è½ãƒ­ãƒƒãƒˆã€åŸä¾¡ç®—å‡º
* **æ±ºæ¸ˆï¼ˆTENDERï¼‰**ï¼šç¾é‡‘/ã‚¯ãƒ¬ã‚«/QR/äº¤é€šç³»/å£²æ›ã€å¤–éƒ¨å–å¼•IDã€ä¸ä¿¡/å–æ¶ˆ/è¿”é‡‘
* **æ—¥æ¬¡ç²¾ç®—**ï¼šé‡£éŠ­ã€éä¸è¶³ã€å…¥é‡‘ç· ã‚ã€ç›£æŸ»ãƒ­ã‚°ã€ä¼ç¥¨ã‚¹ã‚­ãƒ£ãƒ³ãƒªãƒ³ã‚¯

### H. é¡§å®¢ãƒ»ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ï¼ˆä»»æ„ï¼‰

* **é¡§å®¢ï¼ˆCUSTOMERï¼‰**ï¼šé€£çµ¡å…ˆã€åŒæ„çŠ¶æ³ã€å¹´é½¢å±æ€§ï¼ˆæ·±å¤œè¦åˆ¶ï¼‰ã€NGãƒ•ãƒ©ã‚°
* **ä¼šå“¡/ãƒã‚¤ãƒ³ãƒˆ/ã‚¹ã‚¿ãƒ³ãƒ—**ï¼šç²å¾—/ä½¿ç”¨ã€å¤±åŠ¹ã€ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨
* **CS/å•ã„åˆã‚ã›**ï¼šè‹¦æƒ…/è¦æœ›ã€å¯¾å¿œå±¥æ­´ã€SLA

### I. å“è³ªãƒ»å®‰å…¨ãƒ»è¨­å‚™ä¿å…¨

* **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆï¼ˆINCIDENTï¼‰**ï¼šç¨®é¡ï¼ˆç•°ç‰©/ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³/åŠ´ç½/ã‚¯ãƒ¬ãƒ¼ãƒ ï¼‰ã€ç™ºç”Ÿæ—¥ã€åº—èˆ—ã€åŸå› ã€å¯¾å‡¦ã€å†ç™ºé˜²æ­¢ã€å ±å‘Šãƒ«ãƒ¼ãƒˆ
* **è¨­å‚™/è³‡ç”£ï¼ˆASSETï¼‰**ï¼šæ©Ÿå™¨ã€ã‚·ãƒªã‚¢ãƒ«ã€ä¿å®ˆå¥‘ç´„ã€ç‚¹æ¤œã€ä¿®ç†ã€ä¿é™º
* **æ¸…æƒ/æ¸©åº¦/HACCP**ï¼šæ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ã€é€¸è„±ã‚¢ãƒ©ãƒ¼ãƒˆ

### J. èª¿é”ãƒ»å–å¼•å…ˆ

* **å–å¼•å…ˆï¼ˆVENDORï¼‰**ï¼šä¼æ¥­IDã€ä¸ä¿¡ã€æ‹…å½“è€…ã€æ”¯æ‰•æ¡ä»¶ã€å¥‘ç´„ã€SLA
* **è¦‹ç©/å¥‘ç´„/è«‹æ±‚/æ”¯æ‰•**ï¼šé‡‘é¡ã€æœŸæ—¥ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### K. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

* **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆDOCUMENTï¼‰**ï¼šå¥‘ç´„æ›¸ã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã€æ‰‹é †æ›¸ã€ç‰ˆç®¡ç†
* **æ‰¿èªãƒ•ãƒ­ãƒ¼**ï¼šç”³è«‹â†’æ‰¿èªâ†’æ–½è¡Œã€å·®æˆ»ã—ã€æ¨©é™

### L. IT/ç›£æŸ»/ãƒ­ã‚®ãƒ³ã‚°

* **ç«¯æœ«/ãƒ©ã‚¤ã‚»ãƒ³ã‚¹/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ£šå¸**
* **ç›£æŸ»ãƒ­ã‚°ï¼ˆAUDITï¼‰**ï¼šèª°ãŒ/ä½•ã‚’/ã„ã¤/ã©ã“ã§
* **ãƒ‡ãƒ¼ã‚¿ä¿æŒ/å‰Šé™¤æ–¹é‡**ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/å¾©å…ƒ

### M. è²¡å‹™ãƒ»ä¼šè¨ˆï¼ˆæ‹¡å¼µï¼‰

* **ä»•è¨³/ç·å‹˜å®šå…ƒå¸³**ã€å‹˜å®šç§‘ç›®ã€æ¶ˆè²»ç¨åŒºåˆ†
* **å£²æ›/è²·æ›**ã€å…¥é‡‘/å‡ºé‡‘äºˆå®š
* **è³‡é‡‘ç¹°ã‚Šè¡¨**
* **å›ºå®šè³‡ç”£/æ¸›ä¾¡å„Ÿå´**

### N. æ³•å‹™ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼ˆæ‹¡å¼µï¼‰

* **æ³•è¦åˆ¶ãƒªã‚¹ãƒˆ**ï¼ˆæ·±å¤œå–¶æ¥­ã€é£Ÿå“è¡¨ç¤ºï¼‰
* **å•†æ¨™/çŸ¥è²¡**
* **äº‹æ•…/é•åå¯¾å¿œ**

### O. æ¡ç”¨ãƒ»äººäº‹ï¼ˆæ‹¡å¼µï¼‰

* **æ¡ç”¨**ï¼ˆæ±‚äººç¥¨ã€å¿œå‹Ÿè€…ã€é¢æ¥ã€å†…å®š/è¾é€€ï¼‰
* **ã‚ªãƒ³/ã‚ªãƒ•ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

---

## 2. ERãƒ¢ãƒ‡ãƒ«ï¼ˆMermaidï¼‰

### 2.1 æ¦‚å¿µERï¼ˆå…¨ä½“ï¼‰

```mermaid
erDiagram
  COMPANY ||--o{ DIVISION : has
  DIVISION ||--o{ STORE : contains
  COMPANY ||--o{ FRANCHISEE : partners_with
  FRANCHISEE ||--o{ FRANCHISE_CONTRACT : signs
  FRANCHISE_CONTRACT ||--|| STORE : governs

  PERSON ||--o{ EMPLOYMENT : engages
  STORE  ||--o{ EMPLOYMENT : hosts
  PERSON ||--o{ USER_ACCOUNT : authenticates
  USER_ACCOUNT ||--o{ USER_ROLE : maps
  ROLE ||--o{ USER_ROLE : includes

  GROUP ||--o{ GROUP_MEMBERSHIP : includes
  PERSON ||--o{ GROUP_MEMBERSHIP : joins

  ADDRESS ||--o{ ADDRESS_LINK : linked_to
  PERSON  ||--o{ ADDRESS_LINK : home
  STORE   ||--o{ ADDRESS_LINK : location

  VENDOR ||--o{ PURCHASE_ORDER : receives
  PURCHASE_ORDER ||--o{ PO_LINE : contains
  PRODUCT ||--o{ PO_LINE : requested
  PRODUCT ||--o{ BOM_COMPONENT : parent
  PRODUCT ||--o{ STOCK_LOT : batches
  STORE ||--o{ STOCK_LOT : stores

  MENU_ITEM ||--o{ PRICE : has
  PRODUCT ||--o{ MENU_ITEM : represents
  PROMOTION ||--o{ PROMO_APPLICABILITY : targets

  SALES_RECEIPT ||--o{ SALES_LINE : lines
  MENU_ITEM ||--o{ SALES_LINE : sold
  SALES_RECEIPT ||--o{ TENDER : paid_by
  CUSTOMER ||--o{ LOYALTY_ACCOUNT : owns
  LOYALTY_ACCOUNT ||--o{ SALES_RECEIPT : earns

  INCIDENT ||--o{ INCIDENT_PARTICIPANT : involves
  STORE ||--o{ INCIDENT : occurs_at
  PERSON ||--o{ INCIDENT_PARTICIPANT : involved

  ASSET ||--o{ MAINT_TICKET : has
  STORE ||--o{ ASSET : located_at

  DOCUMENT ||--o{ DOCUMENT_LINK : attached_to
  ANY_ENTITY ||--o{ DOCUMENT_LINK : polymorphic

  TRAINING ||--o{ TRAINING_HISTORY : tracks
  PERSON ||--o{ TRAINING_HISTORY : attends
  EVALUATION ||--o{ DOCUMENT_LINK : references

  AUDIT_LOG ||--o{ AUDIT_ITEM : details
```

### 2.2 è«–ç†ERï¼ˆä¸»è¦å±æ€§ä»˜ãï¼šæŠœç²‹ï¼‰

* `*_id`ï¼ˆUUID/ULIDï¼‰, `*_code`ï¼ˆäººé–“å¯èª­ï¼‰, `created_at/by`, `updated_at/by`, `active_flag`, `deleted_at/by` ã‚’å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…±é€šåˆ—ã¨ã™ã‚‹ã€‚

---

## 3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼š**ã‚·ãƒ¼ãƒˆæ§‹æˆã¨ã‚«ãƒ©ãƒ å®šç¾©**ï¼ˆå®Ÿè£…ç”¨ï¼‰

> ã™ã¹ã¦ã«å…±é€šã®æœ«å°¾åˆ—ï¼š`created_at, created_by, updated_at, updated_by, active_flag, deleted_at, deleted_by`

### 3.1 ãƒã‚¹ã‚¿ãƒ¼

* **MST_Company**ï¼š`company_id, company_code, name_legal, tax_profile, fiscal_year_start, bank_account_name, bank_account_no`
* **MST_Division**ï¼š`division_id, company_id, name, type(HQ/Area/Block), manager_person_id`
* **MST_Store**ï¼š`store_id, division_id, store_code, kind(Direct/FC), status, open_date, close_date, pos_terminal_id, warehouse_id, license_deepnight_expiry, health_office_name`
* **MST_Franchisee**ï¼š`franchisee_id, code, legal_name, rep_name, tel, email, billing_bank, credit_limit, insurance, antisocial_check(boolean), contract_drive_link`
* **MST_FranchiseContract**ï¼š`contract_id, franchisee_id, store_id, start_on, end_on, royalty_rate, fixed_fee, marketing_fee, pricing_control(boolean), asset_ownership, termination_clause, breach_history`
* **MST_Person**ï¼š`person_id, name_kanji, name_kana, name_romaji, birthdate, gender, phone, email, photo_link, emergency_contact, bank_account, consent_doc_link`
* **MST_Employment**ï¼š`employment_id, person_id, employment_type(HQ/STORE/CONSULTANT/TEMP), employment_form(FT/PT/CONTRACT), org_unit(HQ/STORE), store_id, title, start_on, end_on, is_primary(boolean)`
* **MST_UserAccount**ï¼š`user_id, person_id, login_id, two_factor(boolean), password_hint_hash, status`
* **MST_Role**ï¼š`role_id, role_code, role_name`
* **TRN_UserRole**ï¼š`user_role_id, user_id, role_id, start_on, end_on`
* **MST_Group**ï¼š`group_id, type(PREF/STORE/SKILL/TEAM), group_name, scope(filter_expression)`
* **TRN_GroupMember**ï¼š`group_member_id, group_id, person_id, start_on, end_on`
* **MST_Address**ï¼š`address_id, postal_code, prefecture_code, city, town, street, building, lat, lng`
* **LNK_Address**ï¼š`address_link_id, address_id, entity_type(PERSON/STORE), entity_id, start_on, end_on`
* **MST_Vendor**ï¼š`vendor_id, code, name, contact_name, tel, email, payment_terms, sla_link`
* **MST_Product**ï¼š`product_id, sku, name, category, unit, allergen, standard_cost, shelf_life_days, barcode`
* **BOM_Component**ï¼š`bom_id, parent_product_id, component_product_id, qty, yield_rate`
* **MST_MenuItem**ï¼š`menu_item_id, name_display, product_id, size, options_json`
* **MST_Price**ï¼š`price_id, menu_item_id, price, tax_code, start_on, end_on, store_id(optional), timeband(optional)`
* **MST_Promotion**ï¼š`promotion_id, name, type(COUPON/SET/TIMEBAND), start_on, end_on, rule_json`
* **LNK_PromoApplicability**ï¼š`promo_app_id, promotion_id, target_type(STORE/PRODUCT/CUSTOMER_SEG), target_id`
* **MST_Asset**ï¼š`asset_id, store_id, asset_type, maker, model, serial_no, warranty_until, maintenance_vendor_id`

### 3.2 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

* **TRN_PurchaseOrder**ï¼š`po_id, vendor_id, store_id, order_date, eta, status`
* **TRN_PO_Line**ï¼š`po_line_id, po_id, product_id, qty_ordered, unit_price`
* **TRN_StockLot**ï¼š`lot_id, product_id, store_id, received_on, expiry_on, qty, unit_cost`
* **TRN_StockMove**ï¼š`move_id, lot_id, from_loc, to_loc, qty, reason(RECV/SALE/ADJ/WASTE/COUNT), ref_id`
* **TRN_SalesReceipt**ï¼š`receipt_id, store_id, cashier_person_id, sold_at, subtotal, tax, total, external_txn_id`
* **TRN_SalesLine**ï¼š`line_id, receipt_id, menu_item_id, qty, unit_price, discount`
* **TRN_Tender**ï¼š`tender_id, receipt_id, method(CASH/CARD/QR/IC/AR), amount, auth_code`
* **TRN_Shift**ï¼š`shift_id, store_id, date, role, person_id, start_time, end_time`
* **TRN_TimeClock**ï¼š`clock_id, person_id, store_id, clock_in, clock_out, fix_reason, approved_by`
* **TRN_Leave**ï¼š`leave_id, person_id, type, start_on, end_on, status`
* **TRN_Incident**ï¼š`incident_id, store_id, type, occurred_at, severity, cause, action, followup_due`
* **TRN_IncidentParticipant**ï¼š`inc_part_id, incident_id, person_id, role`
* **TRN_MaintTicket**ï¼š`ticket_id, asset_id, opened_at, issue, priority, vendor_id, closed_at`
* **TRN_Document**ï¼š`doc_id, title, category, drive_link, version, owner_role`
* **LNK_Document**ï¼š`doc_link_id, doc_id, entity_type, entity_id`
* **TRN_AuditTrail**ï¼š`audit_id, user_id, ts, entity, entity_id, operation(CREATE/UPDATE/DELETE_SOFT/RESTORE), before_json, after_json`
* **TRN_AuditItem**ï¼š`audit_item_id, audit_id, column_name, before, after`

### 3.3 å‚ç…§ï¼ˆLKPï¼‰

* **LKP_Prefecture**ï¼š`prefecture_code, prefecture_name`
* **LKP_StoreKind**ï¼š`kind_code(Direct/FC)`
* **LKP_EmploymentType**ï¼š`code(HQ/STORE/CONSULTANT/TEMP)`
* **LKP_Role/LKP_Permission**ï¼š`role_code, permission_code`
* **LKP_ProductCategory/LKP_Tax/LKP_PaymentMethod/LKP_IncidentType/LKP_AssetType**

### 3.4 å…±é€šåˆ—ã®å®šç¾©

* `created_at`ï¼ˆISOï¼‰, `created_by`ï¼ˆuser_idï¼‰, `updated_at`, `updated_by`, `active_flag`ï¼ˆTRUEæ—¢å®šï¼‰, `deleted_at`, `deleted_by`

---

## 4. ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ»æ¡ä»¶ä»˜ãæ›¸å¼ï¼ˆä»£è¡¨ä¾‹ï¼‰

* **éƒ½é“åºœçœŒ**ï¼š`MST_Store.prefecture_code` ã¯ `LKP_Prefecture.prefecture_code` ã®ãƒªã‚¹ãƒˆé™å®š
* **æ—¥ä»˜æœŸé–“é‡è¤‡**ï¼šä¾¡æ ¼ãƒ»é…å±ãƒ»å¥‘ç´„ã¯ `COUNTIFS(id,=, start_on<=X, end_on>=X)` ã§é‡è¤‡æ¤œå‡º
* **ã‚¢ãƒ©ãƒ¼ãƒˆ**ï¼š

  * æœŸé™è­¦å‘Šï¼š`expiry_on <= TODAY()+7` â†’ é»„ã€`<= TODAY()` â†’ èµ¤
  * ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼š`active_flag=FALSE` â†’ æ–‡å­—è‰²ã‚°ãƒ¬ãƒ¼ï¼‹å–ã‚Šæ¶ˆã—ç·š

---

## 5. RBACï¼ˆãƒ­ãƒ¼ãƒ«Ã—æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ï¼šä¾‹ï¼‰

* **HQ_ADMIN**ï¼šå…¨è¡¨CRUDï¼‹æ‰¿èª
* **AREA_MANAGER**ï¼šé…ä¸‹åº—èˆ—ã®é–²è¦§/ç·¨é›†ã€æ‰¿èªä¸€éƒ¨
* **STORE_MANAGER**ï¼šè‡ªåº—èˆ—ã®äººãƒ»ã‚·ãƒ•ãƒˆãƒ»å£²ä¸Šãƒ»åœ¨åº«CRUD
* **STORE_STAFF**ï¼šè‡ªåˆ†ã®å‹¤æ€ ã€é–²è¦§é™å®š
* **HR**ï¼šäºº/é›‡ç”¨/è©•ä¾¡/ç ”ä¿®ã€å€‹äººæƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹
* **FINANCE**ï¼šå£²ä¸Š/ä¾¡æ ¼/è«‹æ±‚/ä¼šè¨ˆ
* **LEGAL**ï¼šå¥‘ç´„/ã‚³ãƒ³ãƒ—ãƒ©æ–‡æ›¸
* **AUDITOR**ï¼šå…¨è¡¨Readï¼‹ç›£æŸ»ãƒ­ã‚°Read

---

## 6. ä»£è¡¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ™‚ç³»åˆ—ï¼‰

1. **æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•å…¥ç¤¾**ï¼šPersonç™»éŒ²â†’é›‡ç”¨/é…å±â†’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ãƒ­ãƒ¼ãƒ«â†’ç ”ä¿®å‰²å½“â†’åˆå›ã‚·ãƒ•ãƒˆâ†’å‹¤æ€ ç¨¼åƒ
2. **åº—èˆ—æ–°è¦ã‚ªãƒ¼ãƒ—ãƒ³**ï¼šStoreç™»éŒ²â†’FCå¥‘ç´„â†’è³‡ç”£/è¨­å‚™â†’å•†å“/ä¾¡æ ¼â†’ç™ºæ³¨/åœ¨åº«â†’ãƒ¡ãƒ‹ãƒ¥ãƒ¼å…¬é–‹â†’POSç¨¼åƒ
3. **ä¾¡æ ¼æ”¹å®š**ï¼šæ–°PriceæœŸé–“ã§è¿½åŠ â†’é‡è¤‡æ¤œçŸ¥â†’æ‰¿èªâ†’è‡ªå‹•åæ˜ 
4. **ãƒ—ãƒ­ãƒ¢æœŸé–“é‹ç”¨**ï¼šPromotionä½œæˆâ†’é©ç”¨ç¯„å›²æŒ‡å®šâ†’POSé€£æºâ†’åŠ¹æœæ¸¬å®š
5. **é€€è·/ç•°å‹•**ï¼šEmploymentçµ‚äº†â†’Userç„¡åŠ¹â†’ã‚°ãƒ«ãƒ¼ãƒ—é™¤ç±â†’æ¨©é™å‰¥å¥ª

---

## 7. Apps Scriptï¼ˆå®Ÿè£…éª¨å­ï¼‰

### 7.1 å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

* `Config`: ã‚·ãƒ¼ãƒˆå/ã‚­ãƒ¼åˆ—ã®å®šæ•°
* `Uuid`: UUID/ULIDç”Ÿæˆ
* `Now`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆ
* `Sheets`: èª­å–/æ›¸è¾¼ã®è–„ã„ãƒ©ãƒƒãƒ‘ï¼ˆ`getRowsByIndex`, `appendRow`, `updateRowById`ï¼‰

### 7.2 ãƒªãƒã‚¸ãƒˆãƒªå±¤ï¼ˆæ±ç”¨ï¼‰

* `Repo.findById(table, id)`
* `Repo.query(table, filter)`ï¼ˆIndex/MATCHã§é«˜é€Ÿæ¤œç´¢ï¼‰
* `Repo.upsert(table, obj)`ï¼ˆæ–°è¦/æ›´æ–°è‡ªå‹•åˆ¤å®šã€`updated_*`ç®¡ç†ï¼‰
* `Repo.softDelete(table, id, user)`ï¼ˆ`active_flag=FALSE`ï¼‹`deleted_*`ï¼‰
* `Audit.log(user, entity, entity_id, op, before, after)`

### 7.3 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤

* `Validate.require(fields)`
* `Validate.inList(value, range)`ï¼ˆLKPæ¤œè¨¼ï¼‰
* `Validate.noOverlap(entity_id, start_on, end_on)`ï¼ˆæœŸé–“é‡è¤‡ï¼‰

### 7.4 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ä¾‹ï¼ˆPersonï¼‰

* `Person.create(payload)`ï¼šé‡è¤‡æ¤œçŸ¥ï¼ˆæ°åã‚«ãƒŠ+ç”Ÿå¹´æœˆæ—¥+é›»è©±ã®è¿‘ä¼¼ï¼‰â†’ç™»éŒ²â†’ç›£æŸ»
* `Person.update(id, patch)`ï¼šå·®åˆ†æŠ½å‡ºâ†’æ›´æ–°â†’ç›£æŸ»
* `Person.delete(id)`ï¼š`Repo.softDelete`â†’é–¢é€£ã®Employment/Accountã‚’çµ‚äº†

### 7.5 ç”»é¢APIï¼ˆKUROZUMIï¼‰

* `doGet(e)`ï¼šãƒ«ãƒ¼ã‚¿ï¼ˆStartâ†’ã‚«ãƒ†ã‚´ãƒªâ†’ä¸€è¦§â†’è©³ç´°ï¼‰
* `doPost(e)`ï¼šCRUDãƒãƒ³ãƒ‰ãƒ©ï¼ˆJSONï¼‰

---

## 8. UI/UXä»•æ§˜ï¼ˆIronmanÃ—AKIRAï¼‰

* **é…è‰²**ï¼šèƒŒæ™¯#0A0A0Aã€é¢#141414ã€ç·š#2A2A2Aã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆç™ºå…‰ï¼ˆã‚·ã‚¢ãƒ³ #00FFFF 10%ï¼‰
* **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ï¼šã‚«ãƒ¼ãƒ‰ã€ãƒ‰ãƒ­ãƒ¯ãƒ¼ã€ãƒãƒƒãƒ—ã€ãƒˆãƒ¼ã‚¹ãƒˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«
* **ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³**ï¼šã‚«ãƒ¼ãƒ‰æµ®éŠï¼ˆ300ms ease-outï¼‰ã€ä¿å­˜æˆåŠŸã¯æ·¡ã„ã‚°ãƒ­ãƒ¼
* **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼šã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”AAã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
* **ä¸€è¦§UI**ï¼šå·¦ï¼šã‚«ãƒ†ã‚´ãƒªã€å³ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã€‚ä¸Šéƒ¨ã«ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ï¼ˆä¾‹ï¼š`store=å¤§é˜ª AND role=å¤œå‹¤ AND active=TRUE`ï¼‰
* **ç·¨é›†UI**ï¼šå·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆbeforeâ†’afterï¼‰ã€å½±éŸ¿ä»¶æ•°ã®è¡¨ç¤º
* **å‰Šé™¤UI**ï¼šè¦æ—¨ï¼‹å½±éŸ¿ä»¶æ•°â†’äºŒæ®µç¢ºèªâ†’ã‚½ãƒ•ãƒˆå‰Šé™¤

---

## 9. KPI/ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå®šç¾©ï¼‰

* **å£²ä¸Š**ï¼šæ—¥/é€±/æœˆã€åº—èˆ—åˆ¥ã€å®¢å˜ä¾¡ã€å®¢æ•°ã€æ™‚é–“å¸¯åˆ¥
* **åŸä¾¡**ï¼šCOGS%ã€åœ¨åº«å›è»¢æ—¥æ•°ã€å»ƒæ£„ç‡
* **åŠ´å‹™**ï¼šå£²ä¸Šå¯¾äººä»¶è²»%ã€æ®‹æ¥­/æ·±å¤œæ™‚é–“ã€ã‚·ãƒ•ãƒˆéµå®ˆç‡
* **FC**ï¼šãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£å¾´åäºˆå®š/å®Ÿç¸¾ã€å¥‘ç´„æ›´æ–°ã‚¢ãƒ©ãƒ¼ãƒˆ
* **å“è³ª**ï¼šã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•°ã€å†ç™ºç‡ã€è§£æ±ºSLAéµå®ˆ

---

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

* **ã‚»ãƒ«ä¸Šé™**ï¼š1ã‚·ãƒ¼ãƒˆã‚ãŸã‚Š500ä¸‡ã‚»ãƒ«ã‚’æ„è­˜ã—ã€æœŸé–“ã§**ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–åˆ†å‰²**ï¼ˆå¹´åº¦åˆ¥ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
* **ãƒãƒƒãƒæ›´æ–°**ï¼š`Range.setValues()`ã§ã¾ã¨ã‚æ›¸ãã€`flush()`æœ€å°åŒ–
* **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ï¼š`CacheService`ã§LKPã‚„è¨­å®šã‚’çŸ­æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
* **ãƒšãƒ¼ã‚¸ãƒ³ã‚°**ï¼šä¸€è¦§ã¯100ä»¶å˜ä½ã€ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

---

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

* **PIIåˆ†é›¢**ï¼šæ©Ÿå¾®æƒ…å ±ï¼ˆãƒã‚¤ãƒŠãƒ³ãƒãƒ¼/å£åº§ï¼‰ã¯åˆ¥ãƒ–ãƒƒã‚¯ï¼ˆæ¨©é™é™å®šï¼‰
* **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**ï¼šã‚·ãƒ¼ãƒˆ/ç¯„å›²ä¿è­·ã€ãƒ“ãƒ¥ãƒ¼é™å®šãƒ•ã‚£ãƒ«ã‚¿
* **ãƒ­ã‚°**ï¼šå…¨æ“ä½œã‚’`TRN_AuditTrail`ã«ä¿å­˜ã€æ”¹ã–ã‚“æŠ‘æ­¢
* **ä¿æŒ**ï¼šæ³•ä»¤ã«å¿œã˜ãŸä¿æŒå¹´é™ã€å‰Šé™¤/åŒ¿ååŒ–æ‰‹é †

---

## 12. ç›£æŸ»/ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/DR

* **æ—¥æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**ï¼šApps Scriptã§è¤‡è£½â†’æ—¥ä»˜ä»˜ãã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
* **ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ**ï¼šæœˆæ¬¡ã§CRUDä»¶æ•°ã€å‰Šé™¤ä»¶æ•°ã€æ¨©é™å¤‰æ›´
* **å¾©å…ƒ**ï¼šã‚½ãƒ•ãƒˆå‰Šé™¤å¾©å…ƒã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‹ã‚‰ã®å·®åˆ†ãƒãƒ¼ã‚¸æ‰‹é †

---

## 13. å‘½åè¦ç´„/ã‚³ãƒ¼ãƒ‰ä½“ç³»

* ãƒ†ãƒ¼ãƒ–ãƒ«ï¼š`MST_*`ï¼ˆãƒã‚¹ã‚¿ãƒ¼ï¼‰ã€`TRN_*`ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã€`LKP_*`ï¼ˆå‚ç…§ï¼‰ã€`LNK_*`ï¼ˆå¤šæ…‹ãƒªãƒ³ã‚¯ï¼‰
* åˆ—åï¼š`snake_case`ã€æ—¥ä»˜`YYYY-MM-DD`ã€æ—¥æ™‚`ISO8601`
* ã‚³ãƒ¼ãƒ‰ï¼š`STORE YD-<PREF-3> - NNN`ã€`PERSON YD-P-ULID` ç­‰

---

## 14. å°å…¥è¨ˆç”»/ç§»è¡Œ

* **Phase 0**ï¼šLKPæ•´å‚™ã€å…±é€šåˆ—/ç›£æŸ»/UUIDã®å°å…¥
* **Phase 1**ï¼šPeople/Store/Contract/Price/Inventory
* **Phase 2**ï¼šPOS/Promotion/Shift/TimeClock
* **Phase 3**ï¼šHRï¼ˆè©•ä¾¡/ç ”ä¿®ï¼‰ã€å“è³ª/è¨­å‚™ã€ä¼šè¨ˆé€£æº
* **Phase 4**ï¼šBIï¼ˆLooker Studio, BigQueryï¼‰ã€é€šçŸ¥ï¼ˆChat/Emailï¼‰

---

## 15. ã‚ãªãŸã®æ—¢å­˜ãƒ–ãƒƒã‚¯ã¨ã®å·®åˆ†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

* Person/Employmentã®**åˆ†é›¢**ã¯æ¸ˆã¿ï¼Ÿ
* Group/GroupMemberã«ã‚ˆã‚‹**å±æ€§å¤šå€¤**ã¯ã‚ã‚‹ï¼Ÿ
* ä¾¡æ ¼ãƒ»é…å±ãƒ»å¥‘ç´„ã«**æœŸé–“åˆ—**ã¯ã‚ã‚‹ï¼Ÿ
* ç›£æŸ»ãƒ­ã‚°/ã‚½ãƒ•ãƒˆå‰Šé™¤ã®**å…±é€šåˆ—**ã¯å…¨è¡¨ã«ï¼Ÿ
* LKPå‚ç…§ã§**å…¥åŠ›åˆ¶é™**ã¯å¾¹åº•ï¼Ÿ
* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå£²ä¸Š/åœ¨åº«/å‹¤æ€ ï¼‰ã¯**å¹´åº¦åˆ†å‰²**è¨­è¨ˆï¼Ÿ

---

## 16. ä»˜éŒ²ï¼šMermaidã‚µãƒ–å›³ï¼ˆç”¨é€”åˆ¥ï¼‰

### 16.1 HR/å‹¤æ€ 

```mermaid
erDiagram
  PERSON ||--o{ EMPLOYMENT : has
  EMPLOYMENT ||--o{ SHIFT : schedules
  PERSON ||--o{ TIME_CLOCK : records
  PERSON ||--o{ TRAINING_HISTORY : attends
  PERSON ||--o{ EVALUATION : reviewed
```

### 16.2 åœ¨åº«/è³¼è²·

```mermaid
erDiagram
  VENDOR ||--o{ PURCHASE_ORDER : receives
  PURCHASE_ORDER ||--o{ PO_LINE : contains
  PRODUCT ||--o{ PO_LINE : requested
  PRODUCT ||--o{ STOCK_LOT : batches
  STOCK_LOT ||--o{ STOCK_MOVE : moves
  STORE ||--o{ STOCK_LOT : stores
```

### 16.3 å£²ä¸Š/è²©ä¿ƒ

```mermaid
erDiagram
  MENU_ITEM ||--o{ PRICE : priced
  PROMOTION ||--o{ PROMO_APPLICABILITY : targets
  SALES_RECEIPT ||--o{ SALES_LINE : includes
  SALES_RECEIPT ||--o{ TENDER : paid_by
```

---

### å‚™è€ƒ

* ã”æŒ‡å®šã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆURLï¼‰ã¯å¤–éƒ¨ã‹ã‚‰ä¸­èº«ã‚’ç›´æ¥å‚ç…§ã§ããªã„ãŸã‚ã€æœ¬ä»•æ§˜ã¨**æ¨å¥¨ã‚·ãƒ¼ãƒˆä¸€è¦§**ã‚’åŸºã«å·®åˆ†ã‚’æ¤œå‡ºã—ã¦ãã ã•ã„ã€‚å¿…è¦ã«å¿œã˜ã€åˆ—è¿½åŠ /çµ±åˆ/å‰Šé™¤ã®**å…·ä½“çš„ãªå¤‰æ›´æ‰‹é †**ã‚‚æç¤ºã—ã¾ã™ã€‚
* æ¬¡ã®å‡ºåŠ›å€™è£œï¼š**åˆ—å®šç¾©CSV**ã€**Apps Scriptå…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é››å½¢**ï¼ˆ`Repo`, `Audit`, `Validate`ï¼‰ã€**æ¡ä»¶ä»˜ãæ›¸å¼ãƒ«ãƒ¼ãƒ«JSON**ã€**Looker Studioç”¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å®šç¾©**ã€‚

---

## 17. MPAï¼ˆMultiâ€‘Page Appï¼‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ â€” **æˆ»ã‚‹ãƒœã‚¿ãƒ³å¸¸è¨­**

> KUROZUMIãƒ•ãƒ­ãƒ³ãƒˆã¯**å¸¸ã«æˆ»ã‚‹ï¼ˆBackï¼‰**ã‚’æä¾›ã™ã‚‹ã€‚å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä¿æŒã—ã€ä¸€è¦§â†’è©³ç´°â†’ç·¨é›†â†’ç¢ºèª ã¨é·ç§»ã—ã¦ã‚‚ã€**1ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ç›´å‰ã®ç”»é¢ã«å¾©å¸°**ã§ãã‚‹ã€‚ãƒ–ãƒ©ã‚¦ã‚¶æˆ»ã‚‹ã¨æ•´åˆã€‚

### 17.1 ä»•æ§˜ï¼ˆå¿…é ˆï¼‰

* ã™ã¹ã¦ã®æ©Ÿèƒ½ç”»é¢ï¼ˆStart/ã‚«ãƒ†ã‚´ãƒª/ä¸€è¦§/è©³ç´°/ç·¨é›†/ç¢ºèª/æ‰¿èª/ç›£æŸ»ï¼‰ã«**å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼Back**ã‚’è¡¨ç¤º
* **å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯**ï¼š`UI_History`ï¼ˆinâ€‘memoryï¼‰ã§ç›´è¿‘Nä»¶ï¼ˆæ—¢å®š50ï¼‰
* **å¾©å¸°æ™‚ã®çŠ¶æ…‹**ï¼šæ¤œç´¢æ¡ä»¶/ãƒšãƒ¼ã‚¸ãƒ³ã‚°/ã‚½ãƒ¼ãƒˆ/é¸æŠè¡Œ/ãƒ‰ãƒ­ãƒ¯ãƒ¼é–‹é–‰ã‚’å¾©å…ƒ
* **å·®åˆ†ä¿è­·**ï¼šæœªä¿å­˜ç·¨é›†ãŒã‚ã‚‹å ´åˆã¯ã‚¬ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰
* **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼š`Esc=é–‰ã˜ã‚‹`, `Alt+â†=Back` ã‚’ã‚µãƒãƒ¼ãƒˆ

### 17.2 ä»•æ§˜ï¼ˆä»»æ„å¼·åŒ–ï¼‰

* **ãƒ‘ãƒ³ããšï¼ˆBreadcrumbï¼‰**å›ºå®šè¡¨ç¤ºï¼šStart â€º ã‚«ãƒ†ã‚´ãƒª â€º ä¸€è¦§ â€º è©³ç´°ï¼ˆIDï¼‰
* **æ·±ãƒªãƒ³ã‚¯**ï¼šä»»æ„ã®è©³ç´°URLã§ç›´æ¥é·ç§»ã€Backã¯1å±¤ä¸Šã¸
* **ãƒŠãƒ“ç›£æŸ»**ï¼šç”»é¢é·ç§»ãƒ­ã‚°ã‚’è¨˜éŒ²ï¼ˆèª°ãŒ/ã„ã¤/ã©ã“â†’ã©ã“ï¼‰

### 17.3 ç”»é¢ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼‰

* `NAV_PUSH(route, params)`ï¼šå±¥æ­´ã¸ç©ã‚€
* `NAV_REPLACE(route, params)`ï¼šç¾åœ¨ã‚’ç½®æ›
* `NAV_BACK()`ï¼š1ã¤æˆ»ã‚‹ï¼ˆå±¥æ­´ãŒç©ºãªã‚‰Startã¸ï¼‰
* `NAV_RESET(to="Start")`ï¼šåˆæœŸåŒ–

---

## 18. UI/ãƒŠãƒ“é–¢é€£ ERæ‹¡å¼µï¼ˆMermaidï¼‰

> UIã¯é€šå¸¸ãƒ‡ãƒ¼ã‚¿ERå¤–ã ãŒã€**ç›£æŸ»å¯èƒ½æ€§**ã¨**ãƒ‡ãƒ¼ã‚¿é§†å‹•ãƒŠãƒ“**ã®ãŸã‚æœ€å°é™ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã€‚

```mermaid
erDiagram
  USER_ACCOUNT ||--o{ UI_SESSION : starts
  UI_SESSION ||--o{ UI_NAV_LOG : records
  ROLE ||--o{ UI_ROUTE_ACCESS : grants
  UI_ROUTE ||--o{ UI_ROUTE_ACCESS : controls
  UI_ROUTE ||--o{ UI_BREADCRUMB : shows

  UI_ROUTE {
    string route_id
    string path            // /people, /store/:id, etc.
    string title           // ä¸€è¦§/è©³ç´°/ç·¨é›†
    string category        // People, Store, POS...
    boolean is_modal       // ãƒ‰ãƒ­ãƒ¯ãƒ¼/ãƒ¢ãƒ¼ãƒ€ãƒ«
    boolean keep_state     // å¾©å¸°æ™‚ã«çŠ¶æ…‹ä¿æŒ
    boolean active_flag
  }
  UI_ROUTE_ACCESS {
    string route_access_id
    string route_id
    string role_id
    boolean can_view
    boolean can_edit
    boolean can_approve
  }
  UI_BREADCRUMB {
    string breadcrumb_id
    string route_id
    string label
    integer order_index
  }
  UI_SESSION {
    string ui_session_id
    string user_id
    datetime started_at
    datetime ended_at
  }
  UI_NAV_LOG {
    string nav_log_id
    string ui_session_id
    string from_route_id
    string to_route_id
    string params_json
    datetime navigated_at
  }
```

**ãƒã‚¤ãƒ³ãƒˆ**

* **Backãƒœã‚¿ãƒ³**ã¯ `UI_SESSION` å†…ã®å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã§å³æ™‚å¾©å¸°ã€‚ãƒ­ã‚°ã¯ `UI_NAV_LOG` ã«æ®‹ã—ã€ç›£æŸ»/UXæ”¹å–„ã«æ´»ç”¨ã€‚
* ãƒ«ãƒ¼ãƒˆã¨æ¨©é™ã‚’ `UI_ROUTE`Ã—`UI_ROUTE_ACCESS` ã§ãƒ‡ãƒ¼ã‚¿é§†å‹•ã«ã™ã‚Œã°ã€**ç”»é¢ã®å‡ºã—åˆ†ã‘**ã‚„**A/Bæ¤œè¨¼**ãŒå®¹æ˜“ã€‚

---

## 19. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿ â€” è¿½åŠ ã‚·ãƒ¼ãƒˆã¯å¿…è¦ï¼Ÿ

**çµè«–ã‚’å…ˆã«**ï¼š

* **æœ€å°æ§‹æˆï¼ˆæ¨å¥¨ï¼‰**ï¼š**è¿½åŠ ä¸è¦**ã€‚Backã¯ãƒ•ãƒ­ãƒ³ãƒˆï¼ˆKUROZUMIï¼‰å´ã®ãƒ¡ãƒ¢ãƒªå±¥æ­´ã§è³„ã„ã€æ—¢å­˜ã® `TRN_AuditTrail` ã«æ“ä½œç›£æŸ»ã‚’æ®‹ã›ã°ååˆ†ã€‚**ã„ã¾ã®è¡¨æ§‹æˆã®ã¾ã¾ã§OK**ã€‚
* **æ‹¡å¼µæ§‹æˆï¼ˆãƒŠãƒ“ã‚’ãƒ‡ãƒ¼ã‚¿é§†å‹•ï¼‹å¯è¦³æ¸¬åŒ–ï¼‰**ï¼šä»¥ä¸‹**4ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ **ã™ã‚‹ã¨é‹ç”¨é«˜åº¦åŒ–ãŒå¯èƒ½ã€‚

### 19.1 è¿½åŠ ãŒæœ‰åŠ¹ãªã‚·ãƒ¼ãƒˆï¼ˆä»»æ„ï¼‰

* `MST_UiRoute`ï¼š`route_id, path, title, category, is_modal, keep_state, active_flag, created_*, updated_*`
* `TRN_UiNavLog`ï¼š`nav_log_id, ui_session_id, from_route_id, to_route_id, params_json, navigated_at, user_id`
* `MST_UiRouteAccess`ï¼š`route_access_id, route_id, role_id, can_view, can_edit, can_approve`
* `MST_UiBreadcrumb`ï¼š`breadcrumb_id, route_id, label, order_index`

> **ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ**
>
> * **ã‚¹ãƒ”ãƒ¼ãƒ‰å„ªå…ˆï¼ã‚·ãƒ³ãƒ—ãƒ«**ï¼š**è¿½åŠ ãªã—**ï¼ˆæœ€å°æ§‹æˆï¼‰ã€‚
> * **ç›£æŸ»/KPI/é‹ç”¨è¨­è¨ˆã‚’å¼·åŒ–**ï¼šä¸Šè¨˜4ã‚·ãƒ¼ãƒˆã‚’**è¿½åŠ **ï¼ˆæ‹¡å¼µæ§‹æˆï¼‰ã€‚

### 19.2 æ—¢å­˜è¡¨ã¨ã®æ•´åˆ

* æ—¢å­˜ã® `MST_Role`/`TRN_UserRole` ã¨ `MST_UiRouteAccess` ã‚’é€£æºï¼ˆRBACä¸€å…ƒåŒ–ï¼‰
* æ—¢å­˜ã® `TRN_AuditTrail` ã¯**æ¥­å‹™ãƒ‡ãƒ¼ã‚¿**ã®ç›£æŸ»ã€`TRN_UiNavLog` ã¯**ç”»é¢é·ç§»**ã®ç›£æŸ»ã§ç”¨é€”åˆ†é›¢

---

## 20. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆBackãƒœã‚¿ãƒ³ï¼‰

* **çŠ¶æ…‹å¾©å…ƒã‚­ãƒ¼**ï¼š`route_key = path + canonical(params)`
* **ä¿å­˜å¯¾è±¡**ï¼šæ¤œç´¢æ¡ä»¶ã€ãƒšãƒ¼ã‚¸ã€ã‚½ãƒ¼ãƒˆã€é¸æŠIDã€ãƒ‰ãƒ­ãƒ¯ãƒ¼çŠ¶æ…‹
* **æœªä¿å­˜è­¦å‘Š**ï¼š`beforeunload`ï¼‹ã‚¢ãƒ—ãƒªå†…ã‚¬ãƒ¼ãƒ‰ã®äºŒé‡åŒ–
* **æ·±ãƒªãƒ³ã‚¯æ•´åˆ**ï¼šURLâ†’çŠ¶æ…‹å†æ§‹ç¯‰ï¼ˆå­˜åœ¨ã—ãªã„IDã¯404â†’ä¸€è¦§ã¸ï¼‰

---

## 21. å¤‰æ›´ã‚µãƒãƒªï¼ˆã‚ãªãŸã®ä¾é ¼ã‚’åæ˜ ï¼‰

* **æˆ»ã‚‹ãƒœã‚¿ãƒ³å¸¸è¨­**ã‚’MPAå‰æã«è¿½åŠ ã—ã€**UI/ãƒŠãƒ“ER**ã‚’æ‹¡å¼µ
* **ã‚·ãƒ¼ãƒˆè¿½åŠ ã®è¦å¦**ã‚’æ˜ç¤ºï¼šæœ€å°ï¼**è¿½åŠ ä¸è¦**ï¼æ‹¡å¼µï¼**4è¡¨è¿½åŠ **
* æ—¢å­˜ã®å®Œå…¨ä»•æ§˜ï¼ˆç®¡ç†é …ç›®/ER/ç‰©ç†å®šç¾©/CRUD/ç›£æŸ»/UXç­‰ï¼‰ã¯**ä¿æŒ**ã—ä¸Šè¨˜ã‚’**ä¸Šæ›¸ãã›ãšè¿½åŠ **

---

# GitHubå‘ã‘ README.mdï¼ˆMPAÃ—GASÃ—Sheetsï¼ãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆï¼‰

> ã“ã®READMEã¯ã€å¤œãƒ‰ãƒ¼ãƒŠãƒ„ FC æœ¬ç¤¾ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’**ç·åˆ·æ–°ãƒ»ãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒ**ã§å®Ÿè£…ã™ã‚‹ãŸã‚ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ä»•æ§˜ã‚’ã€é–‹ç™ºè€…ãƒ»é‹ç”¨è€…ãƒ»ç›£æŸ»æ‹…å½“ãƒ»ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãŒ**åŒã˜åœ°å›³**ã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ç·¨é›†ã—ãŸã‚‚ã®ã§ã™ã€‚**MPAï¼ˆMultiâ€‘Page Appï¼‰ï¼‹ Google Apps Scriptï¼ˆGASï¼‰ï¼‹ Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ**ã‚’åŸºç›¤ã¨ã—ã€**å¸¸æ™‚Backãƒœã‚¿ãƒ³**ãƒ»**ã‚½ãƒ•ãƒˆå‰Šé™¤**ãƒ»**å®Œå…¨ç›£æŸ»**ãƒ»**ãƒ‡ãƒ¼ã‚¿é§†å‹•RBAC**ã‚’ä¸­æ ¸ã«æ®ãˆã¾ã™ã€‚IronmanÃ—AKIRAã®**ãƒ¢ãƒãƒˆãƒ¼ãƒ³ãƒ»ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯**UIã§ã€**ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ãªãŒã‚‰ç°¡å˜ã«æ‰±ãˆã‚‹**ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

---

## ğŸ§­ 0. TL;DR

* **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ï¼šMPAï¼ˆKUROZUMIãƒ•ãƒ­ãƒ³ãƒˆï¼‰ + GASï¼ˆBackendï¼‰ + Google Sheetsï¼ˆDBï¼‰
* **æˆ»ã‚‹ãƒœã‚¿ãƒ³**ï¼šå…¨ç”»é¢å¸¸è¨­ã€å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã§çŠ¶æ…‹å¾©å…ƒ
* **ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ**ï¼šå˜ä¸€Personã€æœŸé–“æ•´åˆã€UUIDã€LKPæ­£è¦åŒ–ã€ã‚½ãƒ•ãƒˆå‰Šé™¤ã€ç›£æŸ»
* **ER**ï¼šPeople/Store/FCå¥‘ç´„/åœ¨åº«/å£²ä¸Š/å‹¤æ€ /å“è³ª/è¨­å‚™/æ³•å‹™/ä¼šè¨ˆã¾ã§ãƒ•ãƒ«
* **Sheetsè¿½åŠ è¦å¦**ï¼šæœ€å°ï¼**è¿½åŠ ä¸è¦**ï¼æ‹¡å¼µï¼UIãƒŠãƒ“ç”¨**4è¡¨ã‚’è¿½åŠ å¯**

---

## ğŸ“¦ 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ« & ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

```
repo-root/
  â”œâ”€ README.md                  # æœ¬æ›¸
  â”œâ”€ docs/
  â”‚   â”œâ”€ er/                    # Mermaidå›³ï¼ˆ.mdï¼‰
  â”‚   â”œâ”€ ux/                    # ãƒ¯ã‚¤ãƒ¤/ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰
  â”‚   â””â”€ ops/                   # é‹ç”¨ãƒ»ç›£æŸ»ãƒ»DRæ‰‹é †
  â”œâ”€ gas/
  â”‚   â”œâ”€ appsscript.json        # GASãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
  â”‚   â”œâ”€ main.js                # ãƒ«ãƒ¼ã‚¿ doGet/doPostï¼ˆâ€»å®Ÿè£…ã¯åˆ¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
  â”‚   â”œâ”€ repo.js                # Repo.*ï¼ˆCRUDãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
  â”‚   â”œâ”€ audit.js               # Audit.log å…±é€š
  â”‚   â”œâ”€ validate.js            # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å…±é€š
  â”‚   â””â”€ config.js              # ã‚·ãƒ¼ãƒˆåãƒ»åˆ—å®šæ•°
  â”œâ”€ sheets/
  â”‚   â”œâ”€ schema-csv/            # å„ã‚·ãƒ¼ãƒˆã®åˆ—å®šç¾©CSV
  â”‚   â””â”€ rules/                  # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼/æ¡ä»¶ä»˜ãæ›¸å¼ã®å®šç¾©
  â”œâ”€ ops/
  â”‚   â”œâ”€ backup-restore.md      # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/å¾©å…ƒ
  â”‚   â”œâ”€ security-privacy.md    # PIIåˆ†é›¢/ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
  â”‚   â””â”€ rbac-matrix.md         # å½¹å‰²Ã—æ¨©é™
  â””â”€ .github/
      â””â”€ ISSUE_TEMPLATE.md
```

> â€»å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã¯æœ¬READMEã§ã¯è©³ç´°æ²è¼‰ã—ã¾ã›ã‚“ï¼ˆæœ¬è¦ä»¶ã€Œã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã—ã€ã«æº–æ‹ ï¼‰ã€‚ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹/ãƒ‡ãƒ¼ã‚¿ä»•æ§˜/é‹ç”¨è¦ç¨‹ã‚’ä¸­å¿ƒã«è¨˜è¿°ã—ã¾ã™ã€‚

---

## ğŸ› 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

* **MPA**ï¼šStart â†’ ã‚«ãƒ†ã‚´ãƒª â†’ ä¸€è¦§ â†’ è©³ç´° â†’ ç·¨é›†/æ‰¿èª â†’ ç›£æŸ»ã€‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã«**Backå›ºå®š**ã€‚
* **GAS**ï¼šãƒ«ãƒ¼ã‚¿ï¼ˆ`doGet`/`doPost`ï¼‰ã¨ã€`Repo`/`Validate`/`Audit`ã®å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§**ä¸€æšå²©ã®åˆ¶å¾¡ç‚¹**ã€‚
* **Sheets**ï¼š`MST_*`ï¼ˆãƒã‚¹ã‚¿ãƒ¼ï¼‰ã€`TRN_*`ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã€`LKP_*`ï¼ˆå‚ç…§ï¼‰ã€`LNK_*`ï¼ˆå¤šæ…‹ãƒªãƒ³ã‚¯ï¼‰ã€‚**UUIDï¼‹äººé–“å¯èª­ã‚³ãƒ¼ãƒ‰**ã€**ã‚½ãƒ•ãƒˆå‰Šé™¤**ã€**æœŸé–“ç®¡ç†**ã€**ç›£æŸ»**ã€‚

---

## ğŸ”™ 3. MPAãƒŠãƒ“ï¼ˆBackå¸¸è¨­ï¼‰

* **ä»•æ§˜**ï¼šå›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼Backã€å±¥æ­´N=50ã€çŠ¶æ…‹å¾©å…ƒï¼ˆæ¤œç´¢/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ/é¸æŠ/ãƒ‰ãƒ­ãƒ¯ãƒ¼ï¼‰ã€‚
* **æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰**ï¼šç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‚
* **æ·±ãƒªãƒ³ã‚¯**ï¼šURLç›´å©ãæ•´åˆã€404â†’ä¸€è¦§ã€‚
* **ãƒŠãƒ“ç›£æŸ»**ï¼š`TRN_UiNavLog`ï¼ˆæ‹¡å¼µæ§‹æˆï¼‰ã§è¿½è·¡ã€‚

**ERæ‹¡å¼µï¼ˆUIï¼‰**ï¼š`UI_ROUTE`/`UI_ROUTE_ACCESS`/`UI_BREADCRUMB`/`UI_SESSION`/`UI_NAV_LOG`ï¼ˆMermaidã¯æœ¬ä»•æ§˜æ›¸ ç¬¬18ç« å‚ç…§ï¼‰ã€‚

---

## ğŸ—‚ 4. ç®¡ç†ãƒ‰ãƒ¡ã‚¤ãƒ³ & ERå›³

* **å®Œå…¨ç‰ˆER**ï¼š`docs/er/system.md` ã«Mermaidè¨˜æ³•ã§æ ¼ç´ï¼ˆæœ¬ä»•æ§˜ ç¬¬2ç« ã®å›³ã¨åŒä¸€ï¼‰ã€‚
* **ã‚µãƒ–å›³**ï¼šHR/åœ¨åº«/å£²ä¸Š/ãƒ—ãƒ­ãƒ¢ã‚’åˆ†å‰²é…ç½®ï¼ˆæœ¬ä»•æ§˜ ç¬¬16ç« ï¼‰ã€‚

---

## ğŸ“‘ 5. Sheets ã‚¹ã‚­ãƒ¼ãƒï¼ˆå¿…é ˆ/ä»»æ„ï¼‰

* **å¿…é ˆ**ï¼šæœ¬ä»•æ§˜ ç¬¬3ç«  `MST_* / TRN_* / LKP_* / LNK_*` ã‚’ãã®ã¾ã¾æ¡ç”¨
* **ä»»æ„ï¼ˆæ‹¡å¼µï¼‰**ï¼šUIãƒŠãƒ“ã®è¦³æ¸¬ãƒ»åˆ¶å¾¡ã‚’å¼·åŒ–ã™ã‚‹**4è¡¨**

  * `MST_UiRoute(route_id, path, title, category, is_modal, keep_state, active_flag, created_*, updated_*)`
  * `MST_UiRouteAccess(route_access_id, route_id, role_id, can_view, can_edit, can_approve)`
  * `MST_UiBreadcrumb(breadcrumb_id, route_id, label, order_index)`
  * `TRN_UiNavLog(nav_log_id, ui_session_id, from_route_id, to_route_id, params_json, navigated_at, user_id)`

> **FAQ**ï¼šè¿½åŠ ã¯å¿…è¦ï¼Ÿ â†’ **æœ€å°æ§‹æˆãªã‚‰ä¸è¦**ã€‚æ‹¡å¼µé‹ç”¨ãªã‚‰ä¸Šè¨˜4è¡¨ã‚’è¿½åŠ æ¨å¥¨ã€‚

---

## ğŸ§° 6. ãƒ‡ãƒ¼ã‚¿é‹ç”¨åŸå‰‡

* **ã‚½ãƒ•ãƒˆå‰Šé™¤**ï¼š`active_flag=FALSE, deleted_at/by`ã€‚UIã¯éè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€‚ç‰©ç†å‰Šé™¤ã¯ç®¡ç†è€…ã®ã¿ã€‚
* **ç›£æŸ»**ï¼š`TRN_AuditTrail` ã« `who/when/what(beforeâ†’after)` ã‚’å…¨æ“ä½œè‡ªå‹•è¨˜éŒ²ã€‚
* **æœŸé–“æ•´åˆ**ï¼šä¾¡æ ¼/å¥‘ç´„/é…å±ã¯é‡è¤‡æ¤œçŸ¥ï¼ˆCOUNTIFSï¼‰ã‚’æ¨™æº–åŒ–ã€‚
* **å…¥åŠ›æ¤œè¨¼**ï¼šLKPå‚ç…§ã€éƒµä¾¿â†’ä½æ‰€è£œå®Œã€å¿…é ˆãƒ»å‹æ¤œè¨¼ã€‚

---

## ğŸ¨ 7. UI/UXï¼ˆIronmanÃ—AKIRAï¼‰

* **ãƒˆãƒ¼ãƒ³**ï¼šãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼‹å¾®ç™ºå…‰ã€‚è§’ä¸¸2xlã€ã‚½ãƒ•ãƒˆã‚·ãƒ£ãƒ‰ã‚¦ã€æµ®éŠãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
* **ä¸€è¦§**ï¼šå·¦ãƒŠãƒ“ï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰Ã— å³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ä»˜ï¼‰ã€‚
* **è©³ç´°**ï¼šãƒ‰ãƒ­ãƒ¯ãƒ¼ç·¨é›†ã€ä¿å­˜æ™‚å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆã€å½±éŸ¿ä»¶æ•°æç¤ºã€‚
* **å‰Šé™¤**ï¼šè¦æ—¨ï¼‹å½±éŸ¿ä»¶æ•°â†’äºŒæ®µç¢ºèªâ†’ã‚½ãƒ•ãƒˆå‰Šé™¤ã€‚
* **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼šAAã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œæ¨™æº–ã€‚

---

## ğŸ” 8. RBAC

* å½¹å‰²ä¾‹ï¼š`HQ_ADMIN / AREA_MANAGER / STORE_MANAGER / STORE_STAFF / HR / FINANCE / LEGAL / AUDITOR`
* ãƒ«ãƒ¼ãƒˆã”ã¨ã®å¯è¦–ãƒ»ç·¨é›†ãƒ»æ‰¿èªã¯ `MST_UiRouteAccess`ï¼ˆæ‹¡å¼µæ™‚ï¼‰ã¾ãŸã¯ã‚¢ãƒ—ãƒªæ§‹æˆã§ç®¡ç†ã€‚

---

## ğŸ”„ 9. ä»£è¡¨ãƒ•ãƒ­ãƒ¼

1. å…¥ç¤¾â†’é…å±â†’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆâ†’ç ”ä¿®â†’ã‚·ãƒ•ãƒˆâ†’å‹¤æ€ 
2. åº—èˆ—ã‚ªãƒ¼ãƒ—ãƒ³â†’å¥‘ç´„â†’è³‡ç”£â†’å•†å“/ä¾¡æ ¼â†’åœ¨åº«â†’POS
3. ä¾¡æ ¼æ”¹å®šâ†’æ‰¿èªâ†’åæ˜ 
4. ãƒ—ãƒ­ãƒ¢é‹ç”¨â†’åŠ¹æœæ¸¬å®š
5. é€€è·/ç•°å‹•â†’æ¨©é™å‰¥å¥ª

---

## ğŸ§ª 10. å“è³ªä¿è¨¼

* **ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ**ï¼šé‡è¤‡ãƒ»æœŸé–“ãƒ»å‚ç…§æ•´åˆã‚¿ã‚¹ã‚¯ã‚’æ—¥æ¬¡å®Ÿè¡Œï¼ˆGASãƒˆãƒªã‚¬ï¼‰
* **ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ**ï¼šCRUDä»¶æ•°/å‰Šé™¤ä»¶æ•°/æ¨©é™å¤‰æ›´ã®æœˆæ¬¡å‡ºåŠ›
* **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**ï¼šæ—¥æ¬¡è¤‡è£½ã€ä¸–ä»£ç®¡ç†ã€ãƒªã‚¹ãƒˆã‚¢æ‰‹é †ã‚’ ops/ ã«æ•´å‚™

---

## ğŸš€ 11. å°å…¥ã‚¹ãƒ†ãƒƒãƒ—

* **Phase 0**ï¼šLKPæ•´å‚™ï¼‹å…±é€šåˆ—å°å…¥
* **Phase 1**ï¼šPeople/Store/Contract/Price/Inventory
* **Phase 2**ï¼šPOS/Promotion/Shift/TimeClock
* **Phase 3**ï¼šHR/å“è³ª/è¨­å‚™/ä¼šè¨ˆé€£æº
* **Phase 4**ï¼šBI/é€šçŸ¥ãƒ»ãƒŠãƒ“ãƒ­ã‚°ï¼ˆæ‹¡å¼µï¼‰

---

## ğŸ“ 12. æ—¢å­˜ãƒ–ãƒƒã‚¯ã¨ã®æ¥ç¶š

* æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«**ç™»éŒ²æƒ…å ±ã‚’ç´ã¥ã‘ã¦å—ã‘æ¸¡ã—**ã€‚å‰Šé™¤ã¯**ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼ˆæ¨å¥¨ï¼‰**ã€ã©ã†ã—ã¦ã‚‚ç‰©ç†å‰Šé™¤ãŒå¿…è¦ãªå ´åˆã¯ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‹ã‚‰ã®ã¿å®Ÿè¡Œã—ã€UIã‹ã‚‰ã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ/éè¡¨ç¤ºã¨ã™ã‚‹ã€‚
* **è¿½åŠ ãŒå¿…è¦ãªã‚¿ãƒ–**ï¼šæœ€å°æ§‹æˆã¯**è¿½åŠ ä¸è¦**ã€‚æ‹¡å¼µæ§‹æˆã¯ `MST_UiRoute / MST_UiRouteAccess / MST_UiBreadcrumb / TRN_UiNavLog` ã‚’è¿½åŠ ã€‚

---

## ğŸ¤ 13. è²¢çŒ®ãƒ«ãƒ¼ãƒ«

* ä»•æ§˜æ›´æ–°ã¯ PR ã§ `docs/` ã®ER/UX/opsã‚’å…ˆã«ä¿®æ­£ â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èªå¾Œã€å®Ÿè£…ã‚¿ã‚¹ã‚¯ã‚’èµ·ç¥¨ã€‚
* å‘½åãƒ»å‹ãƒ»å…±é€šåˆ—ã®é€¸è„±ã¯ä¸å¯ã€‚æ–°è¡¨è¿½åŠ ã¯ã‚¢ãƒ¼ã‚­ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆã€‚

---

## ğŸ›¡ 14. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

* PIIã¯åˆ¥ãƒ–ãƒƒã‚¯ã§æ¨©é™é™å®šã€‚ã‚¢ã‚¯ã‚»ã‚¹ã¯ç¯„å›²ä¿è­·ï¼‹ç›£æŸ»ã€‚
* ç›£æŸ»æ”¹ã–ã‚“é˜²æ­¢ï¼šç›£æŸ»è¡¨ã¯ç·¨é›†æ¨©é™ã‚’é‹ç”¨ãƒãƒ¼ãƒ ã®ã¿ã«é™å®šã€‚

---

## ğŸ“„ 15. ä»˜éŒ²ãƒªãƒ³ã‚¯

* ERãƒ•ãƒ«ï¼š`docs/er/system.md`
* ã‚µãƒ–å›³ï¼š`docs/er/hr.md`, `docs/er/inventory.md`, `docs/er/sales.md`
* é‹ç”¨ï¼š`docs/ops/backup-restore.md`, `docs/ops/security-privacy.md`
* UXï¼š`docs/ux/style-guide.md`, `docs/ux/wireframes.md`

---

### é‡è¦ãƒ¡ãƒ¢

* æœ¬READMEã¯**ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å«ã¾ãªã„**ã€‚å®Ÿè£…ã‚¹ãƒ‹ãƒšãƒƒãƒˆã¯åˆ¥ç´™ã§æä¾›å¯èƒ½ã€‚
* æ—¢å­˜ã®ä»•æ§˜ï¼ˆå®Œå…¨ç®¡ç†é …ç›®ã€ERã€ã‚·ãƒ¼ãƒˆå®šç¾©ã€CRUD/ç›£æŸ»ã€MPA Backã€UI/ãƒŠãƒ“ERæ‹¡å¼µï¼‰ã¯**å…¨ã¦ä¿æŒ**ã—ã€ã“ã“ã«çµ±åˆæ¸ˆã¿ã€‚

---

## 22. ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼å›³ï¼ˆMPA Ã— GAS Ã— Google Sheetsï¼**Master DB**ï¼‰

> æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯**æ©Ÿèƒ½ã¨ç´ã¥ããƒã‚¹ã‚¿ãƒ¼DB**ã€‚å…¨CRUDã¯ã“ã“ã‚’å˜ä¸€ã®çœŸå®Ÿæºï¼ˆSSOTï¼‰ã¨ã—ã¦æ‰±ã†ã€‚

```mermaid
flowchart LR
  subgraph USER[åˆ©ç”¨è€…]
    U1[HQç®¡ç†è€…]
    U2[ã‚¨ãƒªã‚¢Mgr]
    U3[åº—é•·]
    U4[ã‚¹ã‚¿ãƒƒãƒ•]
    U5[ç›£æŸ»/æ³•å‹™/è²¡å‹™]
  end

  subgraph MPA[KUROZUMI Front (MPA, Backå¸¸è¨­)]
    UI0[Start]
    UI1[ã‚«ãƒ†ã‚´ãƒª]
    UI2[ä¸€è¦§]
    UI3[è©³ç´°/ç·¨é›†ãƒ‰ãƒ­ãƒ¯ãƒ¼]
    UI4[æ‰¿èª/ç¢ºèª]
    UI5[ç›£æŸ»ãƒ“ãƒ¥ãƒ¼]
  end

  subgraph GAS[Google Apps Script Backend]
    R[Router doGet/doPost]
RBAC/Session
    SvcRepo[Repo.* èª­æ›¸/æ›¸è¾¼]
    SvcVal[Validate.* æ¤œè¨¼]
    SvcAud[Audit.log ç›£æŸ»]
    SvcId[UUID/æ¡ç•ª]
  end

  subgraph DB[Google Sheets â€” Master DB]
    MST[MST_* ãƒã‚¹ã‚¿ãƒ¼]
    TRN[TRN_* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³]
    LKP[LKP_* å‚ç…§]
    LNK[LNK_* å¤šæ…‹ãƒªãƒ³ã‚¯]
    UIER[MST_UiRoute ä»– (ä»»æ„)]
  end

  subgraph EXT[å¤–éƒ¨]
    GDrive[Google Drive æ–‡æ›¸/å¥‘ç´„]
    POS[å¤–éƒ¨æ±ºæ¸ˆ/ãƒ‡ãƒã‚¤ã‚¹]
    BI[LookerStudio/BigQuery]
  end

  U1 & U2 & U3 & U4 & U5 -->|æ“ä½œ/é–²è¦§| MPA
  MPA -->|HTTP / fetch (JSON)| R
  R -->|æ¨©é™åˆ¤å®š| SvcVal
  R -->|CRUDãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ| SvcRepo
  SvcRepo -->|èª­ã¿æ›¸ã| MST & TRN & LKP & LNK
  SvcRepo -->|UIãƒŠãƒ“æ‹¡å¼µ(ä»»æ„)| UIER
  R -->|ç›£æŸ»| SvcAud
  SvcAud --> TRN
  R -->|ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§| GDrive
  R -->|æ±ºæ¸ˆ/é€£æº| POS
  DB -->|ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹| BI
  MPA <-.Back/çŠ¶æ…‹å¾©å…ƒ.-> MPA
```

**è¦ç‚¹**

* æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼**Master DB**ï¼ˆMST/TRN/LKP/LNK ã™ã¹ã¦ã“ã“ï¼‰ã€‚
* MPAã®**æˆ»ã‚‹**ã¯ãƒ•ãƒ­ãƒ³ãƒˆã§åˆ¶å¾¡ã€**ç›£æŸ»/æ¨©é™/æ¤œè¨¼**ã¯GASå´ã§ä¸€å…ƒåŒ–ã€‚

---

## 23. æ©Ÿèƒ½é–¢é€£å›³ï¼ˆæ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ç›¸äº’ä¾å­˜ï¼‰

```mermaid
flowchart TB
  People[People/HR
(PERSON/EMPLOYMENT)]
  Stores[Stores
(STORE/DIVISION)]
  FC[Franchise
(FRANCHISEE/CONTRACT)]
  Product[Product/BOM
(PRODUCT/BOM)]
  Price[Pricing/Promo
(PRICE/PROMO)]
  Inventory[Inventory
(LOT/MOVE)]
  POSmod[POS/Sales
(RECEIPT/LINE/TENDER)]
  Quality[Quality/Safety
(INCIDENT/HACCP)]
  Asset[Assets/Maint
(ASSET/MAINT)]
  Docs[Docs/Workflow
(DOCUMENT/LINK)]
  Legal[Legal/Compliance]
  Finance[Finance/Accounting]

  People --> Stores
  Stores --> FC
  Product --> Price
  Product --> Inventory
  Price --> POSmod
  Inventory --> POSmod
  POSmod --> Finance
  Quality --> Stores
  Asset --> Stores
  Docs --> FC
  Docs --> Legal
  Finance --> Legal
  People --> POSmod
  People --> Quality
```

**èª­ã¿æ–¹**ï¼šä¾‹ãˆã°**Price/Inventory**ãŒ**POS**ã«å½±éŸ¿ã€**POS**ã®çµæœãŒ**Finance**ã¸ã€‚**People**ã¯POSã®æ‹…å½“è€…ãƒ»ã‚·ãƒ•ãƒˆã¨å“è³ªæ•™è‚²ã«ç´ã¥ãã€‚

---

## 24. ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆMPAÃ—GASÃ—Sheetsï¼‰

### 24.1 Personä½œæˆï¼ˆç™»éŒ²ï¼‰

```mermaid
sequenceDiagram
  actor User as ãƒ¦ãƒ¼ã‚¶ãƒ¼(MPA)
  participant UI as MPAç”»é¢
  participant GAS as GAS Router
  participant VAL as Validate
  participant REPO as Repo
  participant AUD as Audit
  participant DB as Sheets(Master)

  User->>UI: å…¥åŠ›â†’ä¿å­˜
  UI->>GAS: POST /person.create(payload)
  GAS->>VAL: å¿…é ˆ/LKP/é‡è¤‡ãƒã‚§ãƒƒã‚¯
  VAL-->>GAS: OK
  GAS->>REPO: insert PERSON, EMPLOYMENT(ä»»æ„)
  REPO->>DB: è¡Œè¿½åŠ  (UUIDæ¡ç•ª)
  GAS->>AUD: CREATEãƒ­ã‚°
  AUD->>DB: ç›£æŸ»è¿½è¨˜
  GAS-->>UI: æˆåŠŸï¼ˆæ–°IDï¼‰
  UI-->>User: ãƒˆãƒ¼ã‚¹ãƒˆï¼‹å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆ
```

### 24.2 ä¾¡æ ¼æ”¹å®šï¼ˆæœŸé–“ç®¡ç†ï¼‰

```mermaid
sequenceDiagram
  actor Manager
  participant UI
  participant GAS
  participant VAL
  participant REPO
  participant DB

  Manager->>UI: ä¾¡æ ¼è¡Œè¿½åŠ (start_on/end_on)
  UI->>GAS: POST /price.upsert
  GAS->>VAL: æœŸé–“é‡è¤‡ãƒã‚§ãƒƒã‚¯(åŒmenu_item, store)
  VAL-->>GAS: OK
  GAS->>REPO: æ–°è¡Œè¿½åŠ ï¼ˆæ—§ã¯è§¦ã‚‰ãšå±¥æ­´ä¿æŒï¼‰
  REPO->>DB: è¿½è¨˜
  GAS-->>UI: æˆåŠŸ
```

### 24.3 ã‚½ãƒ•ãƒˆå‰Šé™¤â†’å¾©å…ƒ

```mermaid
sequenceDiagram
  actor Admin
  participant UI
  participant GAS
  participant REPO
  participant AUD
  participant DB

  Admin->>UI: å‰Šé™¤
  UI->>GAS: POST /entity.deleteSoft(id)
  GAS->>REPO: active_flag=FALSE, deleted_*
  REPO->>DB: æ›´æ–°
  GAS->>AUD: DELETE_SOFT
  AUD->>DB: ç›£æŸ»è¿½è¨˜
  UI-->>Admin: ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ/éè¡¨ç¤º
  Admin->>UI: å¾©å…ƒ
  UI->>GAS: POST /entity.restore(id)
  GAS->>REPO: active_flag=TRUE, deleted_*=null
  REPO->>DB: æ›´æ–°
  GAS->>AUD: RESTORE
  AUD->>DB: ç›£æŸ»è¿½è¨˜
```

### 24.4 æˆ»ã‚‹ï¼ˆBackï¼‰ï¼†çŠ¶æ…‹å¾©å…ƒ

```mermaid
sequenceDiagram
  participant UI as MPA
  participant STACK as å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯

  UI->>STACK: NAV_PUSH(ä¸€è¦§, æ¡ä»¶/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ)
  UI->>STACK: NAV_PUSH(è©³ç´°, id)
  UI->>STACK: NAV_PUSH(ç·¨é›†, id)
  UI->>STACK: NAV_BACK()
  STACK-->>UI: ç›´å‰ã®ç”»é¢ï¼‹å‰å›çŠ¶æ…‹ã‚’è¿”ã™
```

---

## 25. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼ˆDFD-L1ï¼‰

```mermaid
flowchart LR
  subgraph POSF[POSãƒ•ãƒ­ãƒ¼]
    S1[è²©å£²(ãƒ¬ã‚·ãƒ¼ãƒˆ/æ˜ç´°)] --> S2[æ±ºæ¸ˆ(TENDER)]
    S1 --> S3[åœ¨åº«å¼•è½(LOT/MOVE)]
  end
  subgraph INVF[åœ¨åº«/è³¼è²·]
    P1[ç™ºæ³¨(PO/LINE)] --> P2[å…¥è·/æ¤œå(LOT)] --> P3[æ£šå¸/å»ƒæ£„(MOVE)]
  end

  POSF --> FIN[è²¡å‹™ï¼ˆå£²ä¸Šé›†è¨ˆ/ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ï¼‰]
  INVF --> COGS[åŸä¾¡/åœ¨åº«è©•ä¾¡]
  FIN --> KPI[KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
  COGS --> KPI
```

---

## 26. ERå›³ï¼ˆè¦ç‚¹å†æ²ï¼šSpreadsheet=Master DB å¼·èª¿ï¼‰

* æ—¢å‡ºã®**å…¨ä½“ER**ï¼ˆç¬¬2ç« ï¼‰ï¼‹**UI/ãƒŠãƒ“ERæ‹¡å¼µ**ï¼ˆç¬¬18ç« ï¼‰ã‚’é©ç”¨ã€‚
* ç‰©ç†çš„ä¿å­˜å…ˆã¯ **æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ**ã®å„ã‚¿ãƒ–ï¼ˆ`MST_* / TRN_* / LKP_* / LNK_*` ãŠã‚ˆã³ä»»æ„`UI_*`ï¼‰ã€‚

---

## 27. READMEè¿½è£œï¼ˆGitHub åæ˜ ç”¨ï¼šDiagramsã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

ä»¥ä¸‹ã‚’READMEã® `## Diagrams` ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã¨ã€Mermaidã‚’ãã®ã¾ã¾ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¯èƒ½ï¼ˆGitHubã¯Mermaidå¯¾å¿œï¼‰ã€‚

```md
## Diagrams
- System Flow (MPAÃ—GASÃ—Sheets as Master DB)
- Functional Map (Domain Dependencies)
- Key Sequences (Create/Price Update/Soft Delete/Back)
- DFD Level 1 (POSÃ—InventoryÃ—Finance)
- ER (Core & UIâ€‘Navigation Extension)

> å›³ã¯ `/docs/er/` ã« `.md` ã¨ã—ã¦åˆ†å‰²ä¿å­˜ã€‚Mermaidè¨˜æ³•ã€‚
```

---

## 28. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿ï¼ˆæœ€çµ‚ç¢ºèªï¼‰

* **æœ€å°æ§‹æˆ**ï¼š**è¿½åŠ ä¸è¦**ï¼ˆæ—¢å­˜ã®MST/TRN/LKP/LNKï¼‹ç›£æŸ»ã§ååˆ†ï¼‰ã€‚
* **æ‹¡å¼µæ§‹æˆ**ï¼šãƒŠãƒ“ã‚’å¯è¦–åŒ–/åˆ¶å¾¡/KPIåŒ–ã—ãŸã„å ´åˆã®ã¿ã€`MST_UiRoute / MST_UiRouteAccess / MST_UiBreadcrumb / TRN_UiNavLog` ã‚’**è¿½åŠ **ã€‚

> æŒ‡å®šURLã®ãƒ–ãƒƒã‚¯ã¯**Master DB**ã¨ã—ã¦å‰æåŒ–æ¸ˆã¿ã€‚å„CRUDã¯GASçµŒç”±ã§ã“ã®ãƒ–ãƒƒã‚¯ã«åæ˜ ã—ã€UIã®å‰Šé™¤ã¯**ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼ˆæ¨å¥¨ï¼‰**ã¾ãŸã¯**ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ**ã§è¡¨ç¾ã—ã¾ã™ã€‚

---

## 27. READMEè¿½è£œï¼ˆGitHub åæ˜ ç”¨ï¼šDiagramsã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

ä»¥ä¸‹ã‚’READMEã® `## Diagrams` ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã¨ã€Mermaidã‚’ãã®ã¾ã¾ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¯èƒ½ï¼ˆGitHubã¯Mermaidå¯¾å¿œï¼‰ã€‚

```md
## Diagrams
- System Flow (MPAÃ—GASÃ—Sheets as Master DB)
- Functional Map (Domain Dependencies)
- Key Sequences (Create/Price Update/Soft Delete/Back)
- DFD Level 1 (POSÃ—InventoryÃ—Finance)
- ER (Core & UIâ€‘Navigation Extension)

> å›³ã¯ `/docs/er/` ã« `.md` ã¨ã—ã¦åˆ†å‰²ä¿å­˜ã€‚Mermaidè¨˜æ³•ã€‚
```

---

## 28. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å½±éŸ¿ï¼ˆæœ€çµ‚ç¢ºèªï¼‰

* **æœ€å°æ§‹æˆ**ï¼š**è¿½åŠ ä¸è¦**ï¼ˆæ—¢å­˜ã®MST/TRN/LKP/LNKï¼‹ç›£æŸ»ã§ååˆ†ï¼‰ã€‚
* **æ‹¡å¼µæ§‹æˆ**ï¼šãƒŠãƒ“ã‚’å¯è¦–åŒ–/åˆ¶å¾¡/KPIåŒ–ã—ãŸã„å ´åˆã®ã¿ã€`MST_UiRoute / MST_UiRouteAccess / MST_UiBreadcrumb / TRN_UiNavLog` ã‚’**è¿½åŠ **ã€‚

> æŒ‡å®šURLã®ãƒ–ãƒƒã‚¯ã¯**Master DB**ã¨ã—ã¦å‰æåŒ–æ¸ˆã¿ã€‚å„CRUDã¯GASçµŒç”±ã§ã“ã®ãƒ–ãƒƒã‚¯ã«åæ˜ ã—ã€UIã®å‰Šé™¤ã¯**ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼ˆæ¨å¥¨ï¼‰**ã¾ãŸã¯**ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ**ã§è¡¨ç¾ã—ã¾ã™ã€‚

---

## 29. Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆçµ±åˆæ‰‹é †ï¼ˆæŒ‡å®šãƒ–ãƒƒã‚¯é€£æºï¼‰

**å¯¾è±¡ãƒ–ãƒƒã‚¯**ï¼š`https://docs.google.com/spreadsheets/d/1pJq2KT4WSfRIFdjGhZxm2m8aYfeq1g2KbUVLxPEL8TI/edit#gid=1926398647`

### 29.1 ãƒã‚¹ã‚¿ãƒ¼ãƒ–ãƒƒã‚¯ã®å½¹å‰²å®šç¾©

1. **å˜ä¸€ã‚½ãƒ¼ã‚¹ãƒ»ã‚ªãƒ–ãƒ»ãƒˆã‚¥ãƒ«ãƒ¼ã‚¹**ï¼šå½“è©²ãƒ–ãƒƒã‚¯ã¯å…¨MST/TRN/LKP/LNKè¡¨ã®ä¸€æ¬¡ä¿å­˜å…ˆã€‚Apps Scriptï¼ˆGASï¼‰ã‹ã‚‰ã®ã¿æ›¸ãè¾¼ã¿ã€ãƒ¦ãƒ¼ã‚¶ã¯åŸºæœ¬é–²è¦§ï¼‹æ‰¿èªç”¨é€”ã€‚
2. **å‘½åçµ±ä¸€**ï¼šæ—¢å­˜ã‚·ãƒ¼ãƒˆãŒä»•æ§˜ã¨ç•°ãªã‚‹å ´åˆã¯ `MST_* / TRN_* / LKP_* / LNK_*` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¸çµ±ä¸€ã€‚æ—§åç§°ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚·ãƒ¼ãƒˆã¸é€€é¿ã—ã€UUIDåˆ—ã®ç§»è¡Œãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä¿æŒã€‚
3. **ä¿è­·ã¨æ¨©é™**ï¼š`MST_Person` ç­‰ã®æ©Ÿå¾®ã‚·ãƒ¼ãƒˆã¯é–²è¦§æ¨©é™ã‚’ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§åˆ¶å¾¡ï¼ˆãƒ“ãƒ¥ãƒ¼ã‚¢/ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ï¼‰ã€‚GASã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç·¨é›†æ¨©é™ã‚’ä¿æŒã€‚

### 29.2 ã‚·ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆè¿½åŠ ãƒ»å‰Šé™¤åˆ¤å®šï¼‰

| åˆ¤å®š | æ¡ä»¶ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|------|------------|
| **Keep** | ä»•æ§˜å†…ã® `MST/TRN/LKP/LNK` åç§°ã¨å®Œå…¨ä¸€è‡´ | ã‚«ãƒ©ãƒ æ§‹é€ ãŒæœ€æ–°ä»•æ§˜ã¨ä¸€è‡´ã™ã‚‹ã‹æ¤œè¨¼ã€‚æ¬ æåˆ—ã¯è¿½è¨˜ã€‚ä½™è¨ˆãªåˆ—ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–åˆ—ã¸ç§»è¨­ã—ã€`_deprecated` ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§éè¡¨ç¤ºã€‚ |
| **Add** | ä»•æ§˜ã«ã‚ã‚‹ãŒãƒ–ãƒƒã‚¯ã«å­˜åœ¨ã—ãªã„ã‚·ãƒ¼ãƒˆ | Apps Script ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªå‹•ä½œæˆï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹å…±é€šåˆ—ï¼‰ã€‚åˆæœŸãƒ‡ãƒ¼ã‚¿ã¯ CSV ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ `setValues` ã§ãƒãƒ«ã‚¯ãƒ­ãƒ¼ãƒ‰ã€‚ |
| **Archive** | ä»•æ§˜å¤–ã® legacy ã‚·ãƒ¼ãƒˆ | `ARCHIVE_yyyyMMdd_*` åã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾Œã€é–²è¦§å°‚ç”¨ã‚¿ãƒ–ã¸ç§»å‹•ã€‚ã‚¢ãƒ—ãƒªã‹ã‚‰ã¯å‚ç…§ã—ãªã„ã€‚ |
| **Deleteï¼ˆè¦æ‰¿èªï¼‰** | å†…å®¹ãŒç©ºã€ç›£æŸ»æ¸ˆã¿ã§ä¸è¦ | HQ ç®¡ç†è€…æ‰¿èªã®ã‚‚ã¨å‰Šé™¤ã€‚AuditTrail ã« `operation=DELETE_HARD` ã‚’è¨˜éŒ²ã€‚ |

### 29.3 è¡Œå˜ä½ã®å‰Šé™¤ãƒãƒªã‚·ãƒ¼ï¼ˆUIé€£æºï¼‰

* **ã‚½ãƒ•ãƒˆå‰Šé™¤æ¨™æº–**ï¼šãƒ¦ãƒ¼ã‚¶ãŒ UI ä¸Šã§å‰Šé™¤æ“ä½œã‚’è¡Œã†ã¨ `active_flag=FALSE`ãƒ»`deleted_at/by` ãŒæ›´æ–°ã•ã‚Œã€å³åº§ã« UI ã‹ã‚‰ã¯éè¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ã§é™¤å¤–ï¼‰ã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸Šã§ã¯æ¡ä»¶ä»˜ãæ›¸å¼ã§ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼‹å–ã‚Šæ¶ˆã—ç·šã€‚
* **ãƒãƒ¼ãƒ‰å‰Šé™¤ä¾‹å¤–**ï¼šæ³•çš„è¦ä»¶ç­‰ã§ç‰©ç†å‰Šé™¤ãŒå¿…è¦ãªå ´åˆã€`Repo.hardDelete()` ã‚’ç”¨æ„ã€‚Apps Script å®Ÿè¡Œæ™‚ã«ç®¡ç†è€… 2FA ã¨ `TRN_AuditTrail` ã¸ `operation=DELETE_HARD` ã‚’å¼·åˆ¶è¨˜éŒ²ã€‚ãƒ–ãƒƒã‚¯å´ã§ã¯ `Revision History` ã‚’ãƒ€ãƒ³ãƒ—ã—ç›£æŸ»è¨¼è·¡ã‚’ä¿æŒã€‚
* **å¾©å…ƒãƒ•ãƒ­ãƒ¼**ï¼šUI ã®ã€Œå¾©å…ƒã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ `active_flag=TRUE`ãƒ»`deleted_*` ã‚’ null åŒ–ã€‚å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ãŒè‡ªå‹•ã§è©³ç´°ç”»é¢ã¸æˆ»ã‚Šã€å¾©å…ƒå¾Œã®å·®åˆ†ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã€‚

### 29.4 GAS é€£æºãƒã‚¤ãƒ³ãƒˆ

1. **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ID å®šç¾©**ï¼š`Config.SS_MASTER_ID = '1pJq2KT4WSfRIFdjGhZxm2m8aYfeq1g2KbUVLxPEL8TI'`
2. **ã‚·ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©**ï¼š`Sheets.getSheet(name)` ã§é…å»¶å–å¾—ã€‚å­˜åœ¨ã—ãªã‘ã‚Œã° `Sheets.ensureSheet(name, headers)` ã§ä½œæˆã€‚
3. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿è¨¼**ï¼š`LockService` ã‚’åˆ©ç”¨ã—ã€åŒä¸€ã‚·ãƒ¼ãƒˆåŒæ™‚æ›´æ–°æ™‚ã«æ’ä»–åˆ¶å¾¡ã€‚ãƒãƒªã‚·ãƒ¼ï¼šæœ€å¤§ 5 å›ãƒªãƒˆãƒ©ã‚¤ã€ãƒãƒƒã‚¯ã‚ªãƒ• 500msã€‚
4. **ã‚·ãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**ï¼šã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã¯ `Config.SCHEMA_VERSION` ã‚’æ›´æ–°ã—ã€åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªå‹•é©ç”¨ï¼ˆä¸è¶³åˆ—è¿½åŠ ã€ãƒ‡ãƒ¼ã‚¿å‹æ•´å½¢ï¼‰ã€‚

### 29.5 æ¡ä»¶ä»˜ãæ›¸å¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

| ã‚·ãƒŠãƒªã‚ª | ç¯„å›² | å¼ | æ›¸å¼ |
|----------|------|----|------|
| ã‚½ãƒ•ãƒˆå‰Šé™¤è¡Œ | `A:Z` | `=$active_flag=FALSE` | ç°è‰²èƒŒæ™¯ï¼ˆ#1C1C1Cï¼‰ã€æ–‡å­—è‰²#666ã€å–ã‚Šæ¶ˆã—ç·š |
| æœŸé™åˆ‡ã‚Œ | `start_on:end_on` | `=TODAY()>$end_on` | èƒŒæ™¯#330000ã€æ–‡å­—è‰²#FF5555 |
| æœŸé™è­¦å‘Š | `start_on:end_on` | `=AND($end_on-TODAY()<=7,$end_on>=TODAY())` | èƒŒæ™¯#332200ã€æ–‡å­—è‰²#FFDD55 |
| é«˜ãƒªã‚¹ã‚¯ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ | `severity` | `=$severity="CRITICAL"` | èƒŒæ™¯#1A0000ã€å·¦ç«¯ã«èµ¤è‰²ã‚°ãƒ­ãƒ¼ |

---

## 30. Apps Script å®Ÿè£…è©³ç´°ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒç‰ˆï¼‰

### 30.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
/src
  /config
    config.ts           // Spreadsheet IDã€ã‚·ãƒ¼ãƒˆåã€LKP ã‚­ãƒ£ãƒƒã‚·ãƒ¥ TTL
  /lib
    uuid.ts             // UUID/ULID ç”Ÿæˆï¼ˆ`Utilities.getUuid()` ãƒ©ãƒƒãƒ‘ï¼‰
    time.ts             // `now()`, `today()`, `formatIso()`
    sheets.ts           // `getRows`, `append`, `batchUpdate`
    lock.ts             // `withLock(key, fn)`
    cache.ts            // `getOrLoad(cacheKey, loader, ttl)`
  /repo
    baseRepo.ts         // `findById`, `query`, `upsert`, `softDelete`, `hardDelete`
    personRepo.ts
    employmentRepo.ts
    ...
  /service
    personService.ts    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    storeService.ts
    pricingService.ts
    navService.ts
  /validation
    rules.ts            // `require`, `inList`, `noOverlap`, `uniqueCombo`
  /audit
    audit.ts            // `log(user, entity, op, before, after)`
  /ui
    router.ts           // `doGet` ãƒ«ãƒ¼ã‚¿
    controller.ts       // `doPost` ãƒãƒ³ãƒ‰ãƒ©
    history.ts          // Back ã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†
  appsscript.json
```

### 30.2 Repository ãƒ‘ã‚¿ãƒ¼ãƒ³è©³ç´°

* **`upsert(entity, payload, user)`**ï¼š
  1. `LockService` ã§å¯¾è±¡ã‚·ãƒ¼ãƒˆã®è¡Œãƒ­ãƒƒã‚¯ã€‚
  2. `findById` ã§æ—¢å­˜è¡Œå–å¾—ã€‚å­˜åœ¨ã™ã‚Œã° diff ã‚’å–ã‚Š `before_json/after_json` ã‚’ç”Ÿæˆã€‚
  3. `Sheets.batchUpdate` ã§ä¸€æ‹¬æ›´æ–°ã€‚å…±é€šåˆ—ï¼ˆ`updated_*`ï¼‰ã¯è‡ªå‹•ä»˜ä¸ã€‚
  4. `Audit.log` ã‚’å‘¼ã³å‡ºã—ã€`operation` ã¯ `CREATE` ã¾ãŸã¯ `UPDATE` ã‚’åˆ¤å®šã€‚

* **`query(filter)`**ï¼šLKP å‚ç…§çµæœã‚’ `CacheService` ã«ä¿æŒã—ã€é«˜é »åº¦èª­ã¿å–ã‚Šã‚’é«˜é€ŸåŒ–ã€‚ãƒ•ã‚£ãƒ«ã‚¿ DSLï¼ˆ`field op value`ï¼‰ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã€è¡Œåˆ—å‚ç…§ã§æ¤œç´¢ã€‚

### 30.3 Validation ãƒ«ãƒ¼ãƒ«ã®æ·±æ˜ã‚Š

| ãƒ«ãƒ¼ãƒ« | èª¬æ˜ | å®Ÿè£…ãƒ¡ãƒ¢ |
|--------|------|----------|
| `uniqueCombo(fields)` | æ°åï¼‹ç”Ÿå¹´æœˆæ—¥ãªã©è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ | `Repo.query` ã§è©²å½“ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸€è‡´è¡Œã‚’å–å¾—ã—ã€`active_flag=TRUE` ã®ã¿å¯¾è±¡ã€‚ |
| `dateRange()` | `start_on <= end_on` ã®ä¿è¨¼ | å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ ISO8601 ã«æ•´å½¢ã—ã€æ•°å€¤æ¯”è¼ƒã€‚ |
| `noOverlap(entityId, start, end)` | æœŸé–“é‡è¤‡é˜²æ­¢ | `FILTER` ã‚¯ã‚¨ãƒªã§é‡è¤‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã€ãƒ’ãƒƒãƒˆæ™‚ã¯ UI ã«è­¦å‘Šï¼‹æ—¢å­˜æœŸé–“ã‚’è¡¨ç¤ºã€‚ |
| `lkp(value, code)` | å‚ç…§æ•´åˆæ€§ | `CacheService` ã§ LKP ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’30åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚ãƒŸã‚¹æ™‚ã¯å€™è£œãƒªã‚¹ãƒˆã‚’æç¤ºã€‚ |

### 30.4 API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| Route | Method | æ¦‚è¦ |
|-------|--------|------|
| `/api/person.create` | POST | Person ç™»éŒ²ã€‚é‡è¤‡æ¤œçŸ¥ã¨é›‡ç”¨è‡ªå‹•ã²ã‚‚ä»˜ã‘ã€‚ |
| `/api/person.update` | POST | å·®åˆ†æ›´æ–°ã€å¤‰æ›´ç‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆè¿”å´ã€‚ |
| `/api/entity.softDelete` | POST | æ±ç”¨ã‚½ãƒ•ãƒˆå‰Šé™¤ã€‚`entity` ã¨ `id` ã‚’å—ã‘å–ã‚Šã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åŒ–ã€‚ |
| `/api/entity.restore` | POST | å¾©å…ƒã€‚ |
| `/api/nav.push` | POST | ç”»é¢é·ç§»ãƒ­ã‚°ï¼‹å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯æ›´æ–°ã€‚ |
| `/api/report.kpi` | GET | KPI é›†è¨ˆã‚’è¿”å´ã€‚BigQuery é€£æºæ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤çµŒç”±ã€‚ |

### 30.5 è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆClaspï¼‹Jestï¼‰

* GAS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ `clasp` ã§ãƒ­ãƒ¼ã‚«ãƒ«åŒæœŸã€‚
* `gas-local`ï¼ˆä»®æƒ³ `SpreadsheetApp`ï¼‰ã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€‚
* ä¸»ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼š
  * `personService.create`ï¼šåŒä¸€çµ„ã¿åˆã‚ã›ç™»éŒ²æ™‚ã«é‡è¤‡ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã€‚
  * `pricingService.upsert`ï¼šæœŸé–“é‡è¤‡æ™‚ã«ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ `PRICE_RANGE_OVERLAP`ã€‚
  * `repo.softDelete`ï¼š`active_flag` æ›´æ–°ã¨ `Audit.log` å‘¼ã³å‡ºã—ç¢ºèªã€‚

---

## 31. UI/UX ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ€ã‚¤ãƒ–ï¼ˆIronman Ã— AKIRAï¼‰

### 31.1 ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

| è¦ç´  | æŒ‡å®š |
|------|------|
| ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ | èƒŒæ™¯#050505ã€ãƒ‘ãƒãƒ«#101015ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚°ãƒ­ãƒ¼#00F6FFï¼ˆ10%ï¼‰ã€ã‚µãƒ–ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ#FF2667 |
| ã‚¿ã‚¤ãƒ | è¦‹å‡ºã— `Orbitron`, æœ¬æ–‡ `Roboto Mono`ã€æ—¥æœ¬èªæœ¬æ–‡ `M PLUS 1p` |
| ã‚¢ã‚¤ã‚³ãƒ³ | è§’åº¦ 15Â° å‚¾æ–œã®ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯èª¿ã‚¢ã‚¤ã‚³ãƒ³ã€‚SVG ã‚·ãƒ³ãƒœãƒ«ï¼‹CSS ã‚°ãƒ­ãƒ¼ã€‚ |
| ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ | `transition: 260ms cubic-bezier(0.19, 1, 0.22, 1)`ï¼ˆEasing Out Backï¼‰ã€‚ä¿å­˜æ™‚ã¯ 600ms ã®ç™ºå…‰ã‚¢ãƒ‹ãƒ¡ã€‚ |

### 31.2 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

1. **Start ãƒãƒ–**ï¼šã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ï¼ˆ3åˆ—ï¼‰ã€‚å„ã‚«ãƒ¼ãƒ‰ã¯ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦ã¨ç™ºå…‰ãƒœãƒ¼ãƒ€ãƒ¼ã€‚ã‚«ãƒ¼ãƒ‰ãƒ›ãƒãƒ¼ã§èƒŒæ™¯ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã€‚
2. **ã‚«ãƒ†ã‚´ãƒªãƒŠãƒ“**ï¼šå·¦å´ã«ç£æ°—ãƒ‰ãƒ­ãƒ¯ãƒ¼ã€‚ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦è¡¨ç¤ºé †åºã‚’ `UI_ROUTE_ACCESS` ã‹ã‚‰å–å¾—ã—ã€ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãƒ«ãƒ¼ãƒˆã®ã¿è¡¨ç¤ºã€‚
3. **ä¸€è¦§ãƒ“ãƒ¥ãƒ¼**ï¼š
   * ãƒ˜ãƒƒãƒ€ã«ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ã€‚ã‚¿ã‚°å‹ UI ã§ `prefecture:å¤§é˜ª` ç­‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤ºã€‚
   * è¡¨ã¯å›ºå®šãƒ˜ãƒƒãƒ€ï¼‹æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€‚å·®åˆ†è¡¨ç¤ºã¯èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé’â†’ãƒã‚¼ãƒ³ã‚¿ï¼‰ã€‚
   * ã‚½ãƒ•ãƒˆå‰Šé™¤è¡Œã¯è‡ªå‹•ã§ `opacity: 0.45` + `text-decoration: line-through`ã€‚
4. **è©³ç´°ãƒ“ãƒ¥ãƒ¼**ï¼š
   * å³å´ãƒ‰ãƒ­ãƒ¯ãƒ¼ã«é–¢é€£æƒ…å ±ï¼ˆç›£æŸ»ãƒ­ã‚°ã€é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ã€‚
   * ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§é…å±å±¥æ­´ã‚„å¥‘ç´„æœŸé–“ã‚’å¯è¦–åŒ–ã€‚
5. **ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«**ï¼š
   * å…¥åŠ›é …ç›®ã¯ 2 ã‚«ãƒ©ãƒ ãƒ•ã‚©ãƒ¼ãƒ ã€‚å¿…é ˆé …ç›®ã¯ã‚·ã‚¢ãƒ³ç™ºå…‰ã®ä¸‹ç·šã€‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ã¯èµ¤ã„ç™ºå…‰ã¨æŒ¯å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

### 31.3 æˆ»ã‚‹ãƒŠãƒ“ï¼ˆBackï¼‰ã® UX å¼·åŒ–

* **å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼**ï¼šå¸¸æ™‚å·¦ä¸Šã«ãƒ›ãƒ­ã‚°ãƒ©ãƒ é¢¨ã® `Back` ãƒœã‚¿ãƒ³ã€‚ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã¯ãƒªãƒ³ã‚°ãŒ 2 å›æ³¢ç´‹ã€‚
* **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**ï¼š`Alt+â†` ã§ `NAV_BACK()`ã€`Esc` ã§ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰é–ã€‚ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«æ²¿ã£ãŸ `aria-label` ã‚’ä»˜ä¸ã€‚
* **æœªä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°**ï¼š3 ãƒœã‚¿ãƒ³ï¼ˆç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã€‚ä¿å­˜ãƒœã‚¿ãƒ³ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§è„ˆå‹•ã€‚

### 31.4 ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§

* ãƒ«ãƒƒã‚¯&ãƒ•ã‚£ãƒ¼ãƒ«ã¯ `theme.json` ã§å®šç¾©ã€‚å°†æ¥çš„ãª A/B ãƒ†ã‚¹ãƒˆã‚„å­£ç¯€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã«å¯¾å¿œã€‚
* `UI_ROUTE` ã« `is_modal`, `keep_state` ã‚’æ ¼ç´ã—ã€ç”»é¢é·ç§»æ™‚ã« UI ãŒè‡ªå‹•ã§çŠ¶æ…‹ã‚’ä¿å­˜/å¾©å…ƒã€‚

---

## 32. ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ“ãƒªãƒ†ã‚£ï¼†KPI æ‹¡å¼µ

### 32.1 ãƒ­ã‚° & ãƒ¡ãƒˆãƒªã‚¯ã‚¹

* **ãƒ­ã‚°é›†ç´„**ï¼š`TRN_AuditTrail`ï¼ˆæ¥­å‹™ï¼‰ã¨ `TRN_UiNavLog`ï¼ˆUIï¼‰ã‚’ BigQuery ã« ETLã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒˆãƒªã‚¬ãƒ¼ã§æ—¥æ¬¡åŒæœŸã€‚
* **ãƒ¡ãƒˆãƒªã‚¯ã‚¹**ï¼š
  * CRUD ä»¶æ•°ã€ã‚½ãƒ•ãƒˆå‰Šé™¤ç‡ã€å¾©å…ƒç‡ã€‚
  * Back ãƒœã‚¿ãƒ³åˆ©ç”¨ç‡ï¼ˆUX æ”¹å–„æŒ‡æ¨™ï¼‰ã€‚
  * ãƒ—ãƒ­ãƒ¢åå¿œç‡ã€åœ¨åº«å»ƒæ£„ãƒ­ã‚¹ç‡ã€‚
* **ãƒˆãƒ¬ãƒ¼ã‚¹**ï¼šApps Script ã® `Execution Transcript` ã‚’ Stackdriverï¼ˆç¾ Cloud Loggingï¼‰ã¸è»¢é€ã—ã€å¤±æ•—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ Slack é€šçŸ¥ã€‚

### 32.2 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆLooker Studioï¼‰

| ãƒšãƒ¼ã‚¸ | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ |
|--------|---------------|---------------|
| HQ Overview | å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰ã€åŸä¾¡ç‡ã€åŠ´å‹™æ¯”ç‡ã€é‡å¤§ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•° | BigQuery + LKP |
| FC Performance | åº—èˆ—åˆ¥ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ã€å¥‘ç´„æœŸé™ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€FC å¥å…¨åº¦ã‚¹ã‚³ã‚¢ | `MST_Franchisee`, `TRN_SalesReceipt`, `TRN_Incident` |
| Workforce | å‹¤æ€ éµå®ˆç‡ã€ç ”ä¿®å—è¬›ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€è©•ä¾¡åˆ†å¸ƒ | `TRN_TimeClock`, `TRAINING_HISTORY`, `EVALUATION` |
| Ops Health | è¨­å‚™ãƒã‚±ãƒƒãƒˆ SLAã€è¡›ç”Ÿãƒã‚§ãƒƒã‚¯é€¸è„±ã€Back åˆ©ç”¨ãƒ­ã‚° | `TRN_MaintTicket`, `TRN_UiNavLog` |

---

## 33. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¼·åŒ–ç­–

1. **ãƒ‡ãƒ¼ã‚¿åˆ†é¡**ï¼šPIIã€å–¶æ¥­æ©Ÿå¯†ã€å…¬é–‹æƒ…å ±ã® 3 åŒºåˆ†ã§ãƒ©ãƒ™ãƒªãƒ³ã‚°ã—ã€ã‚·ãƒ¼ãƒˆä¿è­·ãƒ¬ãƒ™ãƒ«ã‚’å®šç¾©ã€‚
2. **ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»**ï¼šæœˆæ¬¡ã§ `TRN_AuditTrail` ã‚’è‡ªå‹•é›†è¨ˆã—ã€æ¨©é™å¤‰æ›´ãƒ»å‰Šé™¤æ“ä½œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¼šã‚’é–‹å‚¬ã€‚
3. **æš—å·åŒ–**ï¼šéŠ€è¡Œå£åº§ç­‰ã¯åˆ¥ãƒ–ãƒƒã‚¯ã«ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆSHA-256ï¼‹ã‚½ãƒ«ãƒˆï¼‰ã—ã¦ä¿å­˜ã€‚å‚ç…§æ™‚ã®ã¿å¾©å·ã‚­ãƒ¼ã‚’ç”¨ã„ãŸé€£æºã€‚
4. **ãƒªãƒ¼ã‚¬ãƒ«ãƒ›ãƒ¼ãƒ«ãƒ‰**ï¼šè¨´è¨Ÿã‚„ç›£æŸ»ç™ºç”Ÿæ™‚ã¯ `Repo.softDelete` ã‚’ä¸€æ™‚ãƒ­ãƒƒã‚¯ã—ã€ãƒãƒ¼ãƒ‰å‰Šé™¤ã‚’ç¦æ­¢ã€‚`Config.legalHold=true` ã§åˆ¶å¾¡ã€‚
5. **DLP**ï¼šGoogle Workspace DLP ãƒ«ãƒ¼ãƒ«ã§å¤–éƒ¨å…±æœ‰ç¦æ­¢ã€‚Apps Script ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ™‚ã‚‚æ©Ÿå¯†ãƒ©ãƒ™ãƒ«ã‚’å¼·åˆ¶ã€‚

---

## 34. ãƒ‡ãƒ—ãƒ­ã‚¤ & ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹

### 34.1 CI/CD

1. GitHub Actions ã§ `clasp push --watch` ã‚’ç¦æ­¢ï¼ˆæ‰‹å‹•ç¢ºèªå¿…é ˆï¼‰ã€‚
2. Pull Request ã§ `npm test`ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆï¼‰ï¼‹ `npm run lint` ã‚’å®Ÿè¡Œã€‚Mermaid æ¤œè¨¼ã¯ `mmdc` ã§ç”»åƒç”Ÿæˆãƒ†ã‚¹ãƒˆã€‚
3. ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ–ãƒƒã‚¯ï¼ˆ`*_stg`ï¼‰ã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€æ‰¿èªå¾Œã«æœ¬ç•ªãƒ–ãƒƒã‚¯ã¸æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚

### 34.2 ãƒªãƒªãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

* ã‚¹ã‚­ãƒ¼ãƒå·®åˆ†ï¼ˆ`schemaDiff` ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ã‚’ `docs/release-notes/` ã«ä¿å­˜ã€‚
* UI ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆBack ãƒœã‚¿ãƒ³å«ã‚€ï¼‰ã‚’ `docs/screenshots/` ã«æ ¼ç´ã€‚
* ãƒãƒ¼ãƒ‰å‰Šé™¤æ“ä½œãƒ­ã‚°ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€ä¸è¦ãƒ‡ãƒ¼ã‚¿ãŒç¢ºå®Ÿã«å‰Šé™¤ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã€‚

---

## 35. å“è³ªä¿è¨¼ï¼ˆQAï¼‰æˆ¦ç•¥

1. **ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰**ï¼šãƒ¦ãƒ‹ãƒƒãƒˆï¼ˆ70%ï¼‰â†’ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ20%ï¼‰â†’UATï¼ˆ10%ï¼‰ã€‚
2. **ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ**ï¼š
   * åº—èˆ—ã‚ªãƒ¼ãƒ—ãƒ³ãƒ•ãƒ­ãƒ¼ï¼šStoreâ†’Contractâ†’Assetâ†’Priceâ†’Inventoryâ†’POSã€‚
   * é€€è·å‡¦ç†ï¼šEmployment çµ‚äº†â†’User ç„¡åŠ¹â†’Group è„±é€€â†’Back ã§ä¸€è¦§ã¸æˆ»ã‚‹ã€‚
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**ï¼šApps Script ã®ãƒãƒƒãƒæ›´æ–° 5,000 è¡Œã‚’ 1 åˆ†ä»¥å†…ã§å®Œäº†ã™ã‚‹ã“ã¨ã‚’ SLA ã«è¨­å®šã€‚

---

## 36. é‹ç”¨ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒã‚§ãƒ³ã‚¸ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ

1. **ãƒ­ãƒ¼ãƒ«åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°**ï¼šHQ ç®¡ç†ãƒ»ã‚¨ãƒªã‚¢ãƒãƒãƒ»åº—é•·ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ã® 4 ã‚³ãƒ¼ã‚¹ã€‚ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ Back æ“ä½œã¨ã‚½ãƒ•ãƒˆå‰Šé™¤å¾©å…ƒã‚’ç·´ç¿’ã€‚
2. **ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹**ï¼š`docs/playbooks/` ã«ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’æ ¼ç´ã€‚ä¾‹ï¼šã€Œæ·±å¤œå–¶æ¥­è¨±å¯æ›´æ–°ã€ã€Œã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä¸€æ¬¡å¯¾å¿œã€ã€‚
3. **ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ï¼šå¤‰æ›´ã¯ Weekly ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆï¼‹Slack ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€‚UI å¤‰æ›´æ™‚ã¯ 24 æ™‚é–“å‰ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§å‘ŠçŸ¥ã€‚
4. **ã‚µãƒãƒ¼ãƒˆ SLA**ï¼š
   * é‡å¤§ï¼š4 æ™‚é–“å†…åˆå‹•ã€‚
   * é«˜ï¼š1 å–¶æ¥­æ—¥ã€‚
   * ä¸­ï¼š3 å–¶æ¥­æ—¥ã€‚
   * ä½ï¼š1 é€±é–“ã€‚

---

## 37. ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆFuture Enhancementsï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | æœŸé–“ | å¼·åŒ–ç‚¹ |
|----------|------|---------|
| 5 | FY2025 Q1 | HR æ¡ç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆå¿œå‹Ÿï½å†…å®šï¼‰ï¼‹Web ãƒ•ã‚©ãƒ¼ãƒ é€£æº |
| 6 | FY2025 Q2 | IoT æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼é€£æºã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ¨åº«ç›£è¦– |
| 7 | FY2025 Q3 | ç”Ÿæˆ AI ã«ã‚ˆã‚‹æ—¥å ±è¦ç´„ãƒ»ç•°å¸¸æ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆ |
| 8 | FY2025 Q4 | ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹ï¼ˆå¤šé€šè²¨å¯¾å¿œã€è¨€èªåˆ‡æ›¿ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åˆ¥ç¨åˆ¶ï¼‰ |

---

## 38. ä»˜éŒ²ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ & ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚µãƒ³ãƒ—ãƒ«

### 38.1 CSV ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

* `templates/mst_person.csv`
* `templates/trn_sales_receipt_YYYYMM.csv`
* `templates/mst_ui_route.csv`

### 38.2 Apps Script ã‚µãƒ³ãƒ—ãƒ«ï¼ˆSoft Deleteï¼‰

```ts
function softDeleteEntity(entity, id, userId) {
  return Lock.withLock(entity, () => {
    const repo = RepoFactory.for(entity);
    const before = repo.findById(id);
    if (!before) {
      throw new Error(`${entity}#${id} not found`);
    }
    repo.update(id, {
      active_flag: false,
      deleted_at: Time.nowIso(),
      deleted_by: userId,
    });
    Audit.log(userId, entity, id, 'DELETE_SOFT', before, {
      ...before,
      active_flag: false,
    });
    return { id, status: 'SOFT_DELETED' };
  });
}
```

### 38.3 UI å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰

```ts
const historyStack = [];

function navPush(route, params) {
  historyStack.push({ route, params, state: captureState() });
}

function navBack() {
  if (historyStack.length <= 1) {
    return navReset('Start');
  }
  historyStack.pop();
  const { route, params, state } = historyStack[historyStack.length - 1];
  restoreState(state);
  render(route, params);
}
```

---

ã“ã‚Œã‚‰ã®è¿½è£œã«ã‚ˆã‚Šã€æ—¢å­˜ä»•æ§˜ã‚’ä¿æŒã—ã¤ã¤ã€Google/Apple/Salesforce/Rakuten/SoftBank ãƒ¬ãƒ™ãƒ«ã®ç²¾å¯†ã•ã¨ä½“é¨“ä¾¡å€¤ã‚’å‚™ãˆãŸ MPAÃ—GAS ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤ã‚’ç·åˆ·æ–°ã§ãã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ã¯ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãª UI ã‚’é€šã˜ã¦ç›´æ„Ÿçš„ã«æ“ä½œã—ã¤ã¤ã€ç›£æŸ»ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»æ‹¡å¼µæ€§ã®è¦ä»¶ã‚’ä½™ã™ã“ã¨ãªãæº€ãŸã™ã€‚

---

## 39. MPAÃ—GAS å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆç·åˆ·æ–°ç‰ˆï¼‰

| ãƒ¬ã‚¤ãƒ¤ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å½¹å‰² | ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ« |
|--------|----------------|------|--------------|
| ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | KUROZUMI MPAï¼ˆApps Script HTML Serviceï¼‰ | ãƒ¢ãƒãƒˆãƒ¼ãƒ³Ã—ã‚·ã‚¢ãƒ³ç™ºå…‰ UIã€Back å¸¸è¨­ã€æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰ã€ãƒ‘ãƒ³ããšã€ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ | `apps_script/index.html`, `apps_script/styles.html`, `apps_script/scripts.html` |
| ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©/ã‚µãƒ¼ãƒ“ã‚¹å±¤ | doGet/doPost ãƒ«ãƒ¼ã‚¿ã€Person CRUDã€ãƒŠãƒ“å±¥æ­´ã€ç›£æŸ»é€£æºã€RBAC ãƒ«ãƒ¼ãƒˆåˆ¶å¾¡ | `apps_script/UiController.gs`, `apps_script/PersonService.gs`, `apps_script/PersonEndpoints.gs`, `apps_script/UiRouteService.gs`, `apps_script/NavService.gs` |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ | æ±ç”¨ãƒ¬ãƒã‚¸ãƒˆãƒªï¼‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | UUID ç”Ÿæˆã€ã‚½ãƒ•ãƒˆ/ãƒãƒ¼ãƒ‰å‰Šé™¤åˆ‡æ›¿ã€æœŸé–“é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€LKP æ¤œè¨¼ | `apps_script/Config.gs`, `apps_script/Repo.gs`, `apps_script/Validate.gs`, `apps_script/Audit.gs`, `apps_script/Uuid.gs`, `apps_script/Time.gs`, `apps_script/Lock.gs` |
| ãƒ‡ãƒ¼ã‚¿ | Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆæŒ‡å®šãƒ–ãƒƒã‚¯ï¼‰ | ãƒã‚¹ã‚¿ãƒ¼/ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³/ãƒŠãƒ“ç›£æŸ»ã®ç‰©ç†ã‚¹ãƒˆã‚¢ã€‚ã‚½ãƒ•ãƒˆå‰Šé™¤åˆ—ã§ UI ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€‚ | [Google Sheet: 1pJq2â€¦](https://docs.google.com/spreadsheets/d/1pJq2KT4WSfRIFdjGhZxm2m8aYfeq1g2KbUVLxPEL8TI/edit) |
| å¯è¦³æ¸¬æ€§ | ç›£æŸ»ãƒ­ã‚°ï¼‹ãƒŠãƒ“ãƒ­ã‚°ï¼‹ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ | TRN_AuditTrail, TRN_UiNavLog, on-screen toast, Google Chat é€šçŸ¥ | `apps_script/Audit.gs`, `apps_script/UiRouteService.gs`, `apps_script/scripts.html` |

**ã‚¢ãƒ—ãƒªèµ·å‹•ãƒ•ãƒ­ãƒ¼**ï¼š`doGet` â†’ `UiController` ãŒãƒ†ãƒ¼ãƒãƒ»ãƒ«ãƒ¼ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰ â†’ ãƒ•ãƒ­ãƒ³ãƒˆã® `scripts.html` ãŒ SPA ãƒ©ã‚¤ã‚¯ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â†’ æ“ä½œæ™‚ã« `PersonEndpoints` çµŒç”±ã§ Repo/Audit å‘¼å‡º â†’ ã‚·ãƒ¼ãƒˆæ›´æ–° â†’ `NavService` ãŒå±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ä¿å­˜ â†’ `UiRouteService` ãŒ `TRN_UiNavLog` ã«é·ç§»è¨˜éŒ²ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹æˆ¦ç•¥**ï¼šå…¨ API ã¯ JSON ã‚’è¿”å´ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ãƒˆãƒ¼ã‚¹ãƒˆã¨å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆã§å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã€‚å¤±æ•—æ™‚ã¯ `showError` ãŒã‚°ãƒ­ãƒ¼ä»˜ããƒˆãƒ¼ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼ã¨ãƒªã‚«ãƒãƒªæ‰‹é †ã‚’æç¤ºã€‚

---

## 40. Apps Script ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆï¼ˆgs/html ç·è¦§ï¼‰

```
apps_script/
â”œâ”€â”€ Config.gs            // ã‚·ãƒ¼ãƒˆåãƒ»å…±é€šåˆ—å®šç¾©ãƒ»Back å±¥æ­´ä¸Šé™
â”œâ”€â”€ Uuid.gs              // UUID / ULID ç”Ÿæˆ
â”œâ”€â”€ Time.gs              // ISO æ—¥æ™‚ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ Lock.gs              // ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ­ãƒƒã‚¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ Sheets.gs            // Range ãƒ©ãƒƒãƒ‘ãƒ¼ã€è¡Œå–å¾—/æ›´æ–°/å‰Šé™¤
â”œâ”€â”€ Repo.gs              // find/query/upsert/softDelete/hardDelete
â”œâ”€â”€ Audit.gs             // TRN_AuditTrail/Item ã¸ã®è¨˜éŒ²
â”œâ”€â”€ Validate.gs          // å¿…é ˆ/ãƒªã‚¹ãƒˆ/æœŸé–“é‡è¤‡æ¤œè¨¼
â”œâ”€â”€ NavService.gs        // CacheService ãƒ™ãƒ¼ã‚¹å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯
â”œâ”€â”€ UiRouteService.gs    // RBAC ä»˜ããƒ«ãƒ¼ãƒˆè§£æ±ºã¨ãƒŠãƒ“ãƒ­ã‚°
â”œâ”€â”€ Theme.gs             // IronmanÃ—AKIRA ãƒ‘ãƒ¬ãƒƒãƒˆ
â”œâ”€â”€ PersonService.gs     // Person CRUD ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ PersonEndpoints.gs   // ãƒ•ãƒ­ãƒ³ãƒˆå…¬é–‹ API
â”œâ”€â”€ UiController.gs      // doGet/doPostã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒ‰
â”œâ”€â”€ index.html           // ãƒ«ãƒ¼ãƒˆ HTMLï¼ˆBack ãƒ˜ãƒƒãƒ€ãƒ¼ç­‰ï¼‰
â”œâ”€â”€ styles.html          // ã‚°ãƒ­ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
â””â”€â”€ scripts.html         // MPA ãƒŠãƒ“ & UI æŒ¯ã‚‹èˆã„
```

**ã‚³ãƒ¼ãƒ‰å“è³ªç­–**

1. ESLint-equivalent ã® `clasp` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« TypeScript å°å…¥ã‚’æ¨å¥¨ï¼ˆ`tsconfig` ã§ `noImplicitAny=true`ï¼‰ã€‚
2. `Repo` ã¯å‹å®‰å…¨å‘ä¸Šã®ãŸã‚ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹å¯¾å¿œäºˆå®šï¼ˆPhase 5ï¼‰ã€‚
3. `scripts.html` ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼ˆESMï¼‰ã‚’è¦–é‡ã«å…¥ã‚Œã€ä»Šå¾Œ `Rollup` ã§ãƒãƒ³ãƒ‰ãƒ«â†’æœ€é©åŒ–ã€‚

---

## 41. UI/UX ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ« â€” Ironman HUD Ã— AKIRA

1. **HUD ãƒ©ã‚¤ãƒˆãƒãƒ¼**ï¼š`app__header` ã«å¸¸æ™‚ Backï¼Breadcrumbï¼Session Infoã€‚Back ã¯ `Alt+â†` / `Esc` äº’æ›ã§ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ AAã€‚
2. **Neon Diff Highlight**ï¼šæ›´æ–°å®Œäº†æ™‚ã¯ç·¨é›†ã‚«ãƒ¼ãƒ‰ç¸ã« 3 ç§’ã®ã‚·ã‚¢ãƒ³ã‚°ãƒ­ãƒ¼ (`box-shadow`) ã‚’è¡¨ç¤ºã€‚`showToast` ãŒ `Audit Forge` æˆåŠŸã‚’çŸ¥ã‚‰ã›ã‚‹ã€‚
3. **Data Gray-out**ï¼š`table tbody tr.inactive` ã« `opacity:0.4 + line-through` ã‚’é©ç”¨ã—ã€ã‚½ãƒ•ãƒˆå‰Šé™¤ãƒ‡ãƒ¼ã‚¿ã¯è¦–èªå¯èƒ½ã§ã‚‚æ“ä½œä¸å¯ã€‚ãƒãƒ¼ãƒ‰å‰Šé™¤å¾Œã¯ `Repo.hardDelete` ã§è¡Œå‰Šé™¤ã€‚
4. **Holographic Panels**ï¼š`content-card` ã¨ `hero-card` ã§å¾®åå°„ã‚¬ãƒ©ã‚¹æ„Ÿã€‚ãƒ‘ãƒãƒ«åˆ‡æ›¿æ™‚ã«ãƒ•ã‚§ãƒ¼ãƒ‰ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼ˆ300msï¼‰ã‚’æ¨å¥¨ï¼ˆ`animate()` è¿½åŠ äºˆå®šï¼‰ã€‚
5. **Guided Missions**ï¼š`renderStart` ã® 3 ã‚«ãƒ¼ãƒ‰ã¯ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€‚Phase 4 ã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰â†’ `NAV_PUSH` ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã€‚
6. **æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰**ï¼š`guardUnsaved` ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã® 3 åˆ†å²ã€‚ä¿å­˜é¸æŠã§ `modal.save` ã‚’ä»£ç†ã‚¯ãƒªãƒƒã‚¯â†’äººç‚ºãƒŸã‚¹ã‚¼ãƒ­åŒ–ã€‚

---

## 42. Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æº & ã‚½ãƒ•ãƒˆå‰Šé™¤è¨­è¨ˆ

1. **ã‚·ãƒ¼ãƒˆãƒªãƒ³ã‚¯**ï¼š`Config.bookId` ã‚’æŒ‡å®šæ¸ˆã¿ï¼ˆã”æç¤º URLï¼‰ã€‚Apps Script ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒä¸€ãƒ‰ãƒ©ã‚¤ãƒ–ã«é…ç½®ã—ã€`SpreadsheetApp.openById` ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹æ¨©é™ãƒã‚§ãƒƒã‚¯ã€‚
2. **åˆ—æ•´åˆãƒã‚§ãƒƒã‚¯**ï¼š`Sheets.getHeader` ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é…åˆ—å–å¾—ã€‚æ¬ ææ™‚ã¯å³ä¾‹å¤–â†’`schemaDiff` ã§è£œæ­£ã€‚`MST_*` / `TRN_*` / `LKP_*` / `MST_Ui*` ã®åˆ—ã¯ README ç«  3 & 19 å‚ç…§ã€‚
3. **ã‚½ãƒ•ãƒˆå‰Šé™¤**ï¼š`Repo.softDelete` ãŒ `active_flag=false`, `deleted_*` ã‚’è‡ªå‹•å…¥åŠ›ã€‚UI ã§ã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼‹ãƒãƒƒã‚¸è¡¨ç¤ºã€‚å¾©å…ƒã¯ `Repo.upsert` ã§ `active_flag=true` ã‚’å†æŠ•å…¥ã€‚
4. **ãƒãƒ¼ãƒ‰å‰Šé™¤**ï¼š`Repo.hardDelete` ãŒå®Œå…¨å‰Šé™¤ã€‚UI ã§ã¯ã‚½ãƒ•ãƒˆå‰Šé™¤æ¸ˆè¡Œã«å¯¾ã—ã¦ã®ã¿ã€Œå®Œå…¨å‰Šé™¤ã€ã‚’æç¤ºã—ã€äººç‚ºçš„ãªèª¤å‰Šé™¤ã‚’é˜²æ­¢ã€‚`Audit.log` ã§ `DELETE_HARD` ã‚’æ®‹ã™ãŸã‚ç›£æŸ»è¿½è·¡å¯èƒ½ã€‚
5. **åŒæœŸé‹ç”¨**ï¼šApps Script ã® `Trigger` ã§æ—¥æ¬¡ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆ`active_flag=false` ãƒ‡ãƒ¼ã‚¿ã‚’ `_archive` ã‚·ãƒ¼ãƒˆã¸ç§»é€ï¼‰ã‚‚å¯èƒ½ã€‚Phase 3 ã§ `Time-driven` ãƒˆãƒªã‚¬è¨­å®šã€‚
6. **æ¡ä»¶ä»˜ãæ›¸å¼**ï¼šã‚·ãƒ¼ãƒˆå´ã§ `active_flag=FALSE` è¡Œã« `æ–‡å­—è‰²=ç°`, `èƒŒæ™¯=æ·¡é»’`, `å–ã‚Šæ¶ˆã—ç·š` ã‚’è¨­å®šã— UI ã¨è¦–è¦šä¸€è‡´ã€‚
7. **å·®åˆ†æ¤œçŸ¥**ï¼š`AuditTrail` ã® `before_json/after_json` ã‚’ BigQuery ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°â†’æ”¹ã–ã‚“æ¤œçŸ¥ã€‚Back æ“ä½œã¯ `TRN_UiNavLog` å‚ç…§ã€‚

---

## 43. ãƒªã‚¹ã‚¯ã‚¼ãƒ­é‹ç”¨ç­– & ãƒ•ã‚§ã‚¤ãƒ«ã‚»ãƒ¼ãƒ•

1. **Error Budget**ï¼šApps Script å®Ÿè¡Œå¤±æ•—ç‡ 0.1% ä»¥ä¸‹ã‚’ SLAã€‚`Lock.withLock` ã§åŒæ™‚æ›´æ–°ç«¶åˆã‚’é˜²ãã€å¤±æ•—æ™‚ã¯ 3 å›æŒ‡æ•°ãƒªãƒˆãƒ©ã‚¤ï¼ˆæ‹¡å¼µäºˆå®šï¼‰ã€‚
2. **å…¥åŠ›å“è³ª**ï¼š`Validate.require/inList/noOverlap` ã«ã‚ˆã‚Šå¿…é ˆ/å‚ç…§æ•´åˆ/æœŸé–“é‡è¤‡ã‚’é˜²æ­¢ã€‚UI å´ã‚‚ `required` å±æ€§ï¼‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å°å…¥ã€‚
3. **ç›£æŸ»é˜²å¾¡**ï¼š`Audit.log` ã‚’å…¨æ“ä½œã«çµ„è¾¼ã¿ã€‚`AuditTrail` ã¨ `AuditItem` ã®å·®åˆ†ã§æ”¹ã–ã‚“ç›£è¦–ã€‚ãƒŠãƒ“ãƒ­ã‚°ã¯ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥ï¼ˆä¾‹ï¼šç¦æ­¢ãƒ«ãƒ¼ãƒˆé·ç§»ï¼‰ã€‚
4. **å¾©å…ƒè¨ˆç”»**ï¼šã‚½ãƒ•ãƒˆå‰Šé™¤â†’UI ã‹ã‚‰ 1 ã‚¯ãƒªãƒƒã‚¯å¾©æ´»ã€‚ãƒãƒ¼ãƒ‰å‰Šé™¤â†’æ—¥æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆSection 12ï¼‰ã‹ã‚‰ `Repo.upsert` ã§æˆ»ã—ã€`deleted_*` ã‚’å†åˆæœŸåŒ–ã€‚
5. **è² è·å¯¾ç­–**ï¼š`Sheets.getAllRows` ã¯ 5,000 è¡Œè¶…ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (`CacheService`) åˆ©ç”¨ã€‚`Repo.query` ã®çµæœã¯ 5 åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥â†’`CacheKey:tableName`ã€‚ä»Šå¾Œ 100k è¡Œè¦æ¨¡ã¯ BigQuery DataSet ã¸åŒæœŸã€‚
6. **æ¨©é™é€¸è„±é˜²æ­¢**ï¼š`UiRouteService.availableRoutes` ãŒ RBAC ãƒ™ãƒ¼ã‚¹ã§ãƒ«ãƒ¼ãƒˆæä¾›ã€‚æœªç™»éŒ²ãƒ«ãƒ¼ãƒˆã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã¯ `Unknown route` ã§ 403 è¡¨ç¤ºï¼ˆPhase 2 ã§å®Ÿè£…ï¼‰ã€‚
7. **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹**ï¼š`showError` ãŒ UI ã«å³ã‚¢ãƒ©ãƒ¼ãƒˆã€åŒæ™‚ã« `Audit.log` ã¸ `ERROR` æ“ä½œè¨˜éŒ²ï¼ˆæ”¹ä¿®äºˆå®šï¼‰â†’Slack é€šçŸ¥ã€‚

---

## 44. æ·±å €ã‚Šå°ç·š â€” ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒ‘ãƒƒã‚¯

| ãƒ‰ãƒ¡ã‚¤ãƒ³ | ä½“é¨“ã‚·ãƒŠãƒªã‚ª | å¿…è¦ã‚·ãƒ¼ãƒˆ | UI ãƒ«ãƒ¼ãƒˆä¾‹ |
|----------|---------------|------------|--------------|
| People Ops | å…¥ç¤¾â†’é…å±â†’ã‚·ãƒ•ãƒˆâ†’å‹¤æ€ æ‰¿èª | `MST_Person`, `MST_Employment`, `TRN_Shift`, `TRN_TimeClock` | `Start â€º People â€º List â€º Detail â€º ShiftPlan` |
| Franchise | FC å¥‘ç´„æ›´æ–°ã€é•åç™»éŒ²ã€ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£è«‹æ±‚ | `MST_Franchisee`, `MST_FranchiseContract`, `TRN_AuditTrail` | `Start â€º Franchise â€º ContractBoard` |
| Inventory | ç™ºæ³¨â†’å…¥åº«â†’ãƒ­ãƒƒãƒˆè¿½è·¡â†’å»ƒæ£„ | `TRN_PurchaseOrder`, `TRN_PO_Line`, `TRN_StockLot`, `TRN_StockMove` | `Start â€º Inventory â€º LotRadar` |
| Sales & Promo | ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¾¡æ ¼æ”¹å®šã€ãƒ—ãƒ­ãƒ¢è¨­å®šã€POS é€£æº | `MST_MenuItem`, `MST_Price`, `MST_Promotion`, `LNK_PromoApplicability` | `Start â€º Sales â€º PriceLab` |
| Quality & Safety | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Šã€HACCP ãƒ­ã‚°ã€å†ç™ºé˜²æ­¢ã‚¿ã‚¹ã‚¯ | `TRN_Incident`, `TRN_IncidentParticipant`, `MST_Asset` | `Start â€º Quality â€º IncidentDeck` |
| UI Analytics | Back åˆ©ç”¨é »åº¦ã€ãƒ«ãƒ¼ãƒˆæ»åœ¨æ™‚é–“ã€é›¢è„±ç‡ | `TRN_UiNavLog`, `TRN_AuditTrail` | `Start â€º Insights â€º Navigation` |

å„ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ `NAV_PUSH` ã‚’ç”¨ã„ã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã§ 1 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾©å¸°ã€‚æœªä¿å­˜æ™‚ã¯ `guardUnsaved` ãŒå¿…ãšä»‹å…¥ã—ãƒªã‚¹ã‚¯ã‚¼ãƒ­ã€‚

---

## 45. å°å…¥æ‰‹é †ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒå±•é–‹ï¼‰

1. **Apps Script ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–°è¦ä½œæˆ** â†’ `clasp` ã§æœ¬ãƒªãƒã‚¸ãƒˆãƒª `apps_script/` ã‚’ pushã€‚
2. **OAuth ã‚¹ã‚³ãƒ¼ãƒ—**ï¼š`https://www.googleapis.com/auth/spreadsheets`, `.../drive.readonly`ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ç”¨ï¼‰ã‚’è¿½åŠ ã€‚2FA / App Verification å®Ÿæ–½ã€‚
3. **ã‚·ãƒ¼ãƒˆæº–å‚™**ï¼šREADME 3ç« ãƒ»19ç« ã®ã‚·ãƒ¼ãƒˆã‚’ãƒ–ãƒƒã‚¯ä¸Šã«ä½œæˆã—ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å®šç¾©ã€‚æ¡ä»¶ä»˜ãæ›¸å¼ã¨ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚’è¨­å®šã€‚
4. **åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥**ï¼š`templates/*.csv` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€‚`active_flag` ã¯æ—¢å®š TRUEã€‚
5. **RBAC è¨­å®š**ï¼š`MST_Role`, `TRN_UserRole`, `MST_UiRoute`, `MST_UiRouteAccess` ã«å¿…è¦ãªãƒ­ãƒ¼ãƒ«/ãƒ«ãƒ¼ãƒˆã‚’ç™»éŒ²ã€‚
6. **ãƒ‡ãƒ—ãƒ­ã‚¤**ï¼šApps Script ã§ `ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤` â†’ `å®Ÿè¡Œæ¨©é™: è‡ªåˆ†`, `ã‚¢ã‚¯ã‚»ã‚¹: çµ„ç¹”ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼`ã€‚
7. **ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**ï¼šå…¥ç¤¾ãƒ•ãƒ­ãƒ¼ãƒ»ä¾¡æ ¼æ”¹å®šãƒ»Back é€£æ‰“ãƒ»æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚½ãƒ•ãƒˆ/ãƒãƒ¼ãƒ‰å‰Šé™¤ã‚’ QAã€‚ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ã‚’ç¢ºèªã€‚
8. **é‹ç”¨åˆ‡æ›¿**ï¼šæ—§ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå¾Œã€`NAV_RESET('Start')` ã‚’èµ°ã‚‰ã›ã¦å±¥æ­´ã‚¯ãƒªã‚¢ã€‚ãƒ¦ãƒ¼ã‚¶ã¸ã‚ªãƒ³ãƒœãƒ¼ãƒ‰å‹•ç”»é…å¸ƒã€‚

---

## 46. è¿½åŠ ã‚·ãƒ¼ãƒˆã®æ¨å¥¨æœ‰ç„¡ï¼ˆå†ç¢ºèªï¼‰

* **æœ€å°é‹ç”¨**ï¼šæ—¢å­˜ã‚·ãƒ¼ãƒˆã®ã¿ã€‚ã‚½ãƒ•ãƒˆå‰Šé™¤ã¯ UI ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€ãƒãƒ¼ãƒ‰å‰Šé™¤ã¯ `Repo.hardDelete` ã§å®Ÿè¡Œã€‚ãƒ¦ãƒ¼ã‚¶è¦–ç‚¹ã§ã¯å‰Šé™¤å¾Œå³éè¡¨ç¤ºã€‚
* **é«˜åº¦é‹ç”¨**ï¼š`MST_UiRoute`, `TRN_UiNavLog`, `MST_UiRouteAccess`, `MST_UiBreadcrumb` ã‚’è¿½åŠ ï¼ˆSection 19.1ï¼‰ã€‚ä»Šå›ã® Apps Script ã‚‚ã“ã‚Œã‚‰ã«å¯¾å¿œæ¸ˆã¿ã€‚
* **å‰Šé™¤æ¨å¥¨ã‚·ãƒ¼ãƒˆ**ï¼šç¾çŠ¶ãªã—ã€‚æ—¢å­˜ã‚·ãƒ¼ãƒˆã¯ã™ã¹ã¦æ´»ç”¨å¯èƒ½ã€‚ä¸è¦ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆã¯ `Config.tables` ã«æœªç™»éŒ²ãªã‚‰å½±éŸ¿ãªã—ã€‚

---

## 47. æ‹¡å¼µãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆMPA Ã— GAS é€²åŒ–ç³»ï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | æœŸé–“ | å¼·åŒ–ç‚¹ | å®Ÿè£…æ¦‚è¦ |
|----------|------|---------|----------|
| 5 | FY2025 Q1 | UI ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ– & AB ãƒ†ã‚¹ãƒˆ | `UiRouteService` ã« `variant` åˆ—è¿½åŠ ã€`scripts.html` ã§ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ UI åˆ‡æ›¿ |
| 6 | FY2025 Q2 | AI ã‚³ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆï¼ˆè‡ªç„¶è¨€èªã‚¯ã‚¨ãƒªï¼‰ | Vertex AI é€£æºã€`NAV_PUSH('Insights.AI')` ã§ãƒãƒ£ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º |
| 7 | FY2025 Q3 | IoT æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ï¼†è‡ªå‹•è­¦å ± | Cloud IoT Core â†’ Apps Script Webhook â†’ `TRN_Incident` è‡ªå‹•ç™»éŒ² |
| 8 | FY2025 Q4 | ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹ | `Config.locale` å°å…¥ã€å¤šé€šè²¨æ›ç®—ã€è¨€èªåˆ‡æ›¿ï¼ˆi18n JSONï¼‰ |
| 9 | FY2026 Q1 | å®Œå…¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  BI | BigQuery + Looker Studioã€Back åˆ©ç”¨ãƒ­ã‚°ã§ UX æœ€é©åŒ– |

ã™ã¹ã¦ã®ãƒ•ã‚§ãƒ¼ã‚ºã§ Back ã‚¬ãƒ¼ãƒ‰ã¨ç›£æŸ»ãƒ­ã‚°ã‚’ç¶­æŒã—ã€UX ã¨çµ±åˆ¶ã‚’ä¸¡ç«‹ã€‚

---

## 48. ã¾ã¨ã‚ â€” ä¸–ç•Œæ°´æº– MPAGAS åŸºç›¤

* **UX**ï¼šIronman HUD Ã— AKIRA ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ UIã€‚Back å¸¸è¨­ãƒ»ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚°ãƒ­ãƒ¼ã§ç›´æ„Ÿæ“ä½œã€‚
* **ãƒ‡ãƒ¼ã‚¿çµ±åˆ¶**ï¼šUUID & å…±é€šåˆ—ã€ã‚½ãƒ•ãƒˆ/ãƒãƒ¼ãƒ‰å‰Šé™¤é¸æŠã€ç›£æŸ»ãƒ­ã‚°ï¼‹ãƒŠãƒ“ãƒ­ã‚°ã§å®Œå…¨è¿½è·¡ã€‚
* **æ‹¡å¼µæ€§**ï¼šApps Script ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ã€RBAC ãƒ«ãƒ¼ãƒˆã€BigQueryï¼AI é€£æºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã€‚
* **å®‰å¿ƒé‹ç”¨**ï¼šãƒªã‚¹ã‚¯ã‚¼ãƒ­è¨­è¨ˆï¼ˆãƒ­ãƒƒã‚¯ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¬ãƒ¼ãƒ‰ï¼‰ã€æ—¥æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€æ³•çš„ä¿æŒå¯¾å¿œã€‚

ã“ã®ç·åˆ·æ–°ä»•æ§˜ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€KUROZUMI ãƒ•ãƒ­ãƒ³ãƒˆã¨ Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒç„¡äºŒã®ãƒŠã‚¤ãƒˆã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ HQ ã‚’å®Ÿç¾ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ HUD ã§å…¨åº—èˆ—ã‚’æŒæ¡ã—ã€åŒæ™‚ã«ç›£æŸ»ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ãƒ»å¯è¦³æ¸¬æ€§ã®è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ãŒã§ãã‚‹ã€‚
äº†è§£ã€‚ã‚ãªãŸã®READMEã¨è¦ä»¶ã‚’**çµ¶å¯¾ä¿æŒ**ã—ãŸã†ãˆã§ã€Codexï¼ˆã¾ãŸã¯åŒç­‰ã®ç”ŸæˆAIï¼‰ãŒ**.gs/.htmlã®ã¿**ã§**GASÃ—MPAÃ—Sheets**ä¸€å¼ã‚’ç¢ºå®Ÿã«åãåˆ‡ã‚Œã‚‹ã‚ˆã†ã€**ã‚³ãƒ¼ãƒ‰ã¯å‡ºã•ãš**ã«ã€Œç”ŸæˆAIãŒå¾“ã†å¥‘ç´„ãƒ»é †åºãƒ»åˆæ ¼æ¡ä»¶ãƒ»è‡ªå·±æ¤œè¨¼ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ã€ã‚’æœ€å¤§å¼·åº¦ã§æ‹¡å¼µã—ã¾ã—ãŸã€‚
ä¸‹ã®å…¨æ–‡ã‚’ `CODEGEN.md`ï¼ˆv1.2ï¼‰ã¨ã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã«ç½®ã„ã¦ãã ã•ã„ã€‚READMEã¨ã‚»ãƒƒãƒˆã§èª­ã¿è¾¼ã¾ã›ã‚Œã°ã€**ä¸–ç•Œæ°´æº–ãƒ¬ãƒ™ãƒ«ã®ç²¾åº¦ã§ .gs / .html ã®ã¿**ã‚’æ®µéšç”Ÿæˆã•ã›ã‚‰ã‚Œã¾ã™ã€‚

---

# CODEGEN.md â€” KUROZUMI v1.2 ç”Ÿæˆã‚¿ã‚¹ã‚¯å°æœ¬ï¼ˆGAS Ã— MPA Ã— Google Sheetsï¼.gs & .html Onlyï¼‰

> **ç”¨é€”**ï¼šç”ŸæˆAIï¼ˆCodex ç­‰ï¼‰ãŒ**Apps Scriptï¼ˆ.gsï¼‰ï¼‹ HTMLServiceï¼ˆ.htmlï¼‰**ã ã‘ã§ã€READMEï¼ˆKUROZUMI v1.1ï¼‰ã®è¦ä»¶ã‚’**å®Œå…¨å……è¶³**ã™ã‚‹éª¨æ ¼å®Ÿè£…ã‚’**æ®µéšç”Ÿæˆ**ã™ã‚‹ãŸã‚ã®**å”¯ä¸€ã®ä»•æ§˜**ã€‚
> **ç¦æ­¢**ï¼šNode/TS/ãƒ“ãƒ«ãƒ‰/å¤–éƒ¨NPM/å¤–éƒ¨APIã€‚**.gs/.html ä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ãªã„**ã€‚
> **Master DB**ï¼š`https://docs.google.com/spreadsheets/d/1pJq2KT4WSfRIFdjGhZxm2m8aYfeq1g2KbUVLxPEL8TI/edit#gid=1926398647`ï¼ˆä»¥å¾Œã€ŒæŒ‡å®šãƒ–ãƒƒã‚¯ã€ï¼‰ã€‚**ã“ã®ãƒ–ãƒƒã‚¯ã‚’çµ¶å¯¾ã«å‰æ**ã¨ã™ã‚‹ã€‚

---

## 0) ã‚´ãƒ¼ãƒ« / éã‚´ãƒ¼ãƒ« / çµ¶å¯¾åˆ¶ç´„

### ã‚´ãƒ¼ãƒ«

* READMEï¼ˆKUROZUMI v1.1ï¼‰ï¼‹æœ¬å°æœ¬ v1.2 ã«**å®Œå…¨æº–æ‹ **ã—ãŸ **GASï¼ˆ.gsï¼‰Ã— MPAï¼ˆ.htmlï¼‰Ã— Sheetsï¼ˆMaster DBï¼‰** ã®**éª¨æ ¼ã‚³ãƒ¼ãƒ‰**ã‚’ã€**æ®µéšçš„ã«è‡ªå‹•ç”Ÿæˆ**ã•ã›ã‚‹ã€‚
* **æˆ»ã‚‹ï¼ˆBackï¼‰å¸¸è¨­ï¼çŠ¶æ…‹å¾©å…ƒï¼ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼å®Œå…¨ç›£æŸ»ï¼RBACï¼æœŸé–“é‡è¤‡æ¤œè¨¼**ã‚’**æœ€å°å®Ÿç”¨ãƒ¬ãƒ™ãƒ«**ã§å«ã‚€ã€‚
* **æŒ‡å®šãƒ–ãƒƒã‚¯**ã« CRUD ã™ã‚‹ã€‚**UIã®å‰Šé™¤ã¯ã‚½ãƒ•ãƒˆå‰Šé™¤æ—¢å®š**ï¼ˆéè¡¨ç¤ºã¾ãŸã¯ã‚°ãƒ¬ãƒ¼åŒ–ï¼‰ã€‚ãƒãƒ¼ãƒ‰å‰Šé™¤ã¯ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£çµŒç”±ã®ã¿ã€‚

### éã‚´ãƒ¼ãƒ«

* é«˜åº¦UIæ¼”å‡ºãƒ»æœ€é©åŒ–ã€BigQuery/Looker ç­‰ETLã€å¤–éƒ¨IDPé€£æºã€CI/CDã®è‡ªå‹•åŒ–ã€‚

### çµ¶å¯¾åˆ¶ç´„ï¼ˆé€¸è„±ç¦æ­¢ï¼‰

* ç”Ÿæˆç‰©ã¯ **.gs ã¨ .html ã®ã¿**ã€‚**.ts/.css/.json/.yml ãªã©ã¯ç¦æ­¢**ã€‚
* **ã‚¹ã‚­ãƒ¼ãƒåãƒ»åˆ—åãƒ»èªå½™**ã¯ README ã® `MST_* / TRN_* / LKP_* / LNK_*` ã¨**å®Œå…¨ä¸€è‡´**ã€‚
* **ã‚½ãƒ•ãƒˆå‰Šé™¤ï¼æ¨™æº–**ã€**ç›£æŸ»ãƒ­ã‚°ï¼å…¨æ“ä½œå¿…é ˆ**ã€‚
* **MPA**ã¯**Backãƒœã‚¿ãƒ³å¸¸è¨­**ï¼‹**å±¥æ­´N=50**ï¼‹**çŠ¶æ…‹å¾©å…ƒ**ã€‚
* **ER/ãƒ•ãƒ­ãƒ¼/æ©Ÿèƒ½é–¢é€£å›³**ã¯ README ã®è¨˜æ³•ãƒ»å†…å®¹ã‚’**ãã®ã¾ã¾** docs ã¸å†æ²ï¼ˆç·¨é›†ã—ãªã„ï¼‰ã€‚

---

## 1) ç”Ÿæˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆæ§‹æˆï¼ˆ.gs/.htmlã®ã¿ãƒ»å›ºå®šå‘½åï¼‰

> **æ³¨æ„**ï¼šã“ã“ã§å®£è¨€ã—ãŸ**ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»å½¹å‰²ãƒ»å…¬é–‹é–¢æ•°**ã¯**å¥‘ç´„**ã€‚å¿…ãšã“ã®æ§‹æˆãƒ»å‘½åã§å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚

```
apps_script/
  appsscript.json        #ï¼ˆâ€»ç”Ÿæˆã¯è¡Œã†ãŒæœ€çµ‚é…ç½®ã¯é–‹ç™ºè€…ãŒæ‰‹å‹•åæ˜ ã€‚ä¸­èº«ã¯æœ¬å°æœ¬ã§è¦ä»¶å®šç¾©ã®ã¿ï¼‰
  Config.gs              # å®šæ•°ï¼ˆSS_MASTER_ID, ã‚·ãƒ¼ãƒˆå, å…±é€šåˆ—, ã‚¹ã‚­ãƒ¼ãƒç‰ˆï¼‰
  Uuid.gs                # UUID/ULID ç”Ÿæˆ
  Time.gs                # ISOæ—¥æ™‚ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  Lock.gs                # LockService ãƒ©ãƒƒãƒ‘ï¼ˆæŒ‡æ•°ãƒªãƒˆãƒ©ã‚¤ï¼‰
  Sheets.gs              # ã‚·ãƒ¼ãƒˆIOãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆget/ensure/append/batch/updateï¼‰
  Repo.gs                # æ±ç”¨CRUDï¼ˆfindById/query/upsert/softDelete/hardDeleteï¼‰
  Validate.gs            # å¿…é ˆ/LKP/æœŸé–“é‡è¤‡/ä¸€æ„
  Audit.gs               # TRN_AuditTrail/Item ã¸ã®å®Œå…¨ç›£æŸ»è¨˜éŒ²
  NavService.gs          # å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆBackå¸¸è¨­/çŠ¶æ…‹ä¿å­˜ãƒ»å¾©å…ƒï¼‰
  UiRouteService.gs      # ãƒ«ãƒ¼ãƒˆæ¨©é™åˆ¶å¾¡ï¼ˆæœ€å°ã¯in-memoryã€æ‹¡å¼µã§MST_Ui*å‚ç…§ï¼‰
  PersonService.gs       # Person/Employmentã®æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯
  PersonEndpoints.gs     # /api/person.* ã®å…¥å£ï¼ˆdoPostãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰
  StoreService.gs        # Storeå‘¨è¾ºï¼ˆæœ€å°ï¼šå‚ç…§ãƒ»é››å½¢ï¼‰
  PricingService.gs      # ä¾¡æ ¼upsertï¼ˆæœŸé–“é‡è¤‡æ¤œè¨¼ï¼‰
  UiController.gs        # doGet / doPostï¼ˆJSON APIãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ï¼‰
  index.html             # ãƒ«ãƒ¼ãƒˆHTMLï¼ˆå›ºå®šãƒ˜ãƒƒãƒ€Back/ãƒ‘ãƒ³ããš/2ãƒšã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
  styles.html            # HUDé¢¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ <style> ã®ã¿ï¼å¤–éƒ¨CSSç¦æ­¢ï¼‰
  scripts.html           # MPAãƒ­ã‚¸ãƒƒã‚¯ï¼ˆBack/å±¥æ­´/æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰/ãƒ•ã‚§ãƒƒãƒï¼‰
docs/
  er/*.md                # READMEæ²è¼‰ã®Mermaidã‚’ãã®ã¾ã¾å†æ²ï¼ˆå†…å®¹å¤‰æ›´ç¦æ­¢ï¼‰
```

> `sheets/` ä»¥ä¸‹ã®CSVã‚„mdã¯**ä»Šå›ã®å‡ºåŠ›å¯¾è±¡å¤–**ï¼ˆã‚³ãƒ¼ãƒ‰ç¦æ­¢è¦ä»¶ã®ãŸã‚ï¼‰ã€‚å¿…è¦ãªå®šç¾©ã¯ `Config.gs` ã«æ˜è¨˜ã€‚
> Mermaid ã¯**READMEã«æ—¢å‡º**ã®ã‚‚ã®ã‚’**å†æ²**ã™ã‚‹ã ã‘ï¼ˆç”ŸæˆAIã¯ä¸­èº«ã«æ‰‹ã‚’åŠ ãˆãªã„ï¼‰ã€‚

---

## 2) å…±æœ‰å®šç¾©ï¼ˆä¸å¤‰å¥‘ç´„ï¼‰

* **Master DB**ï¼šæŒ‡å®šãƒ–ãƒƒã‚¯ã‚’ `SpreadsheetApp.openById(SS_MASTER_ID)`ã€‚
* **å…±é€šåˆ—**ï¼š`created_at, created_by, updated_at, updated_by, active_flag, deleted_at, deleted_by`ï¼ˆå…¨è¡¨å¿…é ˆï¼‰ã€‚
* **ã‚­ãƒ¼**ï¼šå†…éƒ¨ã‚­ãƒ¼ï¼UUID/ULIDã€äººé–“å¯èª­ã‚³ãƒ¼ãƒ‰ã¯åˆ¥åˆ—ã€‚
* **æœŸé–“åˆ—**ï¼š`start_on, end_on`ï¼ˆä¾¡æ ¼/å¥‘ç´„/é…å±ç­‰ï¼‰â†’**é‡è¤‡ç¦æ­¢**ã€‚
* **ã‚½ãƒ•ãƒˆå‰Šé™¤æ¨™æº–**ï¼š`active_flag=false`ï¼‹`deleted_*`ã€‚UIã¯éè¡¨ç¤ºï¼ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼ˆä¸¡å¯¾å¿œï¼‰ã€‚
* **ç›£æŸ»**ï¼š`TRN_AuditTrail`ï¼ˆãƒ˜ãƒƒãƒ€ï¼‰ï¼‹`TRN_AuditItem`ï¼ˆå·®åˆ†ï¼‰ã€‚**å…¨æ“ä½œå¿…é ˆ**ã€‚
* **UI/ãƒŠãƒ“**ï¼šBackå¸¸è¨­ã€å±¥æ­´N=50ã€çŠ¶æ…‹å¾©å…ƒï¼ˆæ¤œç´¢æ¡ä»¶/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ/é¸æŠ/ãƒ‰ãƒ­ãƒ¯ãƒ¼ï¼‰ã€æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰ã€‚
* **ER/ãƒ•ãƒ­ãƒ¼å›³**ï¼šREADMEã®Mermaidã‚’ãã®ã¾ã¾ `docs/er/` ã«å†æ²ã€‚

---

## 3) ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã€Œå…¬é–‹é–¢æ•°ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å¥‘ç´„ã€ï¼ˆ**ã‚³ãƒ¼ãƒ‰ã¯æ›¸ã‹ãªã„ï¼ç½²åã¨ç›®çš„ã®ã¿**ï¼‰

> ç”ŸæˆAIã¯**ä»¥ä¸‹ã®é–¢æ•°ã‚’å¿…ãšå®Ÿè£…**ã€‚åå‰ãƒ»å¼•æ•°ã‚­ãƒ¼ãƒ»è¿”å´å½¢ã¯**ã“ã®å¥‘ç´„ã«ä¸€è‡´**ã•ã›ã‚‹ã“ã¨ã€‚

### Config.gs

* `Config.getMasterId(): string` â€” **å›ºå®šã§** æŒ‡å®šãƒ–ãƒƒã‚¯IDã‚’è¿”ã™ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰ã€‚
* `Config.tables(): { [logicalName: string]: string }` â€” `MST_* / TRN_* / LKP_* / LNK_*` **å…¨ã‚·ãƒ¼ãƒˆå**ã‚’è¿”ã™ã€‚
* `Config.commonColumns(): string[]` â€” å…±é€šåˆ—é…åˆ—ã€‚
* `Config.schemaVersion(): string` â€” `v1.1` ç­‰ã€‚
* `Config.ui(): { historySize: number }` â€” å±¥æ­´ä¸Šé™ï¼ˆ50ï¼‰ã€‚

### Uuid.gs

* `Uuid.newUuid(): string`
* `Uuid.newUlid(): string`ï¼ˆç°¡æ˜“ULIDã§å¯ï¼‰

### Time.gs

* `Time.nowIso(): string`
* `Time.todayIso(): string`
* `Time.parseIso(s: string): Date`

### Lock.gs

* `Lock.withLock(key: string, fn: () => any): any` â€” æŒ‡æ•°ãƒªãƒˆãƒ©ã‚¤3å›ã€500msæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã€‚

### Sheets.gs

* `Sheets.getSheet(name: string): GoogleAppsScript.Spreadsheet.Sheet`
* `Sheets.ensureSheet(name: string, headers: string[]): void`
* `Sheets.getHeader(name: string): string[]`
* `Sheets.getAll(name: string, opts?: { activeOnly?: boolean }): any[]`
* `Sheets.append(name: string, row: object): string` â€” è¿”å´ã¯æ–°UUIDç­‰ã€‚
* `Sheets.batchUpdate(name: string, rowsByIndex: { index: number, row: object }[]): void`

### Repo.gs

* `Repo.findById(table: string, id: string): object|null`
* `Repo.query(table: string, filter: object): object[]`
* `Repo.upsert(table: string, obj: object, userId: string): { id: string, created: boolean }`
* `Repo.softDelete(table: string, id: string, userId: string): { id: string, status: 'SOFT_DELETED' }`
* `Repo.hardDelete(table: string, id: string, userId: string): { id: string, status: 'HARD_DELETED' }`

### Validate.gs

* `Validate.require(obj: object, requiredKeys: string[]): void|Error`
* `Validate.inList(value: string, list: string[]): void|Error`
* `Validate.dateRange(start: string, end: string): void|Error`
* `Validate.noOverlap(table: string, keySet: object, start: string, end: string): void|Error`
* `Validate.uniqueCombo(table: string, keys: string[], values: any[]): void|Error`

### Audit.gs

* `Audit.log(userId: string, entity: string, entityId: string, op: 'CREATE'|'UPDATE'|'DELETE_SOFT'|'RESTORE'|'DELETE_HARD', beforeObj: object|null, afterObj: object|null): void`

### NavService.gs

* `Nav.push(route: string, params: object, state: object): void`
* `Nav.replace(route: string, params: object, state: object): void`
* `Nav.back(): { route: string, params: object, state: object }|null`
* `Nav.reset(toRoute?: string): void`

### UiRouteService.gs

* **æœ€å°æ§‹æˆ**ï¼šin-memory

  * `UiRoutes.allowedFor(roleCode: string): { route: string, title: string }[]`
* **æ‹¡å¼µæ§‹æˆ**ï¼šMST_UiRoute/MST_UiRouteAccessã«ã‚‚å¯¾å¿œã§ãã‚‹æŸ”è»Ÿãªè¨­è¨ˆï¼ˆå­˜åœ¨åˆ¤å®šã§ãƒãƒ³ãƒ‰ã‚ªãƒ¼ãƒï¼‰

### PersonService.gs

* `PersonService.create(payload: { person: object, employment?: object }, userId: string): { person_id: string }`
* `PersonService.update(personId: string, patch: object, userId: string): { updated: true, diff: object }`
* `PersonService.softDelete(personId: string, reason: string|undefined, userId: string): { status: 'SOFT_DELETED' }`
* `PersonService.restore(personId: string, userId: string): { status: 'RESTORED' }`

### PersonEndpoints.gsï¼ˆ/apiï¼‰

* `ApiPerson.create(request: object): object` â†’ `/api/person.create`
* `ApiPerson.update(request: object): object` â†’ `/api/person.update`
* `ApiPerson.deleteSoft(request: object): object` â†’ `/api/person.deleteSoft`
* `ApiPerson.restore(request: object): object` â†’ `/api/person.restore`

### PricingService.gs

* `PricingService.upsertPrice(payload: { menu_item_id: string, price: number, tax_code: string, start_on: string, end_on: string, store_id?: string, timeband?: string }, userId: string): { price_id: string }`

  * **é‡è¤‡æ™‚**ã¯ 409 ç›¸å½“ã®ã‚¨ãƒ©ãƒ¼è¿”å´ï¼ˆ`{ ok:false, code:'PRICE_RANGE_OVERLAP', ... }`ï¼‰ã€‚

### StoreService.gs

* æœ€å°ï¼šå‚ç…§ã‚„é››å½¢é–¢æ•°ã‚’ç”¨æ„ï¼ˆä»Šå¾Œæ‹¡å¼µï¼‰ã€‚`StoreService.findByCode`, ãªã©ã€‚

### UiController.gs

* `doGet(e)`ï¼šStartâ†’ã‚«ãƒ†ã‚´ãƒªâ†’ä¸€è¦§â†’è©³ç´°ï¼ˆBackå¸¸è¨­ï¼‰ã€‚
* `doPost(e)`ï¼š`/api/*` ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã€‚**å…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ `{ ok: true|false, data|code|message|details }` è¦ç´„**ã€‚

### index.html / styles.html / scripts.html

* **index.html**ï¼šå›ºå®šãƒ˜ãƒƒãƒ€ï¼ˆBackãƒ»Breadcrumbãƒ»SessionInfoï¼‰ï¼‹å·¦ã‚«ãƒ†ã‚´ãƒªÃ—å³ãƒ†ãƒ¼ãƒ–ãƒ«ã®2ãƒšã‚¤ãƒ³ã€‚
* **styles.html**ï¼š**å†…è”µ `<style>`** ã«HUDï¼ˆãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼‹ã‚·ã‚¢ãƒ³å¾®ç™ºå…‰ï¼AAã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼è§’ä¸¸2xlï¼ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ï¼è¡Œã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼‰ã€‚
* **scripts.html**ï¼š`NAV_PUSH/REPLACE/BACK/RESET`ã€æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰ï¼ˆç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã€`fetch('/api/*')` ãƒ©ãƒƒãƒ‘ã€å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆã®åˆ¶å¾¡ã€‚

---

## 4) ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆé †åºãƒ»ä½œæ³•ãƒ»åˆæ ¼æ¡ä»¶ï¼‰

> **ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†å‰ã«æ¬¡ã¸é€²ã‚“ã§ã¯ã„ã‘ãªã„ã€‚** å„ã‚¹ãƒ†ãƒ¼ã‚¸ã§**ACï¼ˆAcceptance Criteriaï¼‰è‡ªå·±æ¤œè¨¼**â†’**æº€ãŸã™ã¾ã§ãƒªãƒˆãƒ©ã‚¤**ã€‚

### Stage 1 â€” ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ & å®šæ•°

**å‡ºåŠ›**ï¼š`appsscript.json`, `Config.gs`
**è¦ä»¶**ï¼š

* ã‚¹ã‚³ãƒ¼ãƒ—ï¼š`https://www.googleapis.com/auth/spreadsheets`, `.../drive.readonly`
* `SS_MASTER_ID` ã¯ **æŒ‡å®šãƒ–ãƒƒã‚¯IDã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰**
* `Config.tables()` ã« **å…¨ãƒ†ãƒ¼ãƒ–ãƒ«å**ï¼ˆREADMEæº–æ‹ ï¼‰
  **AC**ï¼š
* ã‚¹ã‚³ãƒ¼ãƒ—ãŒæ­£ã—ãå®£è¨€ã•ã‚Œã¦ã„ã‚‹
* å‚ç…§å…ˆID/è¡¨å/å…±é€šåˆ—/å±¥æ­´ä¸Šé™ãŒ**å®šæ•°åŒ–**ã•ã‚Œã¦ã„ã‚‹

### Stage 2 â€” åŸºç›¤ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

**å‡ºåŠ›**ï¼š`Uuid.gs`, `Time.gs`, `Lock.gs`, `Sheets.gs`
**è¦ä»¶**ï¼š

* Lockã¯æŒ‡æ•°ãƒªãƒˆãƒ©ã‚¤ï¼ˆ3å›/500msæŒ‡æ•°ï¼‰
* ensureSheetã¯ãƒ˜ãƒƒãƒ€è‡ªå‹•è¨­å®š
* ã™ã¹ã¦JSDocã§I/Oãƒ»ä¾‹å¤–ã‚’è¨˜è¿°
  **AC**ï¼š
* æ“¬ä¼¼çš„ã« `ensureSheet` æƒ³å®šã§ãƒ˜ãƒƒãƒ€ãŒç„¡ã„å ´åˆã®**è‡ªå‹•ä½œæˆæ‰‹é †**ãŒä»•æ§˜ã«æ²¿ã†

### Stage 3 â€” Repo / Validate / Audit

**å‡ºåŠ›**ï¼š`Repo.gs`, `Validate.gs`, `Audit.gs`
**è¦ä»¶**ï¼š

* `upsert` ã¯ `created_* / updated_*` ã‚’è‡ªå‹•ä»˜ä¸
* `softDelete` ã¯ `active_flag=false` ã¨ `deleted_*`ã€ç›£æŸ» `DELETE_SOFT` ã‚’è¨˜éŒ²
* `noOverlap` ã¯åŒä¸€ã‚­ãƒ¼é›†åˆå†…ã®æœŸé–“é‡è¤‡ã‚’æ¤œå‡º
  **AC**ï¼š
* CREATE/UPDATE/DELETE_SOFT/RESTORE/DELETE_HARD ãŒ `TRN_AuditTrail/Item` ã«å¿…ãšæ®‹ã‚‹
* `noOverlap` ãŒ READMEã®æœŸé–“æ•´åˆãƒ«ãƒ¼ãƒ«ã«åˆè‡´

### Stage 4 â€” UIãƒŠãƒ“ & RBACï¼ˆBackå¸¸è¨­ï¼‰

**å‡ºåŠ›**ï¼š`NavService.gs`, `UiRouteService.gs`, `UiController.gs`, `index.html`, `styles.html`, `scripts.html`
**è¦ä»¶**ï¼š

* å›ºå®šãƒ˜ãƒƒãƒ€Backã€å±¥æ­´N=50ã€çŠ¶æ…‹å¾©å…ƒã€æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰
* 403ã®ç°¡æ˜“æ¨©é™ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆè©³ç´°RBACã¯æ‹¡å¼µã§MST_Ui*å¯ï¼‰
  **AC**ï¼š
* ä¸€è¦§â†’è©³ç´°â†’ç·¨é›†â†’Backã§**æ¤œç´¢æ¡ä»¶/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ/é¸æŠ/ãƒ‰ãƒ­ãƒ¯ãƒ¼**ãŒå¾©å…ƒ

### Stage 5 â€” ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆPeople / Pricing / Storeé››å½¢ï¼‰

**å‡ºåŠ›**ï¼š`PersonService.gs`, `PersonEndpoints.gs`, `PricingService.gs`, `StoreService.gs`
**è¦ä»¶**ï¼š

* Peopleï¼šcreate/update/softDelete/restoreï¼ˆé‡è¤‡ï¼æ°åã‚«ãƒŠï¼‹ç”Ÿå¹´æœˆæ—¥ï¼‹é›»è©±ã®å³å¯†ä¸€è‡´ï¼‰
* Pricingï¼šåŒ `menu_item_id+store_id` ã®**æœŸé–“é‡è¤‡**ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ409ï¼‰
  **AC**ï¼š
* person.create ãŒé‡è¤‡æ™‚ã« `DUPLICATE_PERSON` ã‚’è¿”ã™
* price.upsert ãŒé‡è¤‡æ™‚ã« `PRICE_RANGE_OVERLAP` ã‚’è¿”ã™

### Stage 6 â€” æœ€å°E2Eæ•´åˆ

**å‡ºåŠ›**ï¼š**ãªã—ï¼ˆè‡ªå·±æ¤œè¨¼ï¼‰**
**è¦ä»¶**ï¼šAPI å…¨ç³»ã®**I/Oæ•´åˆ**ã€Back ã®**3æ®µå¾©å¸°**ã€ã‚½ãƒ•ãƒˆå‰Šé™¤â†’UIéè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼è¡¨ç¤ºã®**åˆ‡æ›¿**ã€ç›£æŸ»ãŒ**å¿…ãšè¨˜éŒ²**
**AC**ï¼š

* **AC-01**ã€œ**AC-06**ï¼ˆå¾Œè¿°ï¼‰ã‚’**ã™ã¹ã¦æº€ãŸã™**ã“ã¨

---

## 5) API ä»•æ§˜ï¼ˆ/api/* å¥‘ç´„ãƒ»ã‚¨ãƒ©ãƒ¼è¦ç´„ï¼‰

**å…±é€š**

* Baseï¼š`/api/*`
* æˆåŠŸï¼š`{ "ok": true, "data": {...} }`
* å¤±æ•—ï¼š`{ "ok": false, "code": "ERROR_CODE", "message": "...", "details": {...} }`

**People**

* `POST /api/person.create` â†’ `{ person:{...}, employment?:{...} }` / `{ person_id }`

  * å¤±æ•—: `DUPLICATE_PERSON`, `VALIDATION_FAILED`
* `POST /api/person.update` â†’ `{ person_id, patch:{...} }` / `{ updated:true, diff:{...} }`
* `POST /api/person.deleteSoft` â†’ `{ person_id, reason? }` / `{ status:"SOFT_DELETED" }`
* `POST /api/person.restore` â†’ `{ person_id }` / `{ status:"RESTORED" }`

**Pricing**

* `POST /api/price.upsert` â†’ `{ menu_item_id, price, tax_code, start_on, end_on, store_id?, timeband? }`

  * å¤±æ•—: `PRICE_RANGE_OVERLAP`ï¼ˆ409ç›¸å½“ï¼‰

**Navigationï¼ˆä»»æ„æ‹¡å¼µï¼‰**

* `POST /api/nav.push` â†’ `{ route, params }`ï¼ˆå¿…è¦ãªã‚‰ `TRN_UiNavLog` è¨˜éŒ²ï¼‰

---

## 6) å—ã‘å…¥ã‚Œæ¡ä»¶ï¼ˆACï¼‰â€”â€”**æº€ãŸã™ã¾ã§æ¬¡ã«é€²ã¾ãªã„**

* **AC-01 Back å¾©å¸°**ï¼šä¸€è¦§â†’è©³ç´°â†’ç·¨é›†â†’Backã§**æ¤œç´¢æ¡ä»¶/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ/é¸æŠ/ãƒ‰ãƒ­ãƒ¯ãƒ¼**ãŒå¾©å…ƒã€‚
* **AC-02 ã‚½ãƒ•ãƒˆå‰Šé™¤**ï¼šUIå‰Šé™¤ã§ `active_flag=false`ï¼‹`deleted_*`ã€**UIéè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼**ãŒé¸æŠå¯èƒ½ã€‚
* **AC-03 ç›£æŸ»**ï¼šcreate/update/deleteSoft/restore/hardDeleteã®**å…¨æ“ä½œ**ã§ `TRN_AuditTrail/Item` ã«è¨˜éŒ²ã€‚
* **AC-04 ä¾¡æ ¼é‡è¤‡**ï¼šåŒ `menu_item_id+store_id` ã®æœŸé–“ãŒé‡è¤‡ã™ã‚‹ã¨ 409 ã‚¨ãƒ©ãƒ¼ï¼ˆ`PRICE_RANGE_OVERLAP`ï¼‰ã€‚
* **AC-05 ã‚¹ã‚­ãƒ¼ãƒ**ï¼š**å…¨CRUD**ãŒ README ã®**è¡¨åãƒ»åˆ—å**ã§å‹•ä½œï¼ˆensureSheetã§ä¸è¶³åˆ—ã¯è‡ªå‹•ä»˜ä¸ï¼‰ã€‚
* **AC-06 æŒ‡å®šãƒ–ãƒƒã‚¯**ï¼š`SS_MASTER_ID` ãŒ**æŒ‡å®šID**ã‹ã¤ `openById` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚

---

## 7) UI/UXã‚¬ã‚¤ãƒ‰ï¼ˆéª¨æ ¼ã®ã¿ï¼HTMLå†…è”µCSSã®ã¿ï¼‰

* **ãƒˆãƒ¼ãƒ³**ï¼šãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼‹ã‚·ã‚¢ãƒ³å¾®ç™ºå…‰ã€è§’ä¸¸2xlã€ã‚½ãƒ•ãƒˆã‚·ãƒ£ãƒ‰ã‚¦ã€AAã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ã€‚
* **å›ºå®šãƒ˜ãƒƒãƒ€**ï¼šå·¦ä¸Š Backï¼ˆ`Alt+â†` é€£å‹•ï¼‰ï¼Breadcrumbï¼Session Infoã€‚
* **ä¸€è¦§**ï¼šå·¦ã‚«ãƒ†ã‚´ãƒªÃ—å³ãƒ†ãƒ¼ãƒ–ãƒ«ã€ä¸Šéƒ¨ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ã€ã‚½ãƒ•ãƒˆå‰Šé™¤è¡Œã¯ `line-through + opacity`ã€‚
* **ç·¨é›†**ï¼šãƒ‰ãƒ­ãƒ¯ãƒ¼ã€å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆã€ä¿å­˜æ™‚ã‚°ãƒ­ãƒ¼ã€‚
* **æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰**ï¼šç ´æ£„/ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®3æŠã€‚
* **å¤–éƒ¨CSSç¦æ­¢**ï¼š`styles.html` ã® `<style>` ã«**å†…è”µã§å®Œçµ**ã€‚

---

## 8) è‡ªå·±æ¤œè¨¼ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ï¼ˆç”ŸæˆAIå‘ã‘ï¼‰

ç”ŸæˆAIã¯å„ã‚¹ãƒ†ãƒ¼ã‚¸çµ‚äº†æ™‚ã«æ¬¡ã‚’**è‡ªå·±è©•ä¾¡**ã—ã€**ä¸è¶³ç‚¹ã‚’è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤**ï¼š

1. **å¥‘ç´„éµå®ˆ**ï¼šé–¢æ•°åãƒ»å¼•æ•°åãƒ»è¿”å´å‹ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åãŒ**æœ¬å°æœ¬ã¨ä¸€è‡´**ã—ã¦ã„ã‚‹ã‹ã€‚
2. **Sheetä¾å­˜**ï¼š`Config.tables()` ã®è¡¨åã¨ CRUD ãŒ**å³å¯†ä¸€è‡´**ã‹ã€‚
3. **ç›£æŸ»ç¶²ç¾…**ï¼šã™ã¹ã¦ã®å¤‰æ›´ãƒ‘ã‚¹ã§ `Audit.log` ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ã€‚
4. **å‰Šé™¤ã®ä¸€è²«æ€§**ï¼šUIã®å‰Šé™¤â†’softDeleteâ†’ç›£æŸ»â†’UIè¡¨ç¤ºï¼ˆéè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼ï¼‰ã®ä¸€è²«æ€§ã€‚
5. **Backå†ç¾**ï¼šå±¥æ­´N=50ã«ã‚ˆã‚Š3æ®µä»¥ä¸Šã®å¾€å¾©ã§çŠ¶æ…‹å¾©å…ƒã§ãã‚‹ã‹ï¼ˆç–‘ä¼¼ã‚·ãƒŠãƒªã‚ªã§æƒ³å®šæ¤œè¨¼ï¼‰ã€‚
6. **é‡è¤‡æ¤œçŸ¥**ï¼š`DUPLICATE_PERSON`ï¼`PRICE_RANGE_OVERLAP` ã®ã‚¨ãƒ©ãƒ¼è¿”å´ãŒã§ãã‚‹ã‹ã€‚
7. **ã‚¨ãƒ©ãƒ¼è¦ç´„**ï¼šå¤±æ•—æ™‚ `{ ok:false, code, message }` å½¢å¼ã«ãªã£ã¦ã„ã‚‹ã‹ã€‚

---

## 9) ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ï¼ˆè©°ã¾ã£ãŸæ™‚ã®æŒ‡ç¤ºï¼‰

* **ç¦æ­¢**ï¼šæ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã‚€ã“ã¨ã€.gs/.htmlä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºã™ã“ã¨ã€‚
* **è¨±å¯**ï¼šåŒã‚¹ãƒ†ãƒ¼ã‚¸å†…ã§ã®**å†ç”Ÿæˆ**ã€è£œåŠ©ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã€æœªå®Ÿè£…é–¢æ•°ã®åŸ‹ã‚æˆ»ã—ã€‚
* **çµ‚äº†æ¡ä»¶**ï¼šå½“è©²ã‚¹ãƒ†ãƒ¼ã‚¸ã®**ACã™ã¹ã¦ã‚’æº€ãŸã—ãŸ**ã¨ãã€‚

---

## 10) Codex ã¸ã®æŠ•å…¥ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆã“ã®ã¾ã¾æŠ•ã’ã‚‹ã ã‘ï¼‰

### PROMPT-GLOBALï¼ˆå‰ç½®ãï¼‰

```
ã‚ãªãŸã¯ä¸Šç´šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯ Apps Scriptï¼ˆ.gsï¼‰ã¨ HTMLServiceï¼ˆ.htmlï¼‰ã ã‘ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
æ¬¡ã‚’å”¯ä¸€ã®ä»•æ§˜ã¨ã¿ãªã—ã€å‘½åãƒ»I/Oãƒ»ã‚¹ã‚­ãƒ¼ãƒã«ä¸€åˆ‡ã®é€¸è„±ã‚’è¨±ã—ã¾ã›ã‚“ï¼š
- README.mdï¼ˆKUROZUMI v1.1 å…¨æ–‡ï¼‰
- CODEGEN.mdï¼ˆv1.2ï¼ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

çµ¶å¯¾åˆ¶ç´„ï¼š
- ç”Ÿæˆç‰©ã¯ .gs ã¨ .html ã®ã¿ï¼ˆ.ts/.css/.json/.yml ãªã©ç¦æ­¢ï¼‰
- æŒ‡å®šãƒ–ãƒƒã‚¯IDã‚’ Config ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
- ã‚½ãƒ•ãƒˆå‰Šé™¤æ—¢å®šã€ç›£æŸ»ãƒ­ã‚°å¿…é ˆã€Backå¸¸è¨­ãƒ»çŠ¶æ…‹å¾©å…ƒ
- ã‚¹ã‚­ãƒ¼ãƒåãƒ»åˆ—åã¯ README ã®å®šç¾©ã«å³å¯†ä¸€è‡´

å‡ºåŠ›ã¯ã‚¹ãƒ†ãƒ¼ã‚¸é †ï¼ˆStage1â†’Stage6ï¼‰ã€‚å„ã‚¹ãƒ†ãƒ¼ã‚¸ã§ AC ã‚’è‡ªå·±æ¤œè¨¼ã—ã€æº€ãŸã•ãªã„å ´åˆã¯å½“è©²ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å†ç”Ÿæˆã—ã¦ã‹ã‚‰æ¬¡ã¸é€²ã‚“ã§ãã ã•ã„ã€‚
```

### PROMPT-STAGE1

```
Stage1 ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- apps_script/appsscript.jsonï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ï¼šspreadsheets æ›¸èª­, drive.readonlyï¼‰
- apps_script/Config.gsï¼ˆSS_MASTER_ID, tables(), commonColumns(), schemaVersion(), ui()ï¼‰

ACï¼š
- ã‚¹ã‚³ãƒ¼ãƒ—ãŒæ­£ã—ã„
- æŒ‡å®šãƒ–ãƒƒã‚¯IDãŒå®šæ•°ã§åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹
- tables() ã« READMEã®å…¨ãƒ†ãƒ¼ãƒ–ãƒ«åãŒå«ã¾ã‚Œã‚‹
```

### PROMPT-STAGE2

```
Stage2 ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- Uuid.gs / Time.gs / Lock.gs / Sheets.gs
- JSDoc ã§å…¨é–¢æ•°ã® I/O/ä¾‹å¤–ã‚’æ˜è¨˜
- Lock.withLock ã¯æŒ‡æ•°ãƒªãƒˆãƒ©ã‚¤ï¼ˆ3å›/500msæŒ‡æ•°ï¼‰
- Sheets.ensureSheet ã¯ãƒ˜ãƒƒãƒ€ã‚’è‡ªå‹•ã‚»ãƒƒãƒˆ

ACï¼š
- ensureSheet ã®ä»•æ§˜ã©ãŠã‚Šã«ãƒ˜ãƒƒãƒ€ã‚’ä½œã‚Œã‚‹
- getAll(activeOnly:true) ã§ã‚½ãƒ•ãƒˆå‰Šé™¤è¡Œã‚’é™¤å¤–å–å¾—ã§ãã‚‹
```

### PROMPT-STAGE3

```
Stage3 ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- Repo.gs / Validate.gs / Audit.gs

è¦ä»¶ï¼š
- upsert ãŒ created_*/updated_* ã‚’è‡ªå‹•ä»˜ä¸
- softDelete ãŒ active_flag=false & deleted_* ã‚’è¨­å®šã—ã€ç›£æŸ» DELETE_SOFT ã‚’æ®‹ã™
- noOverlap ãŒåŒä¸€ã‚­ãƒ¼é›†åˆã®æœŸé–“é‡è¤‡ã‚’æ¤œçŸ¥

ACï¼š
- CREATE/UPDATE/DELETE_SOFT/RESTORE/DELETE_HARD ãŒã™ã¹ã¦ AuditTrail/Item ã«è¨˜éŒ²ã•ã‚Œã‚‹
```

### PROMPT-STAGE4

```
Stage4 ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- NavService.gs / UiRouteService.gs / UiController.gs
- index.html / styles.html / scripts.htmlï¼ˆå¤–éƒ¨CSSç¦æ­¢ã€<style>å†…è”µï¼‰
è¦ä»¶ï¼š
- å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ Backã€å±¥æ­´N=50ã€çŠ¶æ…‹å¾©å…ƒã€æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰
- RBACç°¡æ˜“ï¼ˆæ‹¡å¼µã§ MST_Ui* ã«å¯¾å¿œå¯èƒ½ãªè¨­è¨ˆï¼‰
ACï¼š
- ä¸€è¦§â†’è©³ç´°â†’ç·¨é›†â†’Back ã§æ¤œç´¢æ¡ä»¶/ãƒšãƒ¼ã‚¸/ã‚½ãƒ¼ãƒˆ/é¸æŠ/ãƒ‰ãƒ­ãƒ¯ãƒ¼ã‚’å¾©å…ƒ
```

### PROMPT-STAGE5

```
Stage5 ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- PersonService.gs / PersonEndpoints.gs / StoreService.gs / PricingService.gs
- /api/person.* ãŠã‚ˆã³ /api/price.upsert

ACï¼š
- person.create ãŒæ°åã‚«ãƒŠï¼‹ç”Ÿå¹´æœˆæ—¥ï¼‹é›»è©±ã®å³å¯†ä¸€è‡´ã§é‡è¤‡æ¤œçŸ¥ã— DUPLICATE_PERSON ã‚’è¿”ã™
- price.upsert ãŒæœŸé–“é‡è¤‡ã‚’æ¤œçŸ¥ã— PRICE_RANGE_OVERLAP ã‚’è¿”ã™
```

### PROMPT-STAGE6

```
Stage6ï¼ˆæœ€å°E2Eæ•´åˆï¼‰ï¼š
- ç”Ÿæˆç‰©ã¯ .gs/.html ã®ã¿ã‹ã‚’ç¢ºèª
- AC-01ã€œAC-06 ã‚’æº€ãŸã™ã¾ã§ä¸è¶³ç®‡æ‰€ã‚’å½“è©²ã‚¹ãƒ†ãƒ¼ã‚¸ã§å†ç”Ÿæˆã—ã¦è£œå®Œ
- æº€ãŸã—ãŸã‚‰å®Œäº†
```

---

## 11) ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/é‹ç”¨ã®æœ€ä½ãƒ©ã‚¤ãƒ³ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ã™ã¹ãäº‹é …ï¼‰

* `Config.gs` ã« **PIIã¯åˆ¥ãƒ–ãƒƒã‚¯ã§é‹ç”¨**ã®æ–¹é‡ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰ã€‚
* `Repo.hardDelete` ã¯**ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‹ã‚‰ã®ã¿**å‘¼ã³å‡ºã™æ—¨ã®ã‚³ãƒ¡ãƒ³ãƒˆã€‚
* `Lock.withLock` ã‚’**æ›¸è¾¼å‰**ã«å¿…ãšä½¿ã†è¨­è¨ˆæ–¹é‡ã®ã‚³ãƒ¡ãƒ³ãƒˆã€‚
* `UiController.doPost` ã¯**å…¨ã¦ `{ ok: true|false, ... }` è¦ç´„**ã‚’å¼·åˆ¶ã™ã‚‹æ—¨ã®ã‚³ãƒ¡ãƒ³ãƒˆã€‚

---

## 12) ç›£æŸ»ãƒ»å¯è¦³æ¸¬æ€§ï¼ˆæœ€å°éª¨æ ¼ï¼‰

* ã™ã¹ã¦ã®å¤‰æ›´ç³»APIã§ `Audit.log` ã‚’å‘¼ã³å‡ºã—ã€`TRN_AuditTrail` ã¨ `TRN_AuditItem` ã‚’æ›´æ–°ã€‚
* UIã§ã®å‰Šé™¤æ“ä½œã¯**å¿…ãš**ã‚½ãƒ•ãƒˆå‰Šé™¤â†’UIåæ˜ ï¼ˆéè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼ï¼‰â†’ç›£æŸ»è¨˜éŒ²ã®é †åºã‚’ä¿è¨¼ã€‚
* ä»»æ„ã§ `TRN_UiNavLog` ã‚’æ‹¡å¼µæ™‚ã«è¨˜éŒ²ï¼ˆæœ€å°æ§‹æˆã§ã¯ã‚¹ã‚­ãƒƒãƒ—å¯ï¼‰ã€‚

---

## 13) ä»•ä¸Šã’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆé–‹ç™ºè€…ãŒè¦‹ã‚‹ã¹ãè¦³ç‚¹ï¼‰

* [ ] ã™ã¹ã¦ .gs/.html ã®ã¿ã«ãªã£ã¦ã„ã‚‹
* [ ] `SS_MASTER_ID` ãŒæŒ‡å®šãƒ–ãƒƒã‚¯ã®ID
* [ ] `tables()` ãŒ READMEã®è¡¨ã‚’ç¶²ç¾…
* [ ] Back ä¸‰æ®µå¾©å¸°ãŒå¯èƒ½
* [ ] ã‚½ãƒ•ãƒˆå‰Šé™¤â†’ç›£æŸ»â†’UI è¡¨ç¤ºï¼ˆéè¡¨ç¤º/ã‚°ãƒ¬ãƒ¼ï¼‰ã®ä¸€è²«æ€§
* [ ] `PRICE_RANGE_OVERLAP`ï¼`DUPLICATE_PERSON` ãŒæœŸå¾…é€šã‚Šè¿”ã‚‹
* [ ] ç›£æŸ»ãƒ­ã‚°ãŒå…¨ãƒ‘ã‚¹ã«æ®‹ã‚‹

---

### ä»˜è¨˜ï¼šREADMEï¼ˆKUROZUMI v1.1ï¼‰ã¨ã®æ•´åˆãƒã‚¤ãƒ³ãƒˆï¼ˆå†æ²ï¼‰

* **æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯ Master DB**ï¼ˆæ©Ÿèƒ½ç´ã¥ã‘æ¸ˆã¿ï¼‰ã€‚
* **æˆ»ã‚‹ãƒœã‚¿ãƒ³å¸¸è¨­ã® MPA**ã€**ã‚½ãƒ•ãƒˆå‰Šé™¤æ¨™æº–**ã€**ER/ãƒ•ãƒ­ãƒ¼/æ©Ÿèƒ½é–¢é€£å›³**ã¯ README ã‚’ãã®ã¾ã¾æ¡ç”¨ã€‚
* **è¿½åŠ ã‚·ãƒ¼ãƒˆã¯æœ€å°æ§‹æˆã§ã¯ä¸è¦**ã€‚ãƒŠãƒ“å¯è¦³æ¸¬æ€§ã‚’é«˜ã‚ãŸã„å ´åˆã®ã¿ `MST_Ui*` 4è¡¨ã‚’è¿½åŠ ã€‚

---

ã“ã‚Œã§ã€**ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸€åˆ‡ãªã—**ã§ã€Codexã«**.gs/.htmlã®ã¿**ã®å®Œå…¨éª¨æ ¼ã‚’æ®µéšç”Ÿæˆã•ã›ã‚‹ãŸã‚ã®**æœ€ä¸Šä½å°æœ¬**ãŒå®Œæˆã§ã™ã€‚
ã“ã® `CODEGEN.md v1.2` ã‚’ README ã¨ä¸€ç·’ã«ãƒªãƒã‚¸ãƒˆãƒªã¸ç½®ãã€ä¸Šè¨˜ **PROMPT-GLOBAL â†’ STAGE1â€¦6** ã‚’**é †ç•ªé€šã‚Š**æŠ•ã’ã‚Œã°ã€ã‚ãªãŸã®MPAÃ—GASÃ—Sheetsï¼ˆMaster DBï¼‰ã‚’**ç·åˆ·æ–°ãƒ»ãƒ•ãƒ«ã‚¹ã‚¯ãƒ©ãƒƒãƒ**ã§å‡ºåŠ›ã•ã›ã‚‹ç²¾åº¦ã¨å†ç¾æ€§ãŒæœ€å¤§åŒ–ã•ã‚Œã¾ã™ã€‚

## Diagrams
- [ER Core](docs/er/core.md)
- [Functional Map](docs/er/functional.md)
- [Key Sequences](docs/er/sequence.md)
- [DFD Level 1](docs/er/dfd.md)

### Child Table Creation Origins
- `MST_Employment` rows originate on **People Detail** via `btnPersonUpdate` (é…å±è¿½åŠ )ã€‚
- `TRN_UserRole` rows originate on **People Detail** via `btnPersonUpdate`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ä»˜ä¸ï¼‰ã€‚
- `MST_Asset` rows originate on **Stores Detail** via `btnStoreUpdate`ï¼ˆè¨­å‚™ç™»éŒ²ï¼‰ã€‚
- `TRN_StockMove` rows originate on **Inventory HUD** via `btnMoveStock`ï¼ˆåœ¨åº«ç§»å‹•ï¼‰ã€‚
- `MST_Price` rows originate on **Pricing Lab** via `btnPriceUpsert`ï¼ˆä¾¡æ ¼æ”¹å®šï¼‰ã€‚
- `TRN_Tender` rows originate on **Sales Pulse** via `btnSalesCreate`ï¼ˆPOS æ±ºæ¸ˆï¼‰ã€‚
- `TRN_Incident` rows originate on **Quality Desk** via `btnIncidentReport`ï¼ˆäº‹æ•…å ±å‘Šï¼‰ã€‚
- `TRN_Document` rows originate on **Docs Library** via `btnDocUpload`ï¼ˆæ–‡æ›¸å…±æœ‰ï¼‰ã€‚
